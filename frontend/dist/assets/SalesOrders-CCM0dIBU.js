import{u as ca,r as u,a as ia,b as oa,c as da,d as ma,R as Yt,e as ua,f as xa,g as pa,h as ha,i as ga,j as fa,k as ba,l as ya,m as Na,n as ja,o as va,p as e,S as Zt,U as wa,q as Sa,L as W,s as Pa,t as Ca,A as ka,v as Ta,X as Da,w as Se,x as st,y as Y,z as f,B as k,C as at}from"./index-DaTQeIrM.js";import{u as Ma,a as La}from"./productsApi-CuUSDwZw.js";import{u as es}from"./useFuzzySearch-BgntWuv8.js";import{S as Ia}from"./SearchableDropdown-OW0MXnv1.js";import{P as Aa}from"./PrintModal-faBbSLsh.js";import{u as Oa}from"./useCompanyInfo-x6rWwbVQ.js";import{N as Ea}from"./NotesPanel-Dw5m6zyf.js";import{D as ts}from"./download-sNUxQ2Ce.js";import{P as ss}from"./plus-CH9F90nm.js";import{E as Ba}from"./eye-off-yu1ZFiMM.js";import{E as as}from"./eye-DQ0qHB88.js";import{C as Fa}from"./calculator-C67OGIjx.js";import{H as $a}from"./history-DotX95kV.js";import{C as rt}from"./check-circle-C7Swk4iC.js";import{I as Ra}from"./info-geJWZ_yE.js";import{A as qa}from"./alert-circle-3gdbj3DL.js";import{T as nt}from"./trash-2-NO2IJ0Re.js";import{S as Ua}from"./save-s6YX8dXx.js";import{F as _a}from"./filter-Dd-_7AND.js";import{M as Qa}from"./message-square-DnREj1zG.js";import{P as rs}from"./printer-sSBWtYCz.js";import{P as Wa}from"./pen-square-CD6kqgaB.js";import{X as lt}from"./x-circle-CEJfwNq8.js";import"./chevron-down-5FLXPK9w.js";import"./check-D4trJhmm.js";import"./settingsApi-B2ylrE_e.js";import"./lock-I7-ewCB8.js";const ns=(j=new Date)=>{const he=j.getFullYear(),ge=String(j.getMonth()+1).padStart(2,"0"),le=String(j.getDate()).padStart(2,"0");return`${he}-${ge}-${le}`},O=j=>j==null?"":typeof j=="string"||typeof j=="number"?j:typeof j=="object"?j.name||j.title||j.fullName||j.companyName||j.displayName||j.businessName||JSON.stringify(j):String(j),Pr=()=>{var Bt,Ft,$t,Rt,qt,Ut,_t,Qt;const{updateTabTitle:j,tabs:he,activeTabId:ge}=ca(),{companyInfo:le}=Oa(),ls=le.companyName||"Company Name",ct=le.address||le.billingAddress||"",it=le.contactNumber||"",cs=ns(),Fe=new Date;Fe.setDate(Fe.getDate()-14);const is=ns(Fe),[T,os]=u.useState({fromDate:is,toDate:cs,orderNumber:"",customer:"",status:"",orderType:""}),[ds,ms]=u.useState({page:1,limit:999999}),[us,Ga]=u.useState({key:"createdAt",direction:"desc"}),[xs,ot]=u.useState(!1),[Pe,dt]=u.useState(null),[ce,ie]=u.useState(!1),[ps,$e]=u.useState(!1),[hs,mt]=u.useState(!1),[gs,ut]=u.useState(null),[i,G]=u.useState(null),[za,Ka]=u.useState(null),[c,oe]=u.useState(null),[F,$]=u.useState(""),[Ce,Z]=u.useState(-1),[ee,fe]=u.useState(!0),[d,h]=u.useState({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:""}),[z,Re]=u.useState(!0),K=u.useCallback(t=>{const s=new Date,a=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),r=String(s.getDate()).padStart(2,"0"),l=String(s.getTime()).slice(-4);return`SO-${(t?(t.businessName||t.name||t.displayName||"").split(" ").map(x=>x.charAt(0).toUpperCase()).join("").substring(0,3):"")||"GEN"}-${a}${n}${r}-${l}`},[]),[te,fs]=u.useState("wholesale"),[b,be]=u.useState(null),[xt,ke]=u.useState(""),[L,V]=u.useState(1),[D,E]=u.useState(""),[pt,Te]=u.useState(0),[ht,ye]=u.useState(!1),[Va,qe]=u.useState(-1),[bs,gt]=u.useState(0),[ys,Ue]=u.useState(!1),[De,de]=u.useState({}),[Me,Ne]=u.useState(!1),[se,me]=u.useState({}),[ft,_e]=u.useState(!1),[Ns,Qe]=u.useState(!1),[js,We]=u.useState({}),[vs,Ge]=u.useState(!1),[ae,ws]=u.useState(!1),[U,je]=u.useState(null),[C,ze]=u.useState({}),[Ss,Le]=u.useState(!1),[M,Ie]=u.useState("pdf"),[Ke,bt]=u.useState(!1),{hasPermission:Ps,user:Ve}=ia(),Ae=Ps("view_cost_prices"),[yt,Cs]=u.useState(!1),Nt=u.useMemo(()=>{if(!Array.isArray(d.items)||d.items.length===0)return 0;const t=a=>{var n,r;return a?(n=a.product)!=null&&n._id?a.product._id:typeof a.product=="string"?a.product:(r=a.productData)!=null&&r._id?a.productData._id:null:null},s=a=>a?a.productData?a.productData:a.product&&typeof a.product=="object"?a.product:null:null;return d.items.reduce((a,n)=>{var v,B,A;const r=Number(n.quantity)||0,l=Number(n.unitPrice)||0,m=t(n),o=s(n),y=[m&&C[m]!==void 0?Number(C[m]):null,Number((v=o==null?void 0:o.pricing)==null?void 0:v.cost),Number((B=o==null?void 0:o.pricing)==null?void 0:B.purchasePrice),Number((A=o==null?void 0:o.pricing)==null?void 0:A.wholesaleCost),Number(o==null?void 0:o.costPrice),Number(o==null?void 0:o.purchasePrice)].find(N=>N!=null&&Number.isFinite(N))||0,g=(l-y)*r;return a+(Number.isFinite(g)?g:0)},0)},[d.items,C]),[Je,_]=u.useState(""),[Oe,J]=u.useState(null),[Ee,I]=u.useState(-1),He=u.useRef(null);u.useEffect(()=>{if(z){const t=K(c);h(s=>s.orderNumber===t?s:{...s,orderNumber:t})}},[z,c,K]),u.useEffect(()=>{if(ce){document.body.style.overflow="hidden";const t=setTimeout(()=>{const s=document.querySelector(".modal-product-search");s&&s.focus()},100);return()=>{clearTimeout(t),document.body.style.overflow="unset"}}else document.body.style.overflow="unset",_(""),J(null),I(-1)},[ce]),u.useEffect(()=>()=>{document.body.style.overflow="unset"},[]),u.useEffect(()=>{if(!j||!ge||!he)return;const t=he.find(a=>a.id===ge);if(!t)return;let s;if(c)s=`SO - ${c.businessName||c.name||"Unknown"}`;else if(!ce)s="SO";else return;t.title!==s&&j(t.id,s)},[c,j,ge,he,ce]);const{data:ue,isLoading:ks,error:jt,refetch:re}=oa({...T,...ds,sortConfig:us},{refetchOnMountOrArgChange:!0}),[Ts]=Ma(),[Ds]=da(),{data:S,isLoading:Ja}=ma({limit:1e3},{staleTime:0,refetchOnMountOrArgChange:!0}),ve=Yt.useMemo(()=>{var t;return((t=S==null?void 0:S.data)==null?void 0:t.customers)||(S==null?void 0:S.customers)||(S==null?void 0:S.data)||S||[]},[S]),{data:P,isLoading:Ms,refetch:xe}=La({limit:100,status:"active"},{keepPreviousData:!0,staleTime:0,refetchOnMountOrArgChange:!0}),vt=Yt.useMemo(()=>{var t,s,a;return P?Array.isArray(P)?P:(t=P==null?void 0:P.data)!=null&&t.products?P.data.products:P!=null&&P.products?P.products:(a=(s=P==null?void 0:P.data)==null?void 0:s.data)!=null&&a.products?P.data.data.products:[]:[]},[P]),Ls=es(vt,xt,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),R=es(vt,Je,["name","description","brand"],{threshold:.4,minScore:.3,limit:50}),[Is,{isLoading:wt}]=ua(),[As,{isLoading:St}]=xa(),[Os,{isLoading:Pt}]=pa(),[Es,{isLoading:Ct}]=ha(),[Bs,{isLoading:kt}]=ga(),[Ha,{isLoading:Xa}]=fa(),[Fs]=ba(),[$s]=ya(),[Rs]=Na(),[qs]=ja(),[Us]=va(),ne=()=>{oe(null),$(""),fe(!0),Z(-1),be(null),ke(""),qe(-1),V(1),E(""),Te(0),ye(!1),gt(t=>t+1),h({orderType:"wholesale",customer:"",items:[],notes:"",isTaxExempt:!0,orderNumber:""}),Re(!0),de({}),Ne(!1),me({}),je(null),ze({}),_e(!1),Qe(!1),We({}),Ge(!1)},Tt=t=>{const s=ve==null?void 0:ve.find(a=>a._id===t);oe(s),h(a=>({...a,customer:t,orderNumber:z?K(s):a.orderNumber})),$(""),fe(!1),Z(-1),de({}),Ne(!1),me({})},_s=t=>{$(t),Z(-1),t===""&&(oe(null),fe(!0),h(s=>({...s,customer:"",orderNumber:z?K(null):s.orderNumber})))},Qs=t=>{if(!ee||!F||!S)return;const s=(ve||[]).filter(n=>(n.businessName||n.name||"").toLowerCase().includes(F.toLowerCase())||(n.email||"").toLowerCase().includes(F.toLowerCase())||(n.phone||"").includes(F)),a=s.length-1;switch(t.key){case"ArrowDown":t.preventDefault(),Z(n=>n<a?n+1:0);break;case"ArrowUp":t.preventDefault(),Z(n=>n>0?n-1:a);break;case"Enter":t.preventDefault(),Ce>=0&&Ce<s.length&&Tt(s[Ce]._id);break;case"Escape":$(""),Z(-1);break}},Xe=(t,s)=>{var a,n,r,l,m;return t?s==="wholesale"?((a=t.pricing)==null?void 0:a.wholesale)||((n=t.pricing)==null?void 0:n.retail)||0:s==="retail"?((r=t.pricing)==null?void 0:r.retail)||0:((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0:0},Ws=async t=>{if(be(t),V(1),ye(!0),ke(t.name),t._id)try{const a=await Ts(t._id).unwrap();a&&a.lastPurchasePrice!==null?je(a.lastPurchasePrice):je(null)}catch{je(null)}else je(null);const s=Xe(t,te);Te(s),E(s.toString())};u.useEffect(()=>{if(b){const t=Xe(b,te);Te(t);const s=Xe(b,te==="wholesale"?"retail":"wholesale");(!D||D===s.toString()||D===pt.toString())&&E(t.toString())}},[te,b]);const Gs=t=>{ke(t),qe(-1),b&&t!==b.name&&(be(null),E(""),ye(!1)),t===""&&(be(null),E(""),ye(!1))},Dt=t=>{t.key==="Enter"&&b&&(t.preventDefault(),Mt())},zs=t=>{var a,n,r,l,m,o,w,x,y;((a=t.inventory)==null?void 0:a.currentStock)<=(((n=t.inventory)==null?void 0:n.reorderPoint)||0),(r=t.inventory)==null||r.currentStock;let s=((l=t.pricing)==null?void 0:l.wholesale)||((m=t.pricing)==null?void 0:m.retail)||0;return te==="wholesale"?s=((o=t.pricing)==null?void 0:o.wholesale)||((w=t.pricing)==null?void 0:w.retail)||0:te==="retail"&&(s=((x=t.pricing)==null?void 0:x.retail)||0),e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((y=t.inventory)==null?void 0:y.currentStock)||0]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Price: ",Math.round(s)]})]})]})},Mt=async()=>{var t,s,a,n,r;if(b){if(!D||parseFloat(D)<=0){f("Please enter a valid rate");return}if(((t=b.inventory)==null?void 0:t.currentStock)===0){f(`${b.name} is out of stock and cannot be added to the order.`);return}if(L>((s=b.inventory)==null?void 0:s.currentStock)){f(`Cannot add ${L} units. Only ${(a=b.inventory)==null?void 0:a.currentStock} units available in stock.`);return}_e(!0);try{const l=parseFloat(D)||pt;if(U!==null&&l<U){const g=U-l,v=(g/U*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price (${l}) is below cost price (${Math.round(U)}).

Loss per unit: ${Math.round(g)} (${v}%)
Total loss: ${Math.round(g*L)}

Do you want to proceed?`))return}const m=l*L,o=0,w=d.isTaxExempt?0:m*(((n=b.taxSettings)==null?void 0:n.taxRate)||0)/100,x=m-o+w;U!==null&&ze(g=>({...g,[b._id]:U}));const y={product:b._id,productData:b,quantity:L,unitPrice:l,discountPercent:0,taxRate:((r=b.taxSettings)==null?void 0:r.taxRate)||0,subtotal:m,discountAmount:o,taxAmount:w,total:x};h(g=>({...g,items:[...g.items,y]})),be(null),V(1),E(""),Te(0),ye(!1),ke(""),qe(-1),gt(g=>g+1),setTimeout(()=>{He.current&&He.current.focus()},100);const p=(c==null?void 0:c.businessType)==="wholesale"?"wholesale":(c==null?void 0:c.businessType)==="distributor"?"distributor":"wholesale";k(`${b.name} added to order at ${p} price: ${Math.round(l)}`)}catch(l){Y(l,"Product Price Check")}finally{_e(!1)}}},Lt=t=>{var n;const s=d.items[t],a=((n=s==null?void 0:s.product)==null?void 0:n.toString())||t.toString();We(r=>({...r,[a]:!0}));try{if(h(r=>({...r,items:r.items.filter((l,m)=>m!==t)})),Me&&s){const r=s.product.toString(),l={...De};delete l[r],de(l);const m={...se};delete m[r],me(m)}if(s){const r=s.product.toString(),l={...C};delete l[r],ze(l)}}finally{We(r=>{const l={...r};return delete l[a],l})}},Ks=()=>{Ge(!0);try{h(t=>{if(!t.items||t.items.length<2)return t;const s=n=>{const r=n.productData||n.product;return r?typeof r=="string"?r:r.name||r.title||r.displayName||r.businessName||r.fullName||"":""},a=[...t.items].sort((n,r)=>{const l=s(n).toString().toLowerCase(),m=s(r).toString().toLowerCase();return l<m?-1:l>m?1:0});return{...t,items:a}}),k("Cart items sorted alphabetically")}finally{Ge(!1)}},Vs=async()=>{if(!c){f("Please select a customer first");return}if(d.items.length===0){f("Please add products to cart first");return}Ue(!0);try{const{data:t}=await Ds(c._id),{prices:s,orderNumber:a,orderDate:n}=t.data;if(!s||Object.keys(s).length===0){f("No previous order found for this customer"),Ue(!1);return}const r={},l={};d.items.forEach(p=>{const g=p.product.toString();r[g]=p.unitPrice}),de(r);let m=0,o=0,w=0;const x=d.items.map(p=>{const g=p.product.toString();if(s[g]){const v=s[g].unitPrice,B=p.unitPrice;if(v!==B){m++,l[g]="updated";const A=v*p.quantity,N=d.isTaxExempt?0:A*(p.taxRate||0)/100,q=A-(p.discountAmount||0)+N;return{...p,unitPrice:v,subtotal:A,taxAmount:N,total:q}}else return o++,l[g]="unchanged",p}else return w++,l[g]="not-found",p});h(p=>({...p,items:x})),me(l),Ne(!0);const y=n?new Date(n).toLocaleDateString():"previous order";if(m>0){let p=`Applied prices from ${a||"previous order"} (${y}). Updated ${m} product(s).`;o>0&&(p+=` ${o} product(s) had same price.`),w>0&&(p+=` ${w} product(s) not found in previous order.`),k(p)}else o>0?k(`All products already have the same prices as in ${a||"previous order"} (${y}).`):f("No matching products found in previous order")}catch(t){Y(t,"Apply Last Prices")}finally{Ue(!1)}},Js=()=>{if(Object.keys(De).length===0){f("No original prices to restore");return}Qe(!0);try{let t=0;const s=d.items.map(a=>{const n=a.product.toString();if(De[n]!==void 0){t++;const r=De[n],l=r*a.quantity,m=d.isTaxExempt?0:l*(a.taxRate||0)/100,o=l-(a.discountAmount||0)+m;return{...a,unitPrice:r,subtotal:l,taxAmount:m,total:o}}return a});h(a=>({...a,items:s})),Ne(!1),de({}),me({}),t>0&&k(`Restored original prices for ${t} product(s).`)}finally{Qe(!1)}},It=()=>{const t=d.items.reduce((r,l)=>r+l.unitPrice*l.quantity,0),s=d.items.reduce((r,l)=>r+(l.discountAmount||0),0),a=d.isTaxExempt?0:t*.08,n=t-s+a;return{subtotal:t,totalDiscount:s,totalTax:a,total:n}},Be=(t,s)=>{os(a=>({...a,[t]:s})),ms(a=>({...a,page:1}))},Hs=()=>{if(d.items.length===0){f("Please add at least one item to the order");return}const{subtotal:t,totalTax:s,total:a}=It(),{payment:n,...r}=d,l=d.items.map(o=>({product:o.product,quantity:o.quantity,unitPrice:o.unitPrice,totalPrice:o.total,invoicedQuantity:0,remainingQuantity:o.quantity})),m={...r,items:l,subtotal:t,tax:s,total:a};Is(m).unwrap().then(()=>{ne(),k("Sales order created successfully"),re()}).catch(o=>{f(Y(o))})},Xs=()=>{const t={...d,items:d.items.map(s=>({product:s.product,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total,invoicedQuantity:s.invoicedQuantity||0,remainingQuantity:s.remainingQuantity||s.quantity}))};As({id:i._id,...t}).unwrap().then(()=>{ie(!1),G(null),_(""),J(null),I(-1),ne(),k("Sales order updated successfully"),re()}).catch(s=>{var n;const a=((n=s==null?void 0:s.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Failed to update sales order";f(a)})},Ys=t=>{window.confirm("Are you sure you want to delete this sales order?")&&Os(t).unwrap().then(()=>{k("Sales order deleted successfully"),re()}).catch(s=>{f(Y(s))})},Zs=t=>{window.confirm("Are you sure you want to confirm this pending sales order? This will change its status to confirmed and make it ready for invoicing.")&&Es(t).unwrap().then(()=>{k("Sales order confirmed successfully"),re(),xe&&typeof xe=="function"&&xe()}).catch(s=>{f(Y(s))})},ea=t=>{window.confirm("Are you sure you want to cancel this sales order? This action cannot be undone.")&&Bs(t).unwrap().then(()=>{k("Sales order cancelled successfully"),re(),xe&&typeof xe=="function"&&xe()}).catch(s=>{f(Y(s))})},ta=async()=>{var t;bt(!0);try{const s={fromDate:T.fromDate,toDate:T.toDate,status:T.status,customer:T.customer,orderNumber:T.orderNumber,orderType:T.orderType};let a;if(M==="excel"?a=await Fs(s).unwrap():M==="csv"?a=await $s(s).unwrap():M==="json"?a=await qs(s).unwrap():M==="pdf"&&(a=await Rs(s).unwrap()),a!=null&&a.filename){const n=a.filename;try{M==="pdf"&&await new Promise(l=>setTimeout(l,500));let r;try{r=await Us(n).unwrap()}catch{f("Download failed");return}if(!r){f("Download failed: No response received");return}if(!r){f("Download failed: No data received from server");return}if(M==="pdf"){const l=r;if(!l||!(l instanceof Blob)){if(typeof l=="string")f(`Server error: ${l.substring(0,100)}`);else if(l&&typeof l=="object"){let x=l.message||l.error;if(!x)try{const y=JSON.stringify(l);y==="{}"||y==="null"||y===""?x=l.statusText||l.status||"Unknown server error":x=y.substring(0,150)}catch{x="Invalid response format"}f(`Server error: ${x||"Unknown error"}`)}else f("Invalid PDF file received - expected Blob. Response type: "+typeof l);return}const m=l.type||"";if(m.includes("application/json")||m.includes("text/html")){const x=new FileReader;x.onload=()=>{const y=x.result;try{const p=JSON.parse(y);f(p.message||"File not found or generation failed")}catch{f("Server returned error instead of PDF. Please try again.")}},x.readAsText(l);return}if(l.size===0){f("PDF file is empty");return}if(l.type&&!l.type.includes("pdf")&&!l.type.includes("application/octet-stream")){const x=new FileReader;x.onload=()=>{const y=x.result;if(y.includes("<!DOCTYPE")||y.includes('{"error"')||y.includes('{"message"'))f("Server returned an error instead of PDF file");else{const p=URL.createObjectURL(l);if(window.open(p,"_blank"))k("PDF opened in new tab");else{const v=document.createElement("a");v.href=p,v.download=n,document.body.appendChild(v),v.click(),document.body.removeChild(v),k("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(p),1e4)}},x.readAsText(l.slice(0,100));return}const o=URL.createObjectURL(l);if(window.open(o,"_blank"))k("PDF opened in new tab");else{const x=document.createElement("a");x.href=o,x.download=n,document.body.appendChild(x),x.click(),document.body.removeChild(x),k("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(o),1e4)}else{const l=r instanceof Blob?r:new Blob([r],{type:M==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":M==="csv"?"text/csv":"application/json"}),m=URL.createObjectURL(l),o=document.createElement("a");o.href=m,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(m),k(`${M.toUpperCase()} file downloaded successfully`)}}catch(r){if(r.response)if(r.response.data instanceof Blob){const l=new FileReader;l.onload=()=>{const m=l.result;try{const o=JSON.parse(m);f(o.message||"Download failed")}catch{f("Download failed: "+m.substring(0,100))}},l.readAsText(r.response.data)}else f(((t=r.response.data)==null?void 0:t.message)||`Download failed: ${r.response.status}`);else f("Download failed: "+(r.message||"Unknown error"));return}}Le(!1)}catch(s){Y(s,"Export")}finally{bt(!1)}},sa=t=>{var a,n;G(t),ie(!0);const s=(t.items||[]).map(r=>({...r,productData:r.product||null}));h({orderType:t.orderType,customer:((a=t.customer)==null?void 0:a._id)||"",items:s,notes:t.notes||"",terms:t.terms||"",isTaxExempt:((n=t.pricing)==null?void 0:n.isTaxExempt)||!1,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||""}),Re(!(t.soNumber||t.orderNumber||t.invoiceNumber)),t.customer?(oe(t.customer),$(t.customer.businessName||t.customer.name||"")):(oe(null),$(""),fe(!0)),ie(!0)},aa=t=>{G(t),$e(!0)},ra=u.useCallback(t=>{var p,g,v,B,A;if(!t)return null;const s=t.customer||c||(t.customerInfo?{displayName:t.customerInfo.name,email:t.customerInfo.email,phone:t.customerInfo.phone,address:t.customerInfo.address,pendingBalance:t.customerInfo.pendingBalance}:null),a=t.customerInfo||(s?{name:s.displayName||s.businessName||s.name||"Customer",email:s.email||"",phone:s.phone||"",address:s.address||s.location||s.companyAddress||""}:null),r=(t.items||d.items||[]).map(N=>{const q=N.productData||N.product||N.productInfo||N.productDetails||{};return{...N,product:{name:q.name||N.productName||q.title||"Product"},quantity:Number(N.quantity)||0,unitPrice:Number(N.unitPrice!==void 0?N.unitPrice:N.rate!==void 0?N.rate:0)||0}}),l=r.reduce((N,q)=>N+(q.unitPrice||0)*(q.quantity||0),0),m=t.subtotal??((p=t.pricing)==null?void 0:p.subtotal)??l,o=t.discount??((g=t.pricing)==null?void 0:g.discountAmount)??0,w=t.total??((v=t.pricing)==null?void 0:v.total)??m-o,x=((B=t.payment)==null?void 0:B.amountPaid)||0,y=((A=t.payment)==null?void 0:A.remainingBalance)??w-x;return{...t,orderNumber:t.soNumber||t.orderNumber||t.invoiceNumber||d.orderNumber||K(s),customer:s,customerInfo:a,items:r,pricing:{subtotal:m,discountAmount:o,total:w},payment:{amountPaid:x,remainingBalance:y},createdAt:t.createdAt||new Date().toISOString()}},[d.items,d.orderNumber,K,c]),Ye=t=>{const s=ra(t);s&&(ut(s),mt(!0))},na=t=>{switch(t){case"closed":case"fully_invoiced":return e.jsx(rt,{className:"h-4 w-4 text-green-500"});case"confirmed":case"partially_invoiced":return e.jsx(at,{className:"h-4 w-4 text-yellow-500"});case"cancelled":return e.jsx(lt,{className:"h-4 w-4 text-red-500"});case"draft":return e.jsx(at,{className:"h-4 w-4 text-blue-500"});default:return e.jsx(at,{className:"h-4 w-4 text-gray-500"})}},At=(ue==null?void 0:ue.salesOrders)||[],la=(ue==null?void 0:ue.pagination)||{},{subtotal:Ot,totalDiscount:Ze,totalTax:Et,total:et}=It();return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Orders"}),e.jsx("p",{className:"text-gray-600",children:"Process sales order transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>Le(!0),className:"btn btn-secondary btn-md",title:"Export sales orders data",children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs("button",{onClick:ne,className:"btn btn-primary btn-md",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"New Sales Order"]})]})]}),e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs("div",{className:"w-[500px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Customer"}),c&&e.jsx("button",{onClick:()=>{oe(null),$(""),h(t=>({...t,customer:""})),Z(-1),de({}),Ne(!1),me({})},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change customer",children:"Change Customer"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-normal text-gray-400",children:"Price Type:"}),e.jsxs("select",{value:te,onChange:t=>fs(t.target.value),className:"border border-gray-200 rounded-md px-2 py-1 text-xs text-gray-600 focus:outline-none focus:ring-1 focus:ring-primary-400 focus:border-primary-400",children:[e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"custom",children:"Custom"})]})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:ee?F:c&&(c.displayName||c.businessName||c.name)||"",onChange:t=>{ee&&_s(t.target.value)},onKeyDown:Qs,className:`input w-full pr-10 ${ee?"":"bg-gray-50 cursor-default"}`,placeholder:ee?"Search customers by name, email, or business...":"",readOnly:!ee}),e.jsx(Zt,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]}),ee&&F&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:(ve||[]).filter(t=>{const s=F.toLowerCase(),a=(t.displayName||t.businessName||t.name||"").toLowerCase(),n=(t.email||"").toLowerCase(),r=(t.phone||"").toLowerCase();return a.includes(s)||n.includes(s)||r.includes(F)}).map((t,s)=>e.jsxs("div",{onClick:()=>{Tt(t._id),$(""),fe(!1)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${s===Ce?"bg-blue-100 text-blue-900":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.displayName||t.businessName||t.name||"Unknown"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.email&&e.jsx("div",{children:t.email}),(()=>{const a=t.pendingBalance||0,n=t.advanceBalance||0,r=a-n;return r<0?`Payables: ${Math.abs(r).toFixed(2)}`:`Receivables: ${r.toFixed(2)}`})()]})]},t._id))})]}),e.jsx("div",{className:"flex-1",children:c?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(wa,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.displayName||c.businessName||c.name||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[c.businessType||"Business"," • ",c.phone||"No phone"]}),c.email&&e.jsx("p",{className:"text-sm text-gray-600",children:c.email}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[(()=>{const t=c.pendingBalance||0,s=c.advanceBalance||0,a=t-s,n=a<0,r=a>0;return t>0||s>0?e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:n?"Payables:":"Receivables:"}),e.jsx("span",{className:`text-sm font-medium ${n?"text-red-600":r?"text-green-600":"text-gray-600"}`,children:Math.abs(a).toFixed(2)})]}):null})(),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Credit Limit:"}),e.jsx("span",{className:`text-sm font-medium ${c.creditLimit>0?(c.currentBalance||0)+(c.pendingBalance||0)>=c.creditLimit*.9?"text-red-600":(c.currentBalance||0)+(c.pendingBalance||0)>=c.creditLimit*.7?"text-yellow-600":"text-blue-600":"text-gray-600"}`,children:(c.creditLimit||0).toFixed(2)}),c.creditLimit>0&&(c.currentBalance||0)+(c.pendingBalance||0)>=c.creditLimit*.9&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Available Credit:"}),e.jsx("span",{className:`text-sm font-medium ${c.creditLimit>0?c.creditLimit-((c.currentBalance||0)+(c.pendingBalance||0))<=c.creditLimit*.1?"text-red-600":c.creditLimit-((c.currentBalance||0)+(c.pendingBalance||0))<=c.creditLimit*.3?"text-yellow-600":"text-green-600":"text-gray-600"}`,children:(c.creditLimit-((c.currentBalance||0)+(c.pendingBalance||0))).toFixed(2)})]})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-start lg:justify-end gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>ws(!ae),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:ae?"Hide purchase cost prices":"Show purchase cost prices",children:ae?e.jsxs(e.Fragment,{children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsx("span",{children:"Hide Cost"})]}):e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{children:"Show Cost"})]})}),(Ve==null?void 0:Ve.role)==="admin"&&d.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>Cs(t=>!t),className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Toggle estimated profit (BP)",children:[e.jsx(Fa,{className:"h-4 w-4"}),e.jsx("span",{children:yt?"Hide BP":"Show BP"})]}),yt&&e.jsx("span",{className:`text-sm font-semibold ${Nt>=0?"text-green-600":"text-red-600"}`,children:Sa(Nt||0)})]})]}),c&&d.items.length>0&&e.jsx(e.Fragment,{children:Me?e.jsxs(W,{onClick:Js,isLoading:Ns,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Restore original/current prices",children:[e.jsx(Pa,{className:"h-4 w-4 mr-2"}),"Restore Current Prices"]}):e.jsxs(W,{onClick:Vs,isLoading:ys,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Apply prices from last order for this customer",children:[e.jsx($a,{className:"h-4 w-4 mr-2"}),"Apply Last Prices"]})})]})]})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:(()=>{var a,n;const t=Ae&&ae?"md:col-span-6":"md:col-span-7",s=ht?Math.round(L*parseFloat(D||0)):0;return e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:`col-span-12 ${t}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(Ia,{ref:He,placeholder:"Search or select product...",items:Ls||[],onSelect:Ws,onSearch:Gs,displayKey:zs,selectedItem:b,loading:Ms,emptyMessage:"No products found",value:xt},bs)]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:b?((a=b.inventory)==null?void 0:a.currentStock)||0:"0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:(n=b==null?void 0:b.inventory)==null?void 0:n.currentStock,value:L,onChange:r=>V(parseInt(r.target.value)||1),onKeyDown:Dt,onFocus:r=>r.target.select(),className:"input text-center",placeholder:"1 (Enter to add & focus search)",autoFocus:ht})]}),ae&&Ae&&e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-10 flex items-center justify-center",title:"Last Purchase Price",children:U!==null?`${Math.round(U)}`:b?"N/A":"0"})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsx("input",{type:"number",step:"1",value:D,onChange:r=>E(r.target.value),onKeyDown:Dt,onFocus:r=>r.target.select(),className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-6 md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:s})]}),e.jsx("div",{className:"col-span-6 md:col-span-1 flex items-end",children:e.jsxs(W,{type:"button",onClick:Mt,isLoading:ft,className:"btn btn-primary w-full flex items-center justify-center px-3 py-2",disabled:!b||ft,title:"Add to cart (or press Enter in Quantity/Rate fields - focus returns to search)",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Add"]})})]})})()}),d.items.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(Ca,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(W,{type:"button",onClick:Ks,isLoading:vs,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(ka,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]}),Me&&Object.keys(se).length>0&&e.jsxs("div",{className:"flex items-center space-x-3 text-xs",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Price Status:"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(rt,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-gray-600",children:"Updated"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ra,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-gray-600",children:"Same Price"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(qa,{className:"h-3 w-3 text-yellow-600"}),e.jsx("span",{className:"text-gray-600",children:"Not in Last Order"})]})]})]})]}),d.items.map((t,s)=>{var l,m,o,w,x,y,p,g,v,B,A,N,q,Wt,Gt,zt,Kt,Vt,Jt,Ht;const a=t.productData||t.product,n=t.unitPrice*t.quantity,r=((l=a==null?void 0:a.inventory)==null?void 0:l.currentStock)<=(((m=a==null?void 0:a.inventory)==null?void 0:m.reorderPoint)||0);return e.jsx("div",{className:`py-1 ${s%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:s+1})}),e.jsx("div",{className:`${ae&&Ae?"col-span-5":"col-span-6"} flex items-center h-8`,children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[O(a==null?void 0:a.name)||"Unknown Product",r&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"}),C[(o=t.product)==null?void 0:o.toString()]!==void 0&&t.unitPrice<C[(w=t.product)==null?void 0:w.toString()]&&e.jsx("span",{className:"text-xs ml-2 px-1.5 py-0.5 rounded bg-red-100 text-red-700 font-bold",title:`Sale price below cost! Loss: ${Math.round(C[(x=t.product)==null?void 0:x.toString()]-t.unitPrice)} per unit`,children:"⚠️ Below Cost"}),Me&&se[(y=t.product)==null?void 0:y.toString()]&&e.jsx("span",{className:`text-xs ml-2 px-1.5 py-0.5 rounded ${se[(p=t.product)==null?void 0:p.toString()]==="updated"?"bg-green-100 text-green-700":se[(g=t.product)==null?void 0:g.toString()]==="unchanged"?"bg-blue-100 text-blue-700":"bg-yellow-100 text-yellow-700"}`,children:se[(v=t.product)==null?void 0:v.toString()]==="updated"?"Updated":se[(B=t.product)==null?void 0:B.toString()]==="unchanged"?"Same Price":"Not in Last Order"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:((A=a==null?void 0:a.inventory)==null?void 0:A.currentStock)||0})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:t.quantity,onChange:tt=>{const Q=parseInt(tt.target.value)||1;if(Q<=0){Lt(s);return}h(H=>({...H,items:H.items.map((pe,X)=>X===s?{...pe,quantity:Q,total:Q*pe.unitPrice}:pe)}))},className:"input text-center h-8",min:"1"})}),ae&&Ae&&e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-red-700 bg-red-50 px-2 py-1 rounded border border-red-200 block text-center h-8 flex items-center justify-center",title:"Last Purchase Price",children:C[(N=t.product)==null?void 0:N.toString()]!==void 0?`${Math.round(C[(q=t.product)==null?void 0:q.toString()])}`:"N/A"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:t.unitPrice,onChange:tt=>{var pe;const Q=parseFloat(tt.target.value)||0,H=C[(pe=t.product)==null?void 0:pe.toString()];if(H!==void 0&&Q<H){const X=H-Q,we=(X/H*100).toFixed(1);if(!window.confirm(`⚠️ WARNING: Sale price (${Q}) is below cost price (${Math.round(H)}).

Loss per unit: ${Math.round(X)} (${we}%)
Total loss: ${Math.round(X*t.quantity)}

Do you want to proceed?`))return}h(X=>({...X,items:X.items.map((we,Xt)=>Xt===s?{...we,unitPrice:Q,total:we.quantity*Q}:we)}))},className:`input text-center h-8 ${C[(Wt=t.product)==null?void 0:Wt.toString()]!==void 0&&t.unitPrice<C[(Gt=t.product)==null?void 0:Gt.toString()]?"border-red-500 bg-red-50":""}`,title:C[(zt=t.product)==null?void 0:zt.toString()]!==void 0&&t.unitPrice<C[(Kt=t.product)==null?void 0:Kt.toString()]?`⚠️ WARNING: Sale price (${Math.round(t.unitPrice)}) is below cost price (${Math.round(C[(Vt=t.product)==null?void 0:Vt.toString()])})`:"",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:Math.round(n)})}),e.jsx("div",{className:"col-span-1",children:e.jsx(W,{onClick:()=>Lt(s),isLoading:js[((Ht=(Jt=d.items[s])==null?void 0:Jt.product)==null?void 0:Ht.toString())||s],className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(nt,{className:"h-4 w-4"})})})]})},s)})]})]})]}),d.items.length>0&&!ce&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Sales Order Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>h(s=>({...s,orderType:t.target.value})),className:"input h-8 text-sm",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>h(s=>({...s,isTaxExempt:t.target.checked})),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),d.isTaxExempt&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-72",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 m-0",children:"Invoice Number"}),e.jsxs("label",{htmlFor:"soAutoGenerateInvoice",className:"flex items-center space-x-1 text-[11px] text-gray-600 cursor-pointer select-none",children:[e.jsx("input",{type:"checkbox",id:"soAutoGenerateInvoice",checked:z,onChange:t=>{const s=t.target.checked;if(Re(s),s){const a=K(c);h(n=>({...n,orderNumber:a}))}},className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{children:"Auto-generate"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d.orderNumber,onChange:t=>h(s=>({...s,orderNumber:t.target.value})),className:"w-full input pr-16 h-8 text-sm",placeholder:z?"Auto-generated":"Enter invoice number",disabled:z}),z&&e.jsx("button",{type:"button",onClick:()=>{const t=K(c);h(s=>({...s,orderNumber:t}))},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-[11px] text-primary-600 hover:text-primary-800 font-medium",children:"Regenerate"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:d.notes,onChange:t=>h(s=>({...s,notes:t.target.value})),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Ot)})]}),Ze>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Discount:"}),e.jsxs("span",{className:"text-xl font-bold text-red-600",children:["-",Math.round(Ze)]})]}),!d.isTaxExempt&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:Math.round(Et)})]}),c&&(()=>{const t=c.pendingBalance||0,s=c.advanceBalance||0,a=t-s;return t>0||s>0?e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:a<0?"Previous Advance:":"Previous Balance:"}),e.jsxs("span",{className:`text-xl font-bold ${a<0?"text-green-600":"text-red-600"}`,children:[a<0?"-":"+",Math.abs(Math.round(a))]})]}):null})(),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Math.round(et)})]}),c&&(()=>{const t=c.pendingBalance||0,s=c.advanceBalance||0,a=t-s;if(!(t>0||s>0))return null;const r=et+a,l=r<0;return e.jsxs("div",{className:"flex justify-between items-center text-lg font-bold border-t-2 border-red-400 pt-3 mt-2",children:[e.jsx("span",{className:l?"text-green-700":"text-red-700",children:l?"Total Advance:":"Total Payables:"}),e.jsx("span",{className:`text-2xl ${l?"text-green-700":"text-red-700"}`,children:Math.abs(Math.round(r))})]})})()]})}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[e.jsxs("button",{onClick:ne,className:"btn btn-secondary flex-1",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),e.jsxs("button",{onClick:()=>{const t={soNumber:d.orderNumber||`SO-${Date.now()}`,orderNumber:d.orderNumber||`SO-${Date.now()}`,customer:c,items:d.items.map(s=>({product:s.productData,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.total})),subtotal:Ot,discount:Ze,tax:Et,total:et,orderType:d.orderType||"wholesale",status:"draft",paymentMethod:d.paymentMethod,isTaxExempt:d.isTaxExempt,notes:d.notes,createdAt:new Date().toISOString()};Ye(t)},className:"btn btn-secondary flex-1",children:[e.jsx(Ta,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs("button",{onClick:Hs,disabled:wt||d.items.length===0,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(Ua,{className:"h-4 w-4 mr-2"}),wt?"Creating...":"Create Sales Order"]})]})]}),ce&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t=>{t.target===t.currentTarget&&(ie(!1),G(null),_(""),J(null),I(-1),ne())},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Sales Order Details"}),e.jsx("button",{onClick:()=>{ie(!1),G(null),_(""),J(null),I(-1),ne()},className:"text-gray-400 hover:text-gray-600",children:e.jsx(Da,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Selection"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:F,onChange:t=>$(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),F&&((Bt=S==null?void 0:S.customers)==null?void 0:Bt.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:S.customers.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{h(s=>({...s,customer:t._id})),$(t.businessName||t.name)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.businessName||t.name}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:d.orderType,onChange:t=>h(s=>({...s,orderType:t.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:d.isTaxExempt,onChange:t=>h(s=>({...s,isTaxExempt:t.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"taxExempt",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:t=>h(s=>({...s,notes:t.target.value})),placeholder:"Add any notes or comments...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terms & Conditions"}),e.jsx("textarea",{value:d.terms,onChange:t=>h(s=>({...s,terms:t.target.value})),placeholder:"Add terms and conditions...",rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"Product Selection & Cart Items"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:Je,onChange:t=>{t.stopPropagation(),_(t.target.value),I(-1)},onFocus:t=>t.stopPropagation(),onKeyDown:t=>{var a;if(t.stopPropagation(),!(R!=null&&R.length))return;const s=Math.min(R.length-1,4);switch(t.key){case"ArrowDown":t.preventDefault(),I(n=>n<s?n+1:0);break;case"ArrowUp":t.preventDefault(),I(n=>n>0?n-1:s);break;case"Enter":if(t.preventDefault(),Ee>=0&&R[Ee]){const n=R[Ee];J(n),E(((a=n.pricing)==null?void 0:a.retail)||0),V(1),_(n.name),I(-1),setTimeout(()=>{const r=document.querySelector(".modal-quantity-input");r&&r.focus()},100)}break;case"Escape":t.preventDefault(),I(-1);break}},className:"modal-product-search w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",autoFocus:!0}),Je&&(R==null?void 0:R.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:R.slice(0,5).map((t,s)=>{var a,n;return e.jsxs("div",{onClick:()=>{var r;J(t),E(((r=t.pricing)==null?void 0:r.retail)||0),V(1),_(t.name),I(-1),setTimeout(()=>{const l=document.querySelector(".modal-quantity-input");l&&l.focus()},100)},className:`px-3 py-2 cursor-pointer border-b border-gray-100 last:border-b-0 ${Ee===s?"bg-blue-100 border-blue-200":"hover:bg-gray-100"}`,children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((a=t.inventory)==null?void 0:a.currentStock)||0," | Price: ",((n=t.pricing)==null?void 0:n.retail)||0]})]},t._id)})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:L,onChange:t=>V(parseInt(t.target.value)||1),className:"modal-quantity-input w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Price Per Unit"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:D,onChange:t=>E(parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("button",{type:"button",onClick:()=>{if(Oe&&L>0&&D>=0){const t={product:Oe._id,quantity:L,unitPrice:D,subtotal:L*D,productData:Oe};h(s=>({...s,items:[...s.items,t]})),J(null),_(""),V(1),E(""),I(-1)}},disabled:!Oe||L<=0||D<0,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Add Product"})})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Items:"}),d.items.length===0?e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No items in this order"}):d.items.map((t,s)=>{var a,n;return e.jsxs("div",{className:"flex items-center p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 min-w-[200px] mr-4",children:((a=t.productData)==null?void 0:a.name)||"Unknown Product"}),e.jsxs("div",{className:"flex items-center space-x-3 ml-auto",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"Qty:"}),e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:r=>{const l=[...d.items],m=Math.max(1,parseInt(r.target.value)||1);l[s].quantity=m,l[s].subtotal=m*l[s].unitPrice,h(o=>({...o,items:l}))},className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"× Sale Price:"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.unitPrice,onChange:r=>{const l=[...d.items],m=parseFloat(r.target.value)||0;l[s].unitPrice=m,l[s].subtotal=l[s].quantity*m,h(o=>({...o,items:l}))},className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("label",{className:"text-xs text-gray-600",children:"="}),e.jsx("span",{className:"text-sm font-medium text-gray-900 min-w-[60px]",children:((n=t.subtotal)==null?void 0:n.toFixed(2))||(t.quantity*t.unitPrice).toFixed(2)})]}),e.jsx("button",{type:"button",onClick:()=>{const r=d.items.filter((l,m)=>m!==s);h(l=>({...l,items:r}))},className:"px-2 py-1 text-sm bg-red-200 text-red-700 rounded hover:bg-red-300 ml-2",title:"Remove item",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s)})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{ie(!1),G(null),_(""),J(null),I(-1),ne()},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx(W,{onClick:Xs,isLoading:St,disabled:St||d.items.length===0,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Update Sales Order"})]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_a,{className:"h-5 w-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Filters"})]})}),e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),e.jsx("input",{type:"date",value:T.fromDate,onChange:t=>Be("fromDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),e.jsx("input",{type:"date",value:T.toDate,onChange:t=>Be("toDate",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Order Number"}),e.jsx("input",{type:"text",placeholder:"Contains...",value:T.orderNumber,onChange:t=>Be("orderNumber",t.target.value),className:"input h-[42px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:T.status,onChange:t=>Be("status",t.target.value),className:"input h-[42px]",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"draft",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"partially_invoiced",children:"Partially Invoiced"}),e.jsx("option",{value:"fully_invoiced",children:"Fully Invoiced"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>re(),className:"btn btn-primary w-full flex items-center justify-center space-x-2 h-[42px]",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{children:"Search"})]})})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Sales Orders From: ",Se(T.fromDate)," To: ",Se(T.toDate)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[la.totalItems||0," records"]}),e.jsx("button",{onClick:()=>re(),className:"p-2 text-gray-400 hover:text-gray-600",title:"Refresh",children:e.jsx(st,{className:"h-4 w-4"})})]})]})}),e.jsx("div",{className:"card-content p-0",children:ks?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(st,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Loading sales orders..."})]}):jt?e.jsx("div",{className:"p-8 text-center text-red-600",children:e.jsxs("p",{children:["Error loading sales orders: ",Y(jt).message]})}):At.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:e.jsx("p",{children:"No sales orders found for the selected criteria."})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:At.map((t,s)=>{var a,n,r;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Se(t.createdAt)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.soNumber}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((a=t.customer)==null?void 0:a.displayName)||((n=t.customer)==null?void 0:n.businessName)||((r=t.customer)==null?void 0:r.name)||"Walk-in"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize",children:t.orderType}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[na(t.status),e.jsx("span",{className:"capitalize",children:t.status==="draft"?"Pending":t.status.replace("_"," ")})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Math.round(t.total||0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{dt({type:"SalesOrder",id:t._id,name:t.soNumber}),ot(!0)},className:"text-green-600 hover:text-green-900",title:"Notes",children:e.jsx(Qa,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>aa(t),className:"text-blue-600 hover:text-blue-900",title:"View",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Ye(t),className:"text-gray-600 hover:text-gray-900",title:"Print",children:e.jsx(rs,{className:"h-4 w-4"})}),t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>sa(t),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(Wa,{className:"h-4 w-4"})}),e.jsx(W,{onClick:()=>Zs(t._id),isLoading:Ct,className:"text-green-600 hover:text-green-900",title:"Confirm Order",disabled:Ct,children:e.jsx(rt,{className:"h-4 w-4"})}),e.jsx(W,{onClick:()=>ea(t._id),isLoading:kt,className:"text-red-600 hover:text-red-900",title:"Cancel Order",disabled:kt,children:e.jsx(lt,{className:"h-4 w-4"})})]}),t.status==="draft"&&e.jsx(W,{onClick:()=>Ys(t._id),isLoading:Pt,className:"text-red-600 hover:text-red-900",title:"Delete",disabled:Pt,children:e.jsx(nt,{className:"h-4 w-4"})})]})})]},t._id)})})]})})})]}),ps&&i&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-10 mx-auto p-5 border w-4/5 max-w-4xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Sales Order"}),e.jsx("button",{onClick:()=>{$e(!1),G(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:ls}),ct&&e.jsx("p",{className:"text-sm text-gray-600",children:ct}),it&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Phone: ",it]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Sales Order Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"SO Number:"})," ",i.soNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",Se(i.createdAt)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Order Type:"})," ",i.orderType||"Standard"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${i.status==="draft"?"bg-gray-100 text-gray-800":i.status==="confirmed"?"bg-blue-100 text-blue-800":i.status==="partially_invoiced"?"bg-yellow-100 text-yellow-800":i.status==="fully_invoiced"?"bg-green-100 text-green-800":i.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:i.status==="draft"?"Pending":i.status.replace("_"," ")})]}),i.expectedDelivery&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Expected Delivery:"})," ",Se(i.expectedDelivery)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Customer Details"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Customer:"})," ",O(((Ft=i.customer)==null?void 0:Ft.displayName)||(($t=i.customer)==null?void 0:$t.businessName)||((Rt=i.customer)==null?void 0:Rt.name))||"Walk-in"]}),((qt=i.customer)==null?void 0:qt.email)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",O(i.customer.email)]}),((Ut=i.customer)==null?void 0:Ut.phone)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",O(i.customer.phone)]}),((_t=i.customer)==null?void 0:_t.address)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",O(i.customer.address)]}),((Qt=i.customer)==null?void 0:Qt.contactPerson)&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Contact:"})," ",O(i.customer.contactPerson)]}),e.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:e.jsxs("p",{className:`font-semibold ${(()=>{var n,r;const t=((n=i.customer)==null?void 0:n.pendingBalance)||0,s=((r=i.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:[e.jsx("span",{className:"font-medium",children:(()=>{var n,r;const t=((n=i.customer)==null?void 0:n.pendingBalance)||0,s=((r=i.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Current Payables:":"Current Receivables:"})()})," ",Math.round((()=>{var a,n;const t=((a=i.customer)==null?void 0:a.pendingBalance)||0,s=((n=i.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())]})})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"Items Ordered"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"#"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Unit Price"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Total Price"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.items&&i.items.map((t,s)=>{var a;return e.jsxs("tr",{className:s%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:s+1}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 border-b border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:O(t.product)||"Unknown Product"}),((a=t.product)==null?void 0:a.description)&&e.jsx("div",{className:"text-gray-500 text-xs",children:O(t.product.description)})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 text-right border-b border-gray-200",children:Math.round(t.unitPrice||t.price||0)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 text-right border-b border-gray-200",children:Math.round(t.totalPrice||t.quantity*(t.unitPrice||t.price||0))})]},s)})})]})})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsx("div",{className:"w-80",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium",children:Math.round(i.subtotal||0)})]}),i.tax&&i.tax>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Tax:"}),e.jsx("span",{className:"font-medium",children:Math.round(i.tax)})]}),i.discount&&i.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Discount:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",Math.round(i.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"SO Total:"}),e.jsx("span",{className:"font-medium",children:Math.round(i.total||0)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:(()=>{var n,r;const t=((n=i.customer)==null?void 0:n.pendingBalance)||0,s=((r=i.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Payables:":"Receivables:"})()}),e.jsx("span",{className:`font-medium ${(()=>{var n,r;const t=((n=i.customer)==null?void 0:n.pendingBalance)||0,s=((r=i.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"text-red-600":"text-green-600"})()}`,children:Math.round((()=>{var a,n;const t=((a=i.customer)==null?void 0:a.pendingBalance)||0,s=((n=i.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsxs("span",{children:["Total ",(()=>{var n,r;const t=((n=i.customer)==null?void 0:n.pendingBalance)||0,s=((r=i.customer)==null?void 0:r.advanceBalance)||0;return t-s<0?"Payables":"Receivables"})(),":"]}),e.jsx("span",{className:"text-red-600",children:Math.round((i.total||0)+(()=>{var a,n;const t=((a=i.customer)==null?void 0:a.pendingBalance)||0,s=((n=i.customer)==null?void 0:n.advanceBalance)||0;return Math.abs(t-s)})())})]})]})})}),i.paymentMethod&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Payment Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Method:"})," ",O(i.paymentMethod)]}),i.paymentStatus&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Payment Status:"})," ",O(i.paymentStatus)]})]})]}),i.notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:O(i.notes)})]}),i.terms&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:"Terms & Conditions"}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded border",children:O(i.terms)})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>Ye(i),className:"btn btn-primary flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Print"]}),e.jsx("button",{onClick:()=>{$e(!1),G(null)},className:"btn btn-secondary",children:"Close"})]})]})]})})}),Ss&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Sales Orders"}),e.jsx("button",{onClick:()=>Le(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(lt,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:M==="pdf",onChange:t=>Ie(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:M==="excel",onChange:t=>Ie(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:M==="csv",onChange:t=>Ie(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:M==="json",onChange:t=>Ie(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>Le(!1),className:"btn btn-secondary",disabled:Ke,children:"Cancel"}),e.jsx("button",{type:"button",onClick:ta,className:"btn btn-primary",disabled:Ke,children:Ke?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Export"]})})]})]})})]})}),e.jsx(Aa,{isOpen:hs,onClose:()=>{mt(!1),ut(null)},orderData:gs,documentTitle:"Sales Order",partyLabel:"Customer"}),xs&&Pe&&e.jsx(Ea,{entityType:Pe.type,entityId:Pe.id,entityName:Pe.name,onClose:()=>{ot(!1),dt(null)}})]})};export{Pr as default};
