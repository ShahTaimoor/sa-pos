import{E as se,r as p,R as M,y as f,p as e,S as ae,aA as R,x as re,Q as $,U as ne,ad as le,X as ie,B as S}from"./index-DaTQeIrM.js";import{u as oe}from"./usersApi-8OiecNWZ.js";import{D as ce}from"./ConfirmationDialog-DxRMdj0p.js";import{a as de}from"./useConfirmation-C3qnwA_z.js";import{P as me}from"./plus-CH9F90nm.js";import{P as ue}from"./phone-CmUVKviX.js";import{P as pe}from"./pen-square-CD6kqgaB.js";import{T as xe}from"./trash-2-NO2IJ0Re.js";import"./shield-DyTx0jkP.js";import"./check-circle-C7Swk4iC.js";import"./info-geJWZ_yE.js";const ye=se.injectEndpoints({endpoints:c=>({getEmployees:c.query({query:s=>{const n={};return Object.keys(s).forEach(l=>{const d=s[l];d!==""&&d!==null&&d!==void 0&&(n[l]=d)}),{url:"employees",method:"get",params:n}},providesTags:s=>{var l;const n=((l=s==null?void 0:s.data)==null?void 0:l.employees)||(s==null?void 0:s.employees)||(s==null?void 0:s.items)||[];return n.length?[...n.map(({_id:d,id:j})=>({type:"Users",id:d||j})),{type:"Users",id:"EMPLOYEES_LIST"}]:[{type:"Users",id:"EMPLOYEES_LIST"}]}}),getEmployee:c.query({query:s=>({url:`employees/${s}`,method:"get"}),providesTags:(s,n,l)=>[{type:"Users",id:l}]}),createEmployee:c.mutation({query:s=>({url:"employees",method:"post",data:s}),invalidatesTags:[{type:"Users",id:"EMPLOYEES_LIST"}]}),updateEmployee:c.mutation({query:({id:s,...n})=>({url:`employees/${s}`,method:"put",data:n}),invalidatesTags:(s,n,{id:l})=>[{type:"Users",id:l},{type:"Users",id:"EMPLOYEES_LIST"}]}),deleteEmployee:c.mutation({query:s=>({url:`employees/${s}`,method:"delete"}),invalidatesTags:(s,n,l)=>[{type:"Users",id:l},{type:"Users",id:"EMPLOYEES_LIST"}]}),getDepartments:c.query({query:()=>({url:"employees/departments/list",method:"get"}),providesTags:[{type:"Settings",id:"DEPARTMENTS"}]}),getPositions:c.query({query:()=>({url:"employees/positions/list",method:"get"}),providesTags:[{type:"Settings",id:"POSITIONS"}]})}),overrideExisting:!1}),{useGetEmployeesQuery:he,useCreateEmployeeMutation:ge,useUpdateEmployeeMutation:fe,useDeleteEmployeeMutation:je,useGetDepartmentsQuery:be,useGetPositionsQuery:Ne}=ye,Le=()=>{var A,D,L,U,q,F;const[c,s]=p.useState(""),[n,l]=p.useState(""),[d,j]=p.useState(""),[x,y]=p.useState(1),[g,C]=p.useState(null),[T,b]=p.useState(!1),[a,i]=p.useState({firstName:"",lastName:"",employeeId:"",email:"",phone:"",position:"",department:"",hireDate:new Date().toISOString().split("T")[0],employmentType:"full_time",status:"active",salary:"",hourlyRate:"",payFrequency:"monthly",address:{street:"",city:"",state:"",zipCode:"",country:"US"},userAccount:"",notes:""}),{confirmation:k,confirmDelete:z,handleConfirm:Q,handleCancel:Y}=de(),{data:o,isLoading:N,refetch:G,error:v}=he({search:c,status:n,department:d,page:x,limit:20},{keepPreviousData:!0});M.useEffect(()=>{v&&f(v,"Failed to fetch employees")},[v]);const{data:u}=oe({limit:100},{skip:!T,staleTime:5*60*1e3}),E=M.useMemo(()=>{var t;return((t=u==null?void 0:u.data)==null?void 0:t.users)||(u==null?void 0:u.users)||[]},[u]),{data:w}=be(),{data:ve}=Ne(),I=((A=o==null?void 0:o.data)==null?void 0:A.employees)||(o==null?void 0:o.employees)||[],m=((D=o==null?void 0:o.data)==null?void 0:D.pagination)||(o==null?void 0:o.pagination)||{},[B,{isLoading:P}]=ge(),[H,{isLoading:_}]=fe(),[X,{isLoading:J}]=je(),K=async t=>{try{await B(t).unwrap(),S("Employee created successfully"),h()}catch(r){f(r,"Failed to create employee")}},V=async({id:t,data:r})=>{try{await H({id:t,data:r}).unwrap(),S("Employee updated successfully"),h()}catch(O){f(O,"Failed to update employee")}},W=async t=>{try{await X(t).unwrap(),S("Employee deleted successfully")}catch(r){f(r,"Failed to delete employee")}},h=()=>{i({firstName:"",lastName:"",employeeId:"",email:"",phone:"",position:"",department:"",hireDate:new Date().toISOString().split("T")[0],employmentType:"full_time",status:"active",salary:"",hourlyRate:"",payFrequency:"monthly",address:{street:"",city:"",state:"",zipCode:"",country:"US"},userAccount:"",notes:""}),C(null),b(!1)},Z=t=>{var r;C(t),i({firstName:t.firstName||"",lastName:t.lastName||"",employeeId:t.employeeId||"",email:t.email||"",phone:t.phone||"",position:t.position||"",department:t.department||"",hireDate:t.hireDate?new Date(t.hireDate).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],employmentType:t.employmentType||"full_time",status:t.status||"active",salary:t.salary||"",hourlyRate:t.hourlyRate||"",payFrequency:t.payFrequency||"monthly",address:t.address||{street:"",city:"",state:"",zipCode:"",country:"US"},userAccount:((r=t.userAccount)==null?void 0:r._id)||t.userAccount||"",notes:t.notes||""}),b(!0)},ee=t=>{t.preventDefault();const r={...a};r.employeeId||delete r.employeeId,r.email||delete r.email,r.salary||delete r.salary,r.hourlyRate||delete r.hourlyRate,r.userAccount||delete r.userAccount,g?V({id:g._id,data:r}):K(r)},te=t=>{const r=`${t.firstName} ${t.lastName}`;z(r,"Employee",async()=>{try{await W(t._id)}catch{}})};return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Employees"}),e.jsx("p",{className:"text-gray-600",children:"Manage your staff and employee records"})]}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:c,onChange:t=>{s(t.target.value),y(1)},className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:n,onChange:t=>{l(t.target.value),y(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"terminated",children:"Terminated"}),e.jsx("option",{value:"on_leave",children:"On Leave"})]})}),e.jsx("div",{children:e.jsxs("select",{value:d,onChange:t=>{j(t.target.value),y(1)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Departments"}),(U=(L=w==null?void 0:w.data)==null?void 0:L.departments)==null?void 0:U.map(t=>e.jsx("option",{value:t,children:t},t))]})})]})})}),e.jsxs("div",{className:"card mb-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"h-5 w-5 text-gray-600"}),e.jsxs("h2",{className:"text-lg font-semibold",children:["Employees (",m.total||0,")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>G(),className:"btn btn-secondary btn-sm",disabled:N,children:[e.jsx(re,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:()=>{h(),b(!0)},className:"btn btn-primary btn-sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Add Employee"]})]})]})}),e.jsxs("div",{className:"card-content",children:[N?e.jsx($,{}):I.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No employees found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Employee ID"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Position"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Department"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Contact"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:I.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"font-mono text-sm",children:t.employeeId})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"font-medium",children:[t.firstName," ",t.lastName]})]})}),e.jsx("td",{className:"py-3 px-4",children:t.position}),e.jsx("td",{className:"py-3 px-4",children:t.department||"-"}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"text-sm",children:[t.email&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),t.email]}),t.phone&&e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),t.phone]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="active"?"bg-success-100 text-success-700":t.status==="terminated"?"bg-danger-100 text-danger-700":t.status==="on_leave"?"bg-warning-100 text-warning-700":"bg-gray-100 text-gray-700"}`,children:t.status})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>Z(t),className:"btn btn-secondary btn-sm",title:"Edit",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>te(t),className:"btn btn-danger btn-sm",title:"Delete",children:e.jsx(xe,{className:"h-4 w-4"})})]})})]},t._id))})]})}),m.pages>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(x-1)*(m.limit||20)+1," to"," ",Math.min(x*(m.limit||20),m.total)," of"," ",m.total," employees"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:x===1,className:"btn btn-secondary btn-sm",children:"Previous"}),e.jsx("button",{onClick:()=>y(t=>Math.min(m.pages,t+1)),disabled:x===m.pages,className:"btn btn-secondary btn-sm",children:"Next"})]})]})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:g?"Edit Employee":"Add New Employee"}),e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",required:!0,value:a.firstName,onChange:t=>i({...a,firstName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",required:!0,value:a.lastName,onChange:t=>i({...a,lastName:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee ID"}),e.jsx("input",{type:"text",value:a.employeeId,onChange:t=>i({...a,employeeId:t.target.value.toUpperCase()}),placeholder:"Auto-generated if left empty",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:t=>i({...a,email:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,onChange:t=>i({...a,phone:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Position *"}),e.jsx("input",{type:"text",required:!0,value:a.position,onChange:t=>i({...a,position:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsx("input",{type:"text",value:a.department,onChange:t=>i({...a,department:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hire Date *"}),e.jsx("input",{type:"date",required:!0,value:a.hireDate,onChange:t=>i({...a,hireDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employment Type"}),e.jsxs("select",{value:a.employmentType,onChange:t=>i({...a,employmentType:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"full_time",children:"Full Time"}),e.jsx("option",{value:"part_time",children:"Part Time"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"temporary",children:"Temporary"}),e.jsx("option",{value:"intern",children:"Intern"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:t=>i({...a,status:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"terminated",children:"Terminated"}),e.jsx("option",{value:"on_leave",children:"On Leave"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Link User Account (Optional)"}),e.jsxs("select",{value:a.userAccount,onChange:t=>i({...a,userAccount:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"No User Account"}),E==null?void 0:E.filter(t=>!t.employeeLinked).map(t=>e.jsxs("option",{value:t._id,children:[t.firstName," ",t.lastName," (",t.email,")"]},t._id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to a system user account if employee needs POS access"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:h,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:P||_,children:P||_?e.jsx($,{size:"sm"}):g?"Update Employee":"Add Employee"})]})]})]})})}),e.jsx(ce,{isOpen:k.isOpen,onClose:Y,onConfirm:Q,itemName:((F=(q=k.message)==null?void 0:q.match(/"([^"]*)"/))==null?void 0:F[1])||"",itemType:"Employee",isLoading:J})]})};export{Le as default};
