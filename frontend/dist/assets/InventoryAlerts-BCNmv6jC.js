import{aR as E,r as w,aX as G,aY as I,aZ as Q,p as e,x as U,I as N,P as b,aP as B,Q as D,y as v,B as F,z as k}from"./index-DaTQeIrM.js";import{L as M}from"./loader-2-CNa2rfzn.js";import{Z as W}from"./zap-DvaDprPN.js";import{X}from"./x-circle-CEJfwNq8.js";import{C as Z}from"./check-circle-C7Swk4iC.js";const H=()=>{var g,p;const S=E(),[a,C]=w.useState("all"),[o,A]=w.useState(!1),{data:r,isLoading:i,error:m,refetch:O}=G({includeOutOfStock:a==="all"||a==="critical",includeCritical:a==="all"||a==="critical",includeWarning:a==="all"||a==="warning"},{pollingInterval:3e4}),{data:l}=I(void 0,{pollingInterval:3e4}),[P,{isLoading:h}]=Q(),L=async()=>{var d,y;const s={autoConfirm:o.toString(),supplierPreference:"primary",groupBySupplier:"true"};try{const t=await P(s).unwrap(),j=(t==null?void 0:t.count)||0,f=(t==null?void 0:t.message)||`Successfully generated ${j} purchase order(s)`;if(j>0)F(f),setTimeout(()=>{S("/purchase-orders")},1500);else{let x=f;((d=t==null?void 0:t.unassignedProducts)==null?void 0:d.length)>0&&(x+=`. ${t.unassignedProducts.length} product(s) could not be assigned to suppliers (no purchase history found).`),((y=t==null?void 0:t.errors)==null?void 0:y.length)>0&&(x+=` ${t.errors.length} error(s) occurred during generation.`),k(x)}}catch(t){k(v(t))}},u=((g=r==null?void 0:r.data)==null?void 0:g.data)||(r==null?void 0:r.data)||r||[],n=Array.isArray(u)?u:[],c=((p=l==null?void 0:l.data)==null?void 0:p.data)||(l==null?void 0:l.data)||l||{},$=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"warning":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},T=s=>s>=80?"text-red-600 font-bold":s>=60?"text-orange-600 font-semibold":s>=40?"text-yellow-600":"text-gray-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Inventory Alerts"}),e.jsx("p",{className:"text-gray-600",children:"Monitor low stock and auto-generate purchase orders"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>O(),className:"btn btn-secondary flex items-center",disabled:i,children:[e.jsx(U,{className:`h-4 w-4 mr-2 ${i?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:L,disabled:h||n.length===0,className:"btn btn-primary flex items-center",children:[h?e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(W,{className:"h-4 w-4 mr-2"}),"Generate Purchase Orders"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.total||0})]}),e.jsx(N,{className:"h-8 w-8 text-gray-400"})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg shadow p-4 border-l-4 border-red-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600",children:"Critical"}),e.jsx("p",{className:"text-2xl font-bold text-red-700",children:c.critical||0})]}),e.jsx(X,{className:"h-8 w-8 text-red-400"})]})}),e.jsx("div",{className:"bg-yellow-50 rounded-lg shadow p-4 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600",children:"Warning"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:c.warning||0})]}),e.jsx(N,{className:"h-8 w-8 text-yellow-400"})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg shadow p-4 border-l-4 border-gray-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:c.outOfStock||0})]}),e.jsx(b,{className:"h-8 w-8 text-gray-400"})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg shadow p-4 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:c.lowStock||0})]}),e.jsx(B,{className:"h-8 w-8 text-blue-400"})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Level:"}),e.jsxs("select",{value:a,onChange:s=>C(s.target.value),className:"input",children:[e.jsx("option",{value:"all",children:"All Alerts"}),e.jsx("option",{value:"critical",children:"Critical Only"}),e.jsx("option",{value:"warning",children:"Warning Only"})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-auto",children:[e.jsx("input",{type:"checkbox",id:"autoConfirm",checked:o,onChange:s=>A(s.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"autoConfirm",className:"text-sm text-gray-700",children:"Auto-confirm generated POs"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:i?e.jsx(D,{}):m?e.jsxs("div",{className:"p-6 text-center text-red-600",children:["Error loading alerts: ",v(m).message]}):n.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Z,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"No low stock alerts at this time"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"All products are well stocked!"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reorder Point"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Until Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Suggested Qty"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Urgency"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((s,d)=>e.jsxs("tr",{className:`hover:bg-gray-50 ${s.alertLevel==="critical"?"bg-red-50":""}`,children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{className:"h-5 w-5 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.product.name}),s.product.sku&&e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU: ",s.product.sku]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:s.inventory.currentStock})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.inventory.reorderPoint}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`text-sm font-medium ${T(s.urgency)}`,children:[s.daysUntilOutOfStock," days"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${$(s.alertLevel)}`,children:s.stockStatus==="out_of_stock"?"Out of Stock":s.stockStatus==="critical"?"Critical":"Low Stock"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:s.suggestedReorderQuantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 mr-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.urgency>=80?"bg-red-600":s.urgency>=60?"bg-orange-600":s.urgency>=40?"bg-yellow-600":"bg-gray-400"}`,style:{width:`${s.urgency}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600",children:[s.urgency,"%"]})]})})]},s.product._id))})]})})})]})};export{H as default};
