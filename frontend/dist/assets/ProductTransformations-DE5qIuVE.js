import{E as q,r as u,R as b,p as e,S as A,x as I,Q as _,P as V,X as B,L,B as R,y as F}from"./index-QHzcgHe1.js";import{V as w,e as O,d as C}from"./ValidatedInput-GITFMSOq.js";import{a as M}from"./productsApi-BS7itgd6.js";import{P as $}from"./plus-wthIFHeq.js";import{A as k}from"./alert-circle-Zvregbhl.js";import"./check-circle-pdbRLUjc.js";import"./eye-off-rYnT668Z.js";import"./eye-D8xIUmp0.js";const E=q.injectEndpoints({endpoints:d=>({getTransformations:d.query({query:r=>({url:"product-transformations",method:"get",params:r}),providesTags:r=>{var m;const o=((m=r==null?void 0:r.data)==null?void 0:m.transformations)||(r==null?void 0:r.transformations)||(r==null?void 0:r.items)||[];return o.length?[...o.map(({_id:s,id:l})=>({type:"Products",id:s||l})),{type:"Products",id:"TRANSFORMATIONS_LIST"}]:[{type:"Products",id:"TRANSFORMATIONS_LIST"}]}}),getTransformation:d.query({query:r=>({url:`product-transformations/${r}`,method:"get"}),providesTags:(r,o,m)=>[{type:"Products",id:m}]}),createTransformation:d.mutation({query:r=>({url:"product-transformations",method:"post",data:r}),invalidatesTags:[{type:"Products",id:"TRANSFORMATIONS_LIST"},{type:"Inventory",id:"LIST"}]}),cancelTransformation:d.mutation({query:r=>({url:`product-transformations/${r}/cancel`,method:"put"}),invalidatesTags:(r,o,m)=>[{type:"Products",id:m},{type:"Products",id:"TRANSFORMATIONS_LIST"},{type:"Inventory",id:"LIST"}]})}),overrideExisting:!1}),{useGetTransformationsQuery:Q,useCreateTransformationMutation:G}=E,Z=()=>{const[d,r]=u.useState(""),[o,m]=u.useState(""),[s,l]=u.useState(""),[p,h]=u.useState(!1),{data:c,isLoading:S,refetch:g}=Q({baseProduct:o||void 0,status:s||void 0}),N=b.useMemo(()=>{var t;return((t=c==null?void 0:c.data)==null?void 0:t.transformations)||(c==null?void 0:c.transformations)||[]},[c]),{data:i}=M({}),j=b.useMemo(()=>{var t;return((t=i==null?void 0:i.data)==null?void 0:t.products)||(i==null?void 0:i.products)||[]},[i]),v=()=>{h(!1)},T=[{value:"",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"in_progress",label:"In Progress"},{value:"completed",label:"Completed"},{value:"cancelled",label:"Cancelled"}];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Transformations"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Convert base products to variants and track transformations"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn btn-primary flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"New Transformation"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search transformations...",value:d,onChange:t=>r(t.target.value),className:"input pl-10 w-full"})]}),e.jsx(w,{value:o,onChange:t=>m(t.target.value),options:[{value:"",label:"All Products"},...j.map(t=>({value:t._id,label:t.name}))],className:"w-full"}),e.jsx(w,{value:s,onChange:t=>l(t.target.value),options:T,className:"w-full"}),e.jsxs("button",{onClick:()=>g(),className:"btn btn-secondary flex items-center justify-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Refresh"]})]})}),S?e.jsx(_,{}):N.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No transformations found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating a new product transformation."}),e.jsx("button",{onClick:()=>h(!0),className:"btn btn-primary",children:"New Transformation"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transformation #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Target Variant"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quantity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unit Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performed By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(t=>{var x,y,f,a,n,P;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.transformationNumber})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((x=t.baseProduct)==null?void 0:x.name)||t.baseProductName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",t.baseProductStockBefore," → ",t.baseProductStockAfter]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:((y=t.targetVariant)==null?void 0:y.displayName)||t.targetVariantName}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Stock: ",t.variantStockBefore," → ",t.variantStockAfter]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.quantity}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((f=t.unitTransformationCost)==null?void 0:f.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["$",((a=t.totalTransformationCost)==null?void 0:a.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.transformationDate).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(n=t.performedBy)==null?void 0:n.firstName," ",(P=t.performedBy)==null?void 0:P.lastName]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":t.status==="in_progress"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:t.status})})]},t._id)})})]})})}),p&&e.jsx(U,{products:j,isOpen:p,onClose:v,onSuccess:()=>{g()}})]})},U=({products:d,isOpen:r,onClose:o,onSuccess:m})=>{var y,f;const[s,l]=u.useState({baseProduct:"",targetVariant:"",quantity:1,unitTransformationCost:0,notes:""}),[p,h]=u.useState([]),[c,S]=u.useState(null),[g,N]=u.useState(null),{data:i}=O(s.baseProduct,{skip:!s.baseProduct});b.useEffect(()=>{var n;const a=((n=i==null?void 0:i.data)==null?void 0:n.variants)||(i==null?void 0:i.variants)||[];a.length>0&&h(a)},[i]),b.useEffect(()=>{if(s.baseProduct){const a=d.find(n=>n._id===s.baseProduct);S(a),l(n=>({...n,targetVariant:""}))}},[s.baseProduct,d]),b.useEffect(()=>{if(s.targetVariant){const a=p.find(n=>n._id===s.targetVariant);N(a),a&&l(n=>({...n,unitTransformationCost:a.transformationCost||0}))}},[s.targetVariant,p]);const[j,{isLoading:v}]=G(),T=async a=>{a.preventDefault();try{await j(s).unwrap(),R("Transformation completed successfully"),o(),m(),l({baseProduct:"",targetVariant:"",quantity:1,unitTransformationCost:0,notes:""})}catch(n){F(n,"ProductTransformations")}},t=s.quantity*s.unitTransformationCost,x=((y=c==null?void 0:c.inventory)==null?void 0:y.currentStock)||0;return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Create Product Transformation"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600",children:e.jsx(B,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:T,className:"p-6 space-y-4",children:[e.jsx(w,{label:"Base Product",value:s.baseProduct,onChange:a=>l({...s,baseProduct:a.target.value}),options:[{value:"",label:"Select Base Product"},...d.map(a=>{var n;return{value:a._id,label:`${a.name} (Stock: ${((n=a.inventory)==null?void 0:n.currentStock)||0})`}})],required:!0}),s.baseProduct&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Available Stock"})]}),e.jsxs("p",{className:"text-sm text-blue-700",children:[x," units available for transformation"]})]}),e.jsx(w,{label:"Target Variant",value:s.targetVariant,onChange:a=>l({...s,targetVariant:a.target.value}),options:[{value:"",label:"Select Variant"},...p.filter(a=>a.status==="active").map(a=>{var n;return{value:a._id,label:`${a.displayName} (Current Stock: ${((n=a.inventory)==null?void 0:n.currentStock)||0})`}})],required:!0}),p.length===0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-yellow-600"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"No variants found for this product. Please create a variant first."})]})})]}),e.jsx(C,{label:"Quantity",type:"number",value:s.quantity,onChange:a=>l({...s,quantity:parseInt(a.target.value)||1}),min:"1",max:x,required:!0}),s.quantity>x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-red-600"}),e.jsxs("span",{className:"text-sm text-red-800",children:["Insufficient stock. Available: ",x,", Requested: ",s.quantity]})]})}),e.jsx(C,{label:"Unit Transformation Cost",type:"number",value:s.unitTransformationCost,onChange:a=>l({...s,unitTransformationCost:parseFloat(a.target.value)||0}),min:"0",step:"0.01",required:!0,disabled:!!g}),g&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Using variant default cost:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",((f=g.transformationCost)==null?void 0:f.toFixed(2))||"0.00"]})]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Transformation Cost:"}),e.jsxs("span",{className:"text-lg font-bold text-gray-900",children:["$",t.toFixed(2)]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:s.notes,onChange:a=>l({...s,notes:a.target.value}),rows:3,className:"input w-full",placeholder:"Add any additional notes about this transformation..."})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:o,className:"btn btn-secondary",disabled:v,children:"Cancel"}),e.jsx(L,{type:"submit",isLoading:v,disabled:s.quantity>x||!s.baseProduct||!s.targetVariant,className:"btn btn-primary",children:"Execute Transformation"})]})]})]})}):null};export{Z as default};
