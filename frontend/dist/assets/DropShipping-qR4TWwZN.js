import{E as Pe,r as l,R as B,d as Re,p as e,a1 as Te,U as Ie,P as ke,x as oe,L as _e,O as w}from"./index-QHzcgHe1.js";import{b as qe,m as Be}from"./suppliersApi-TtAmQji1.js";import{a as De}from"./productsApi-BS7itgd6.js";import{S as M}from"./SearchableDropdown-BbCn31BL.js";import{P as de}from"./phone-DmhyAe7y.js";import{P as ue}from"./plus-wthIFHeq.js";import{T as Le}from"./trash-2-G7GOGhVq.js";import{S as Fe}from"./save-CQRiczmt.js";import"./chevron-down-oX_1uWoZ.js";import"./check-CWpXnlSq.js";const $e=Pe.injectEndpoints({endpoints:r=>({getTransactions:r.query({query:n=>({url:"drop-shipping",method:"get",params:n}),providesTags:n=>{var p;const d=((p=n==null?void 0:n.data)==null?void 0:p.transactions)||(n==null?void 0:n.transactions)||(n==null?void 0:n.items)||[];return d.length?[...d.map(({_id:A,id:C})=>({type:"Sales",id:A||C})),{type:"Sales",id:"DROPSHIP_LIST"}]:[{type:"Sales",id:"DROPSHIP_LIST"}]}}),getTransaction:r.query({query:n=>({url:`drop-shipping/${n}`,method:"get"}),providesTags:(n,d,p)=>[{type:"Sales",id:p}]}),createTransaction:r.mutation({query:n=>({url:"drop-shipping",method:"post",data:n}),invalidatesTags:[{type:"Sales",id:"DROPSHIP_LIST"}]}),updateTransaction:r.mutation({query:({id:n,...d})=>({url:`drop-shipping/${n}`,method:"put",data:d}),invalidatesTags:(n,d,{id:p})=>[{type:"Sales",id:p},{type:"Sales",id:"DROPSHIP_LIST"}]}),deleteTransaction:r.mutation({query:n=>({url:`drop-shipping/${n}`,method:"delete"}),invalidatesTags:(n,d,p)=>[{type:"Sales",id:p},{type:"Sales",id:"DROPSHIP_LIST"}]}),updateStatus:r.mutation({query:({id:n,status:d})=>({url:`drop-shipping/${n}/status`,method:"put",data:{status:d}}),invalidatesTags:(n,d,{id:p})=>[{type:"Sales",id:p}]}),getStats:r.query({query:n=>({url:"drop-shipping/stats",method:"get",params:n}),providesTags:[{type:"Reports",id:"DROPSHIP_STATS"}]})}),overrideExisting:!1}),{useCreateTransactionMutation:Oe}=$e,Ve=()=>{var me;const[r,n]=l.useState(null),[d,p]=l.useState(""),[A,C]=l.useState(0),[E,Q]=l.useState(""),[H,G]=l.useState(""),[K,P]=l.useState(0),[D,U]=l.useState(0),[o,z]=l.useState(null),[pe,W]=l.useState(""),[xe,J]=l.useState(0),[N,V]=l.useState("wholesale"),[X,Y]=l.useState(""),[Z,R]=l.useState(0),[L,ee]=l.useState(0),[he,te]=l.useState(0),[g,F]=l.useState(null),[se,T]=l.useState(""),[S,$]=l.useState(1),[I,k]=l.useState(""),[_,j]=l.useState(""),[y,q]=l.useState([]),[ge,ye]=l.useState(new Date().toISOString().split("T")[0]),[ae]=qe(),{data:ne}=Be(void 0,{skip:d.length>0}),[b,le]=B.useState(null);B.useEffect(()=>{d.length>0?ae(d).then(({data:t})=>{le(t)}):le(ne)},[d,ne,ae]);const{data:v}=Re({search:pe,limit:100},{keepPreviousData:!0}),je=B.useMemo(()=>{var t;return((t=v==null?void 0:v.data)==null?void 0:t.customers)||(v==null?void 0:v.customers)||[]},[v]),{data:f}=De({search:se,limit:50},{skip:se.length===0,keepPreviousData:!0}),Ne=B.useMemo(()=>{var t;return((t=f==null?void 0:f.data)==null?void 0:t.products)||(f==null?void 0:f.products)||[]},[f]),[be,{isLoading:ve}]=Oe(),fe=async t=>{var s;try{await be(t).unwrap(),w.success("Drop shipping transaction created successfully"),ie()}catch(a){w.error(((s=a==null?void 0:a.data)==null?void 0:s.message)||(a==null?void 0:a.message)||"Failed to create transaction")}},Se=t=>{n(t),C(t.pendingBalance||0)},we=t=>{z(t);const s=t.pendingBalance||0,a=t.advanceBalance||0,c=s-a;J(c)},Ae=t=>{var s,a,c,x;F(t),T(t.name),k(((s=t.pricing)==null?void 0:s.cost)||0),j(N==="retail"?((a=t.pricing)==null?void 0:a.retail)||0:N==="wholesale"?((c=t.pricing)==null?void 0:c.wholesale)||0:((x=t.pricing)==null?void 0:x.wholesale)||0)};l.useEffect(()=>{var t,s;g&&(N==="retail"?j(((t=g.pricing)==null?void 0:t.retail)||0):N==="wholesale"&&j(((s=g.pricing)==null?void 0:s.wholesale)||0))},[N,g]);const re=()=>{if(!g){w.error("Please select a product");return}const t=S*(I||0),s=S*(_||0),a=s-t,c={product:g,quantity:S,supplierRate:I||0,supplierAmount:t,customerRate:_||0,customerAmount:s,profitAmount:a,profitMargin:s>0?a/s*100:0};q([...y,c]);const x=[...y,c].reduce((u,i)=>u+i.supplierAmount,0),h=[...y,c].reduce((u,i)=>u+i.customerAmount,0);P(x),R(h),F(null),T(""),$(1),k(""),j("")},ce=t=>{const s=y.filter((x,h)=>h!==t);q(s);const a=s.reduce((x,h)=>x+h.supplierAmount,0),c=s.reduce((x,h)=>x+h.customerAmount,0);P(a),R(c)},O=(t,s,a)=>{const c=y.map((u,i)=>{if(i===t){const m={...u,[s]:a};return(s==="quantity"||s==="supplierRate")&&(m.supplierAmount=m.quantity*m.supplierRate),(s==="quantity"||s==="customerRate")&&(m.customerAmount=m.quantity*m.customerRate),m.profitAmount=m.customerAmount-m.supplierAmount,m.profitMargin=m.customerAmount>0?m.profitAmount/m.customerAmount*100:0,m}return u});q(c);const x=c.reduce((u,i)=>u+i.supplierAmount,0),h=c.reduce((u,i)=>u+i.customerAmount,0);P(x),R(h)},Ce=()=>{var s;if(!r){w.error("Please select a supplier");return}if(!o){w.error("Please select a customer");return}if(y.length===0){w.error("Please add at least one product");return}const t={supplier:r._id,customer:o._id,supplierInfo:{companyName:r.companyName,contactPerson:((s=r.contactPerson)==null?void 0:s.name)||"",email:r.email||"",phone:r.phone||""},customerInfo:{displayName:o.displayName||o.name,businessName:o.businessName||"",email:o.email||"",phone:o.phone||"",businessType:o.businessType||""},billNumber:E,supplierDescription:H,customerDescription:X,rateType:N,items:y.map(a=>({product:a.product._id,quantity:a.quantity,supplierRate:a.supplierRate,customerRate:a.customerRate})),transactionDate:ge,supplierPayment:{amount:D,method:D===K?"account":"cash"},customerPayment:{amount:L,method:L===Z?"account":"cash"}};fe(t)},ie=()=>{n(null),p(""),C(0),Q(""),G(""),P(0),U(0),z(null),W(""),J(0),V("wholesale"),Y(""),R(0),ee(0),te(0),F(null),T(""),$(1),k(""),j(""),q([]),ye(new Date().toISOString().split("T")[0])};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Drop Shipping"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage drop shipping transactions"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Te,{className:"h-5 w-5 mr-2 text-blue-600"}),"Supplier Detail"]}),(r==null?void 0:r.phone)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.phone})]})]})}),e.jsxs("div",{className:"card-content space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2 flex-wrap",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Supplier"}),r&&e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsxs("span",{className:`text-sm font-medium ${(A||0)>0?"text-red-600":"text-green-600"}`,children:["$",Math.round(A||0)]})]})]}),e.jsx(M,{placeholder:"Select supplier...",items:((me=b==null?void 0:b.data)==null?void 0:me.suppliers)||(b==null?void 0:b.suppliers)||b||[],onSelect:Se,onSearch:p,displayKey:t=>t.companyName,selectedItem:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bill No"}),e.jsx("input",{type:"text",value:E,onChange:t=>Q(t.target.value),className:"input",placeholder:"Enter bill number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:H,onChange:t=>G(t.target.value),className:"input",rows:"2",placeholder:"Supplier description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Amount"}),e.jsx("input",{type:"number",value:K,className:"input bg-yellow-50 border-yellow-200",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paid Amount"}),e.jsx("input",{type:"number",value:D,onChange:t=>U(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(Ie,{className:"h-5 w-5 mr-2 text-green-600"}),"Customer Detail"]}),(o==null?void 0:o.phone)&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:o.phone})]})]})}),e.jsxs("div",{className:"card-content space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2 flex-wrap",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Customer"}),o&&(()=>{const t=xe||0,s=t<0,a=t>0,c=Math.abs(t)>0,x=o.currentBalance||0,h=o.pendingBalance||0,u=x+h,i=o.creditLimit||0,m=i>0?i-u:0;return e.jsxs("div",{className:"flex items-center gap-x-4 gap-y-1 flex-wrap",children:[c&&e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:s?"Payables:":"Receivables:"}),e.jsxs("span",{className:`text-sm font-medium ${s?"text-red-600":a?"text-green-600":"text-gray-600"}`,children:["$",Math.abs(t).toFixed(2)]})]}),i>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Credit Limit:"}),e.jsxs("span",{className:`text-sm font-medium ${u>=i*.9?"text-red-600":u>=i*.7?"text-yellow-600":"text-blue-600"}`,children:["$",i.toFixed(2)]}),u>=i*.9&&e.jsx("span",{className:"text-xs text-red-600 font-bold ml-1",children:"⚠️"})]}),e.jsxs("div",{className:"flex items-center space-x-1 whitespace-nowrap",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Available Credit:"}),e.jsxs("span",{className:`text-sm font-medium ${m<=i*.1?"text-red-600":m<=i*.3?"text-yellow-600":"text-green-600"}`,children:["$",m.toFixed(2)]})]})]})]})})()]}),e.jsx(M,{placeholder:"Select customer...",items:je,onSelect:we,onSearch:W,displayKey:t=>t.displayName||t.name,selectedItem:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsxs("select",{value:N,onChange:t=>V(t.target.value),className:"input",children:[e.jsx("option",{value:"retail",children:"Retail Price"}),e.jsx("option",{value:"wholesale",children:"Wholesale Price"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:X,onChange:t=>Y(t.target.value),className:"input",rows:"2",placeholder:"Customer description"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Invoice Amount"}),e.jsx("input",{type:"number",value:Z,className:"input bg-yellow-50 border-yellow-200",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Received Amount"}),e.jsx("input",{type:"number",value:L,onChange:t=>ee(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Amount"}),e.jsx("input",{type:"number",value:he,onChange:t=>te(parseFloat(t.target.value)||0),className:"input",placeholder:"0"})]}),e.jsxs("button",{onClick:re,className:"w-full btn btn-success flex items-center justify-center",disabled:!g,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})]}),e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ke,{className:"h-5 w-5 mr-2 text-purple-600"}),"Product Details"]})}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 mb-4",children:[e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product"}),e.jsx(M,{placeholder:"--Select--",items:Ne,onSelect:Ae,onSearch:T,displayKey:t=>t.name,selectedItem:g})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsx("button",{className:"btn btn-secondary w-full mt-7",children:e.jsx(oe,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",value:S,onChange:t=>$(parseInt(t.target.value)||1),className:"input",min:"1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Rate"}),e.jsx("input",{type:"number",value:I,onChange:t=>k(t.target.value),className:"input",placeholder:"0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Amount"}),e.jsx("input",{type:"number",value:S*(I||0),className:"input bg-gray-50",disabled:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Rate"}),e.jsx("input",{type:"number",value:_,onChange:t=>j(t.target.value),className:"input",placeholder:"0"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Amount"}),e.jsx("input",{type:"number",value:S*(_||0),className:"input bg-gray-50",disabled:!0})]})]}),e.jsxs("button",{onClick:re,className:"btn btn-success flex items-center",disabled:!g,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Add"]})]})]}),y.length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Product List"})}),e.jsx("div",{className:"card-content",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b",children:[e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S.No"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S_Rate"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"S_Amount"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"C_Rate"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"C_Amount"}),e.jsx("th",{className:"px-4 py-2 text-left text-sm font-medium text-gray-700",children:"Action"})]})}),e.jsx("tbody",{children:y.map((t,s)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-sm",children:s+1}),e.jsx("td",{className:"px-4 py-2 text-sm font-medium",children:t.product.name}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",value:t.quantity,onChange:a=>{const c=parseFloat(a.target.value)||1;c<=0?ce(s):O(s,"quantity",c)},className:"input text-center h-8 w-20",min:"1"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.supplierRate,onChange:a=>O(s,"supplierRate",parseFloat(a.target.value)||0),className:"input text-center h-8 w-24",min:"0"})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.supplierAmount.toFixed(2)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:t.customerRate,onChange:a=>O(s,"customerRate",parseFloat(a.target.value)||0),className:"input text-center h-8 w-24",min:"0"})}),e.jsx("td",{className:"px-4 py-2 text-sm",children:t.customerAmount.toFixed(2)}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>ce(s),className:"text-red-600 hover:text-red-800",children:e.jsx(Le,{className:"h-4 w-4"})})})]},s))})]})})})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsxs(_e,{onClick:Ce,isLoading:ve,className:"btn btn-primary",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Save"]}),e.jsxs("button",{onClick:ie,className:"btn btn-secondary",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})};export{Ve as default};
