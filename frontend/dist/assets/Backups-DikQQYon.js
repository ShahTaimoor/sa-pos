import{D as _,E as Z,r as y,H as W,R as A,y as b,p as e,J as K,I as M,K as $,aD as J,B as L,aZ as H,x as z,C as X}from"./index-QHzcgHe1.js";import{D as E}from"./ConfirmationDialog-CpWps3pF.js";import{D as N}from"./database-O62o8Dd4.js";import{C as v}from"./check-circle-pdbRLUjc.js";import{Z as F}from"./zap-BY-Fgypn.js";import{U as Y}from"./upload-D2S2_33i.js";import{T as ee}from"./trash-2-G7GOGhVq.js";import"./info-L9xTXcgi.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=_("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=_("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=_("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ae=Z.injectEndpoints({endpoints:s=>({getBackups:s.query({query:a=>({url:"backups",method:"get",params:a}),providesTags:a=>a!=null&&a.backups?[...a.backups.map(({_id:x,backupId:o})=>({type:"Settings",id:x||o})),{type:"Settings",id:"BACKUPS_LIST"}]:[{type:"Settings",id:"BACKUPS_LIST"}]}),getBackupStats:s.query({query:a=>({url:"backups/stats",method:"get",params:{days:a}}),providesTags:[{type:"Settings",id:"BACKUP_STATS"}]}),getSchedulerStatus:s.query({query:()=>({url:"backups/scheduler/status",method:"get"}),providesTags:[{type:"Settings",id:"SCHEDULER_STATUS"}]}),createBackup:s.mutation({query:a=>({url:"backups/create",method:"post",data:a}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"},{type:"Settings",id:"BACKUP_STATS"}]}),restoreBackup:s.mutation({query:({backupId:a,data:x})=>({url:`backups/${a}/restore`,method:"post",data:x}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"}]}),deleteBackup:s.mutation({query:a=>({url:`backups/${a}`,method:"delete"}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"},{type:"Settings",id:"BACKUP_STATS"}]}),retryBackup:s.mutation({query:a=>({url:`backups/${a}/retry`,method:"post"}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"}]}),verifyBackup:s.mutation({query:a=>({url:`backups/${a}/verify`,method:"post"}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"}]}),startScheduler:s.mutation({query:()=>({url:"backups/scheduler/start",method:"post"}),invalidatesTags:[{type:"Settings",id:"SCHEDULER_STATUS"}]}),stopScheduler:s.mutation({query:()=>({url:"backups/scheduler/stop",method:"post"}),invalidatesTags:[{type:"Settings",id:"SCHEDULER_STATUS"}]}),triggerBackup:s.mutation({query:a=>({url:"backups/scheduler/trigger",method:"post",data:a}),invalidatesTags:[{type:"Settings",id:"BACKUPS_LIST"}]})}),overrideExisting:!1}),{useGetBackupsQuery:re,useGetBackupStatsQuery:le,useGetSchedulerStatusQuery:ne,useCreateBackupMutation:ie,useRestoreBackupMutation:ce,useDeleteBackupMutation:oe,useRetryBackupMutation:de,useVerifyBackupMutation:ue,useStartSchedulerMutation:me,useStopSchedulerMutation:xe,useTriggerBackupMutation:he}=ae,pe=({backup:s,onRestore:a,onDelete:x,onRetry:o,onVerify:i})=>{var S,k,B,w,C,T,D;const[d,l]=y.useState(!1),[t,u]=y.useState(null),r=()=>{switch(s.status){case"completed":return e.jsx(v,{className:"h-5 w-5 text-green-500"});case"failed":return e.jsx(M,{className:"h-5 w-5 text-red-500"});case"in_progress":return e.jsx(z,{className:"h-5 w-5 text-blue-500 animate-spin"});case"pending":return e.jsx(X,{className:"h-5 w-5 text-yellow-500"});default:return e.jsx(N,{className:"h-5 w-5 text-gray-500"})}},j=()=>{switch(s.status){case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"in_progress":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},c=h=>{if(!h)return"0 B";const m=1024,p=["B","KB","MB","GB","TB"],g=Math.floor(Math.log(h)/Math.log(m));return parseFloat((h/Math.pow(m,g)).toFixed(2))+" "+p[g]},U=h=>{if(!h)return"N/A";const m=Math.floor(h/1e3),p=Math.floor(m/60),g=Math.floor(p/60);return g>0?`${g}h ${p%60}m`:p>0?`${p}m ${m%60}s`:`${m}s`},f=(h,m={})=>{u({type:h,data:m}),l(!0)},P=()=>{switch(t.type){case"restore":a(s._id,t.data);break;case"delete":x(s._id,t.data);break;case"retry":o(s._id);break;case"verify":i(s._id);break}l(!1),u(null)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[r(),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.backupId}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.type," â€¢ ",s.schedule]})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${j()}`,children:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Size"}),e.jsx("p",{className:"font-medium",children:c((S=s.metadata)==null?void 0:S.compressedSize)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Duration"}),e.jsx("p",{className:"font-medium",children:U((k=s.metadata)==null?void 0:k.duration)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Collections"}),e.jsx("p",{className:"font-medium",children:((B=s.collections)==null?void 0:B.length)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Records"}),e.jsx("p",{className:"font-medium",children:((C=(w=s.metadata)==null?void 0:w.totalRecords)==null?void 0:C.toLocaleString())||0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[((T=s.compression)==null?void 0:T.enabled)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Compressed"]}),((D=s.encryption)==null?void 0:D.enabled)&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Encrypted"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[s.status==="completed"&&e.jsxs("button",{onClick:()=>f("restore",{confirmRestore:!0}),className:"flex-1 btn btn-secondary btn-sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Restore"]}),s.status==="failed"&&e.jsxs("button",{onClick:()=>f("retry"),className:"flex-1 btn btn-primary btn-sm",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Retry"]}),e.jsx("button",{onClick:()=>f("verify"),className:"btn btn-secondary btn-sm",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f("delete",{confirmDelete:!0}),className:"btn btn-danger btn-sm",children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsx(E,{isOpen:d,onClose:()=>l(!1),onConfirm:P,title:`Confirm ${t==null?void 0:t.type}`,message:(t==null?void 0:t.type)==="restore"?"Are you sure you want to restore this backup? This will overwrite current data.":(t==null?void 0:t.type)==="delete"?"Are you sure you want to delete this backup? This action cannot be undone.":(t==null?void 0:t.type)==="retry"?"Are you sure you want to retry this failed backup?":"Are you sure you want to verify this backup?",confirmText:(t==null?void 0:t.type)==="delete"?"Delete":(t==null?void 0:t.type)==="restore"?"Restore":"Confirm",confirmClass:(t==null?void 0:t.type)==="delete"?"btn-danger":"btn-primary"})]})},ge=({status:s,onStart:a,onStop:x,onTrigger:o})=>{const[i,d]=y.useState(!1),[l,t]=y.useState({schedule:"daily",type:"full"}),u=()=>{o(l),d(!1)};return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Backup Scheduler"}),e.jsx("div",{className:"flex items-center space-x-2",children:s.running?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(v,{className:"h-3 w-3 mr-1"}),"Running"]}):e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Stopped"]})})]}),e.jsx("div",{className:"space-y-2 mb-4",children:Object.entries(s.jobs||{}).map(([r,j])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:r}),e.jsxs("div",{className:"flex items-center space-x-2",children:[j.running?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(R,{className:"h-4 w-4 text-gray-400"}),j.nextRun&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Next: ",new Date(j.nextRun).toLocaleString()]})]})]},r))}),e.jsxs("div",{className:"flex space-x-2",children:[s.running?e.jsxs("button",{onClick:x,className:"btn btn-danger btn-sm",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Stop"]}):e.jsxs("button",{onClick:a,className:"btn btn-primary btn-sm",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Start"]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn btn-secondary btn-sm",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),"Trigger"]})]}),e.jsx(E,{isOpen:i,onClose:()=>d(!1),onConfirm:u,title:"Trigger Backup",message:"Select the backup schedule and type to trigger manually:",confirmText:"Trigger",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule"}),e.jsxs("select",{value:l.schedule,onChange:r=>t({...l,schedule:r.target.value}),className:"input",children:[e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),e.jsxs("select",{value:l.type,onChange:r=>t({...l,type:r.target.value}),className:"input",children:[e.jsx("option",{value:"full",children:"Full"}),e.jsx("option",{value:"incremental",children:"Incremental"}),e.jsx("option",{value:"differential",children:"Differential"})]})]})]})})]})},Te=()=>{var q,I;const[s,a]=y.useState({page:1,limit:10,status:"",type:"",schedule:""}),[x,o]=y.useState(!1),[i,d]=y.useState({type:"full",schedule:"manual",compression:!0,encryption:!1});W();const{data:l,isLoading:t,error:u}=re(s,{keepPreviousData:!0});A.useEffect(()=>{u&&b(u,"Backups")},[u]);const{data:r,isLoading:j}=le(30);A.useEffect(()=>{r!=null&&r.error&&b(r.error,"Backup Stats")},[r==null?void 0:r.error]);const{data:c,isLoading:U}=ne(void 0,{pollingInterval:3e4});A.useEffect(()=>{c!=null&&c.error&&b(c.error,"Scheduler Status")},[c==null?void 0:c.error]);const[f,{isLoading:P}]=ie(),[S,{isLoading:k}]=ce(),[B,{isLoading:w}]=oe(),[C,{isLoading:T}]=de(),[D,{isLoading:h}]=ue(),[m,{isLoading:p}]=me(),[g,{isLoading:ye}]=xe(),[je,{isLoading:fe}]=he(),G=async n=>{try{await f(n).unwrap(),L("Backup created successfully"),o(!1)}catch(V){b(V,"Create Backup")}},O=async()=>{try{await m().unwrap(),L("Scheduler started successfully")}catch(n){b(n,"Start Scheduler")}},Q=async()=>{try{await g().unwrap(),L("Scheduler stopped successfully")}catch(n){b(n,"Stop Scheduler")}};return u?e.jsxs(K,{className:"text-center py-8",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx(M,{className:"h-12 w-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error loading backups"}),e.jsx("p",{className:"text-gray-500 mb-4",children:u.message}),e.jsx("button",{onClick:()=>queryClient.invalidateQueries("backups"),className:"btn btn-primary",children:"Try Again"})]}):e.jsxs(K,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Backup Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage automated backups and restore data"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn btn-primary",children:[e.jsx(N,{className:"h-5 w-5 mr-2"}),"Create Backup"]})]}),r&&e.jsxs($,{cols:{default:1,md:2,lg:4},gap:4,children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(N,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Backups"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.totalBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(v,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Successful"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.successfulBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(M,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.failedBackups})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(se,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Size"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.totalSize?(r.totalSize/1024/1024).toFixed(1)+" MB":"0 MB"})]})]})})]}),c&&e.jsx(ge,{status:c,onStart:O,onStop:Q,onTrigger:handleTrigger}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Recent Backups"})}),e.jsx("div",{className:"p-6",children:t?e.jsx(J,{count:3}):((q=l==null?void 0:l.backups)==null?void 0:q.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No backups found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first backup to get started"}),e.jsx("button",{onClick:()=>o(!0),className:"btn btn-primary",children:"Create Backup"})]}):e.jsx($,{cols:{default:1,md:2,lg:3},gap:4,children:(I=l==null?void 0:l.backups)==null?void 0:I.map(n=>e.jsx(pe,{backup:n,onRestore:handleRestore,onDelete:handleDelete,onRetry:handleRetry,onVerify:handleVerify},n._id))})})]}),e.jsx(E,{isOpen:x,onClose:()=>o(!1),onConfirm:G,title:"Create New Backup",message:"Configure your backup settings:",confirmText:"Create Backup",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Backup Type"}),e.jsxs("select",{value:i.type,onChange:n=>d({...i,type:n.target.value}),className:"input",children:[e.jsx("option",{value:"full",children:"Full Backup"}),e.jsx("option",{value:"incremental",children:"Incremental"}),e.jsx("option",{value:"differential",children:"Differential"}),e.jsx("option",{value:"schema_only",children:"Schema Only"}),e.jsx("option",{value:"data_only",children:"Data Only"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Schedule"}),e.jsxs("select",{value:i.schedule,onChange:n=>d({...i,schedule:n.target.value}),className:"input",children:[e.jsx("option",{value:"manual",children:"Manual"}),e.jsx("option",{value:"hourly",children:"Hourly"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.compression,onChange:n=>d({...i,compression:n.target.checked}),className:"form-checkbox"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Compression"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.encryption,onChange:n=>d({...i,encryption:n.target.checked}),className:"form-checkbox"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Encryption"})]})]})]})})]})};export{Te as Backups};
