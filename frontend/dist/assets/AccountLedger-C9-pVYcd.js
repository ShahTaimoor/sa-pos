import{r as o,R as p,y as B,p as t,Q as T,a2 as J}from"./index-QHzcgHe1.js";import{u as K,a as W,b as X}from"./accountLedgerApi-CM1trl4Z.js";const ie=()=>{var $,O,R;const D=(()=>{const e=new Date,i=new Date;return i.setMonth(e.getMonth()-1),{startDate:i.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0]}})(),[a,P]=o.useState(null),[s,w]=o.useState({startDate:D.startDate,endDate:D.endDate,accountCode:"",accountName:"",customerName:"",supplierName:""}),[y,S]=o.useState(""),[j,g]=o.useState(!1),[C,Q]=o.useState(!1),[ee,te]=o.useState(!1),[ae]=K(),[u,m]=o.useState(null),n=o.useRef(null);p.useEffect(()=>{const e=i=>{C&&!i.target.closest(".relative")&&Q(!1),j&&!i.target.closest(".relative")&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[C,j]);const{data:b,isLoading:U}=W(void 0,{onError:e=>B(e,"Error fetching accounts")}),V=o.useMemo(()=>{const e={...s};return a!=null&&a.customerId&&(e.customerId=a.customerId),a!=null&&a.supplierId&&(e.supplierId=a.supplierId),e},[s.startDate,s.endDate,s.accountCode,s.accountName,s.customerName,s.supplierName,a==null?void 0:a.customerId,a==null?void 0:a.supplierId]),I=o.useMemo(()=>a?!1:!(s.accountCode||s.startDate||s.endDate||s.accountName),[a,s.accountCode,s.startDate,s.endDate,s.accountName]),_=o.useMemo(()=>a!=null&&a.customerId?!1:I,[I,a==null?void 0:a.customerId]),{data:r,isLoading:E,refetch:q}=X(V,{skip:_,onError:e=>B(e,"Error fetching ledger entries"),keepUnusedDataFor:300,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1});p.useEffect(()=>{r&&r.data&&(r.data.entries&&r.data.entries.length>0||r.data.summary)&&(m(r),n.current=r)},[r]),p.useEffect(()=>{a!=null&&a.customerId&&(r&&r.data?(m(r),n.current=r):n.current&&!r?m(n.current):u&&!r&&(n.current=u))},[a==null?void 0:a.customerId,r,u]),p.useEffect(()=>{if(!(a!=null&&a.customerId))return;const e=setInterval(()=>{!r&&n.current&&m(n.current)},2e3);return()=>clearInterval(e)},[a==null?void 0:a.customerId,r]),p.useEffect(()=>{!a&&!s.accountCode&&!s.accountName&&(m(null),n.current=null)},[a,s.accountCode,s.accountName]);const G=e=>{P(e),w({...s,accountCode:e.accountCode,accountName:e.accountName}),g(!1),S(e.accountName||e.accountCode)},z=()=>{a&&q().then(e=>{e.data&&(m(e.data),n.current=e.data)})},L=(e,i)=>{w({...s,[e]:i})},x=e=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0}).format(e||0),v=e=>{if(!e)return"";const i=new Date(e),l=i.getDate().toString().padStart(2,"0"),N=i.toLocaleDateString("en-US",{month:"short"}),d=i.getFullYear().toString().slice(-2);return`${l}-${N}-${d}`};if(U)return t.jsx("div",{className:"flex justify-center items-center h-64",children:t.jsx(T,{})});const Y=(($=b==null?void 0:b.data)==null?void 0:$.groupedAccounts)||{},A=Object.values(Y).flat();let c=r;a!=null&&a.customerId?(!c||!c.data||!c.data.entries||c.data.entries.length===0)&&(c=n.current||u):c=r||u||n.current;const h=((O=c==null?void 0:c.data)==null?void 0:O.entries)||[],f=((R=c==null?void 0:c.data)==null?void 0:R.summary)||{},M=A.filter(e=>{if(!y.trim())return!0;const i=y.toLowerCase();return e.accountCode.toLowerCase().includes(i)||e.accountName.toLowerCase().includes(i)||e.description&&e.description.toLowerCase().includes(i)}),k=h.reduce((e,i)=>e+(i.debitAmount||0),0),F=h.reduce((e,i)=>e+(i.creditAmount||0),0),H=f.closingBalance!==void 0?f.closingBalance:(f.openingBalance||0)+k-F;return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 no-print",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[t.jsxs("div",{className:"relative",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account"}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:"Select account...",value:y,onChange:e=>{S(e.target.value),g(!0)},onFocus:()=>g(!0),className:"input w-full"}),j&&M.length>0&&t.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",children:M.slice(0,50).map(e=>t.jsxs("button",{onClick:()=>G(e),className:`w-full text-left px-4 py-2 hover:bg-gray-50 ${(a==null?void 0:a._id)===e._id?"bg-orange-50":""}`,children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.accountName||e.accountCode}),e.accountName&&t.jsx("div",{className:"text-xs text-gray-500",children:e.accountCode})]},e._id))})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"From Date"}),t.jsx("input",{type:"date",value:s.startDate,onChange:e=>L("startDate",e.target.value),className:"input w-full"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"To Date"}),t.jsx("input",{type:"date",value:s.endDate,onChange:e=>L("endDate",e.target.value),className:"input w-full"})]}),t.jsx("div",{children:t.jsx("button",{onClick:z,className:"btn btn-primary w-full",disabled:!a,children:"View"})})]})}),a&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg",children:[t.jsxs("div",{className:"p-6 border-b border-gray-200",children:[t.jsx("h2",{className:"text-2xl font-bold italic text-center mb-2",children:"Account Ledger"}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-lg font-bold italic",children:a.accountName||a.accountCode}),s.startDate&&s.endDate&&t.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["From: ",v(s.startDate)," To: ",v(s.endDate)]})]})]}),t.jsx("div",{className:"overflow-x-auto",children:E?t.jsx("div",{className:"flex justify-center items-center py-12",children:t.jsx(T,{})}):t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Date"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Voucher No"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase",children:"Particular"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Debits"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Credits"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase",children:"Balance"})]})}),t.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[t.jsxs("tr",{className:"bg-gray-50",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:"Opening Balance:"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right font-bold text-gray-900",children:x(Math.abs(f.openingBalance||0))})]}),h.map((e,i)=>{var N;let l=e.description||"";if(e.customer){const d=typeof e.customer=="string"?e.customer:e.customer.businessName||`${e.customer.firstName||""} ${e.customer.lastName||""}`.trim()||e.customer.displayName||e.customer.name;d&&(l=l?`${l} - ${d}`:d)}if(e.supplier){const d=typeof e.supplier=="string"?e.supplier:e.supplier.companyName||((N=e.supplier.contactPerson)==null?void 0:N.name)||e.supplier.name||`${e.supplier.firstName||""} ${e.supplier.lastName||""}`.trim();d&&(l=l?`${l} - ${d}`:d)}return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:v(e.date)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.reference||"-"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:l||"-"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:e.debitAmount>0?x(e.debitAmount):"-"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:e.creditAmount>0?x(e.creditAmount):"-"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-900",children:x(Math.abs(e.balance||0))})]},i)}),h.length>0&&t.jsxs("tr",{className:"bg-gray-100 font-bold",children:[t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900"}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:"Total"}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:x(k)}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:x(F)}),t.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:x(Math.abs(H))})]})]})]})}),t.jsxs("div",{className:"p-4 border-t border-gray-200 flex justify-between text-xs text-gray-600",children:[t.jsxs("div",{children:["Print Date: ",new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})]}),t.jsx("div",{children:"Page: 1 of 1"})]})]}),!a&&!E&&t.jsxs("div",{className:"text-center py-12 bg-white border border-gray-200 rounded-lg",children:[t.jsx(J,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500",children:"Select an account and click View to see ledger entries"})]})]})};export{ie as default};
