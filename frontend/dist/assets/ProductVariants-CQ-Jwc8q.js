import{r as d,p as e,S as _,x as B,Q as z,P as W,R as N,X as $,L as O,B as D,y as U}from"./index-QHzcgHe1.js";import{u as G,a as Q,V as g,b as I,c as K,d as c}from"./ValidatedInput-GITFMSOq.js";import{a as X}from"./productsApi-BS7itgd6.js";import{D as H}from"./ConfirmationDialog-CpWps3pF.js";import{a as J}from"./useConfirmation-BFyzFbUJ.js";import{P as Y}from"./plus-wthIFHeq.js";import{P as Z}from"./pen-square-D_ZZfkE6.js";import{T as ee}from"./trash-2-G7GOGhVq.js";import"./alert-circle-Zvregbhl.js";import"./check-circle-pdbRLUjc.js";import"./eye-off-rYnT668Z.js";import"./eye-D8xIUmp0.js";import"./info-L9xTXcgi.js";const ye=()=>{var v,C;const[s,n]=d.useState(""),[u,m]=d.useState(""),[x,y]=d.useState(""),[h,o]=d.useState(!1),[b,a]=d.useState(null),{data:i,isLoading:f,refetch:p}=G({baseProduct:u||void 0,variantType:x||void 0,search:s||void 0}),{data:t}=X({}),l=(i==null?void 0:i.variants)||((v=i==null?void 0:i.data)==null?void 0:v.variants)||[],w=(t==null?void 0:t.products)||((C=t==null?void 0:t.data)==null?void 0:C.products)||[],[ae,{isLoading:se}]=Q(),{isDeleteDialogOpen:F,itemToDelete:j,openDeleteDialog:L,closeDeleteDialog:E,confirmDelete:R}=J(),q=r=>{a(r),o(!0)},A=()=>{o(!1),a(null)},M=[{value:"",label:"All Types"},{value:"color",label:"Color"},{value:"warranty",label:"Warranty"},{value:"size",label:"Size"},{value:"finish",label:"Finish"},{value:"custom",label:"Custom"}];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Product Variants"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage product variants and transformations"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Add Variant"]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search variants...",value:s,onChange:r=>n(r.target.value),className:"input pl-10 w-full"})]}),e.jsx(g,{value:u,onChange:r=>m(r.target.value),options:[{value:"",label:"All Products"},...w.map(r=>({value:r._id,label:r.name}))],className:"w-full"}),e.jsx(g,{value:x,onChange:r=>y(r.target.value),options:M,className:"w-full"}),e.jsxs("button",{onClick:()=>p(),className:"btn btn-secondary flex items-center justify-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Refresh"]})]})}),f?e.jsx(z,{}):l.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx(W,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No variants found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Get started by creating a new product variant."}),e.jsx("button",{onClick:()=>o(!0),className:"btn btn-primary",children:"Add Variant"})]}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Base Product"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Variant Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Retail Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transformation Cost"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map(r=>{var V,P,k,S,T;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((V=r.baseProduct)==null?void 0:V.name)||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:r.displayName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:r.variantType})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.variantValue}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((P=r.inventory)==null?void 0:P.currentStock)||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((S=(k=r.pricing)==null?void 0:k.retail)==null?void 0:S.toFixed(2))||"0.00"]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",((T=r.transformationCost)==null?void 0:T.toFixed(2))||"0.00"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r.status==="active"?"bg-green-100 text-green-800":r.status==="inactive"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:r.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>q(r),className:"text-blue-600 hover:text-blue-900",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>L(r._id,r.displayName),className:"text-red-600 hover:text-red-900",children:e.jsx(ee,{className:"h-4 w-4"})})]})})]},r._id)})})]})})}),h&&e.jsx(te,{variant:b,products:w,isOpen:h,onClose:A,onSuccess:()=>{p()}}),e.jsx(H,{isOpen:F,onClose:E,onConfirm:R,itemName:(j==null?void 0:j.name)||"",itemType:"variant"})]})},te=({variant:s,products:n,isOpen:u,onClose:m,onSuccess:x})=>{const[y,{isLoading:h}]=I(),[o,{isLoading:b}]=K(),[a,i]=d.useState({baseProduct:"",variantName:"",variantType:"color",variantValue:"",displayName:"",description:"",pricing:{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:0,sku:"",status:"active"});N.useEffect(()=>{var t;i(s?{baseProduct:((t=s.baseProduct)==null?void 0:t._id)||s.baseProduct||"",variantName:s.variantName||"",variantType:s.variantType||"color",variantValue:s.variantValue||"",displayName:s.displayName||"",description:s.description||"",pricing:s.pricing||{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:s.transformationCost||0,sku:s.sku||"",status:s.status||"active"}:{baseProduct:"",variantName:"",variantType:"color",variantValue:"",displayName:"",description:"",pricing:{cost:0,retail:0,wholesale:0,distributor:0},transformationCost:0,sku:"",status:"active"})},[s,u]),N.useEffect(()=>{if(a.baseProduct&&a.variantValue){const t=n.find(l=>l._id===a.baseProduct);t&&!s&&i(l=>({...l,displayName:`${t.name} - ${a.variantValue}`}))}},[a.baseProduct,a.variantValue,n,s]),N.useEffect(()=>{if(a.baseProduct&&!s){const t=n.find(l=>l._id===a.baseProduct);t&&i(l=>({...l,pricing:{cost:t.pricing.cost+l.transformationCost,retail:t.pricing.retail+l.transformationCost,wholesale:t.pricing.wholesale+l.transformationCost,distributor:t.pricing.distributor?t.pricing.distributor+l.transformationCost:0}}))}},[a.baseProduct,a.transformationCost,n,s]);const f=async t=>{t.preventDefault();try{s?(await o({id:s._id,...a}).unwrap(),D("Variant updated successfully")):(await y(a).unwrap(),D("Variant created successfully")),m(),x()}catch(l){U(l,"ProductVariants")}},p=h||b;return u?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s?"Edit Variant":"Create Variant"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx($,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:f,className:"p-6 space-y-4",children:[e.jsx(g,{label:"Base Product",value:a.baseProduct,onChange:t=>i({...a,baseProduct:t.target.value}),options:[{value:"",label:"Select Base Product"},...n.map(t=>({value:t._id,label:t.name}))],required:!0,disabled:!!s}),e.jsx(g,{label:"Variant Type",value:a.variantType,onChange:t=>i({...a,variantType:t.target.value}),options:[{value:"color",label:"Color"},{value:"warranty",label:"Warranty"},{value:"size",label:"Size"},{value:"finish",label:"Finish"},{value:"custom",label:"Custom"}],required:!0,disabled:!!s}),e.jsx(c,{label:"Variant Value",type:"text",value:a.variantValue,onChange:t=>i({...a,variantValue:t.target.value}),placeholder:"e.g., Red, With Warranty, Large",required:!0,disabled:!!s}),e.jsx(c,{label:"Display Name",type:"text",value:a.displayName,onChange:t=>i({...a,displayName:t.target.value}),placeholder:"e.g., Spoiler - Red",required:!0}),e.jsx(c,{label:"Transformation Cost (per unit)",type:"number",value:a.transformationCost,onChange:t=>i({...a,transformationCost:parseFloat(t.target.value)||0}),min:"0",step:"0.01",required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{label:"Retail Price",type:"number",value:a.pricing.retail,onChange:t=>i({...a,pricing:{...a.pricing,retail:parseFloat(t.target.value)||0}}),min:"0",step:"0.01",required:!0}),e.jsx(c,{label:"Wholesale Price",type:"number",value:a.pricing.wholesale,onChange:t=>i({...a,pricing:{...a.pricing,wholesale:parseFloat(t.target.value)||0}}),min:"0",step:"0.01",required:!0})]}),e.jsx(c,{label:"SKU (optional)",type:"text",value:a.sku,onChange:t=>i({...a,sku:t.target.value}),placeholder:"Auto-generated if left empty"}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:m,className:"btn btn-secondary",disabled:p,children:"Cancel"}),e.jsx(O,{type:"submit",isLoading:p,className:"btn btn-primary",children:s?"Update":"Create"})]})]})]})}):null};export{ye as default};
