import{r as l,u as We,ab as Xe,ac as Ye,a6 as Ze,a7 as He,a8 as et,a9 as tt,aa as st,R as ge,p as e,a1 as at,ad as rt,ae as nt,P as ct,A as ot,O as h,v as it,L as lt,af as dt}from"./index-QHzcgHe1.js";import{a as ut}from"./productsApi-BS7itgd6.js";import{b as mt,a as xt}from"./suppliersApi-TtAmQji1.js";import{u as pt}from"./banksApi-JqBGwRpS.js";import{u as ht}from"./useFuzzySearch-CPK0wZPc.js";import{S as ve}from"./SearchableDropdown-BbCn31BL.js";import{P as ft}from"./PrintModal-C-XpLZIw.js";import{g as bt}from"./ComponentRegistry-3QDFiXUw.js";import{D as yt}from"./download-ULFDWFy_.js";import{P as je}from"./plus-wthIFHeq.js";import{P as gt}from"./phone-DmhyAe7y.js";import{T as Ne}from"./trash-2-G7GOGhVq.js";import{X as vt}from"./x-circle-DZheaYy1.js";import"./chevron-down-oX_1uWoZ.js";import"./check-CWpXnlSq.js";import"./useCompanyInfo-CJ-A3-l8.js";import"./settingsApi-D-e2N-LC.js";import"./printer-Dmqc0NC_.js";const jt=({item:k,index:d,onUpdateQuantity:y,onUpdateCost:v,onRemove:s})=>{var w,U,f,D,_;const N=k.costPerUnit*k.quantity,E=((U=(w=k.product)==null?void 0:w.inventory)==null?void 0:U.currentStock)||0,R=((D=(f=k.product)==null?void 0:f.inventory)==null?void 0:D.reorderPoint)||0,T=E<=R;return e.jsx("div",{className:`py-1 ${d%2===0?"bg-white":"bg-gray-50"}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-medium text-gray-700 bg-gray-50 px-0.5 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:d+1})}),e.jsx("div",{className:"col-span-6 flex items-center h-8",children:e.jsxs("span",{className:"font-medium text-sm truncate",children:[((_=k.product)==null?void 0:_.name)||"Unknown Product",T&&e.jsx("span",{className:"text-yellow-600 text-xs ml-2",children:"⚠️ Low Stock"})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:E})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",value:k.quantity,onChange:j=>{var F;return y((F=k.product)==null?void 0:F._id,parseInt(j.target.value)||1)},className:"input text-center h-8",min:"1"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("input",{type:"number",step:"0.01",value:k.costPerUnit,onChange:j=>{var F;return v((F=k.product)==null?void 0:F._id,parseFloat(j.target.value)||0)},className:"input text-center h-8",min:"0"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-8 flex items-center justify-center",children:N.toFixed(2)})}),e.jsx("div",{className:"col-span-1",children:e.jsx("button",{onClick:()=>{var j;return s((j=k.product)==null?void 0:j._id)},className:"btn btn-danger btn-sm h-8 w-full",children:e.jsx(Ne,{className:"h-4 w-4"})})})]})})},Nt=({onAddProduct:k,onRefetchReady:d})=>{const[y,v]=l.useState(""),[s,N]=l.useState(null),[E,R]=l.useState(1),[T,w]=l.useState("0"),U=l.useRef(null),{data:f,isLoading:D,error:_,refetch:j}=ut({limit:100,status:"active"},{keepPreviousData:!0,staleTime:0,refetchOnMountOrArgChange:!0});l.useEffect(()=>{d&&j&&typeof j=="function"&&d(j)},[d,j]);const F=ge.useMemo(()=>{var u,B,L;return f?Array.isArray(f)?f:(u=f==null?void 0:f.data)!=null&&u.products?f.data.products:f!=null&&f.products?f.products:(L=(B=f==null?void 0:f.data)==null?void 0:B.data)!=null&&L.products?f.data.data.products:[]:[]},[f]),O=ht(F,y,["name","description","brand","barcode","sku"],{threshold:.4,minScore:.3,limit:10}),W=u=>{N(u),w(u.pricing.cost.toString()),v(u.name)},A=()=>{if(s){if(!T||parseFloat(T)<=0){h.error("Please enter a valid cost per unit");return}k({product:s,quantity:E,costPerUnit:parseFloat(T)}),N(null),R(1),w("0"),v(""),setTimeout(()=>{U.current&&U.current.focus()},100)}},ae=u=>e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",u.inventory.currentStock]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Cost: ",Math.round(u.pricing.cost)]})]})]});return e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-7",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx(ve,{ref:U,placeholder:"Search or select product...",items:O||[],onSelect:W,onSearch:u=>{v(u),s&&u!==s.name&&(N(null),w("0"))},displayKey:ae,selectedItem:s,loading:D,emptyMessage:y.length>0?"No products found":"Start typing to search products...",value:s?s.name:y,showSelected:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 bg-gray-100 px-2 py-1 rounded border border-gray-200 block text-center h-10 flex items-center justify-center",children:s?s.inventory.currentStock:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",value:E,onChange:u=>R(parseInt(u.target.value)||1),onKeyDown:u=>{u.key==="Enter"&&s&&(u.preventDefault(),A())},className:"input text-center",placeholder:"1 (Enter to add & focus search)"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cost"}),e.jsx("input",{type:"number",step:"1",value:T,onChange:u=>w(u.target.value),onKeyDown:u=>{u.key==="Enter"&&s&&(u.preventDefault(),A())},className:"input text-center",placeholder:"0 (Enter to add & focus search)",required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"text",value:s?Math.round(E*parseFloat(T||0)):"",className:"input text-center font-medium",disabled:!0,placeholder:""})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:A,className:"w-full btn btn-primary flex items-center justify-center px-3 py-2",disabled:!s,title:"Add to cart (or press Enter in Quantity/Cost fields - focus returns to search)",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})})},zt=({tabId:k,editData:d})=>{var be,ye;const[y,v]=l.useState([]),[s,N]=l.useState(null),[E,R]=l.useState(""),[T,w]=l.useState(""),[U,f]=l.useState(!0),[D,_]=l.useState(new Date().toISOString().split("T")[0]),[j,F]=l.useState(""),[O,W]=l.useState(!0),[A,ae]=l.useState(!1),u=l.useRef(null),[B,L]=l.useState("cash"),[I,re]=l.useState(0),[P,X]=l.useState({type:"amount",value:0}),[we,le]=l.useState(!1),[Pe,de]=l.useState(null),[Se,Y]=l.useState(!1),[M,Z]=l.useState("pdf"),[ne,ue]=l.useState(!1),me=(()=>{const t=new Date,a=new Date;a.setMonth(t.getMonth()-1);const o=r=>{const c=r.getFullYear(),p=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0");return`${c}-${p}-${n}`};return{from:o(a),to:o(t)}})(),[G,H]=l.useState(me.from),[ee,te]=l.useState(me.to),{updateTabTitle:xe,getActiveTab:pe,openTab:ke}=We(),[q,Ce]=l.useState(null),[z,{data:ce,isLoading:Ee,refetch:Te}]=mt(),{data:Pt}=pt(),[Ue]=Xe(),[Fe]=Ye(),[Me]=Ze(),[Ie]=He(),[Ae]=et(),[$e]=tt(),[Re]=st();l.useEffect(()=>{const t=()=>{ae(window.innerWidth<768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),l.useEffect(()=>{u.current&&u.current.focus()},[]),l.useEffect(()=>{if(d&&d.isEditMode&&d.invoiceId&&(d.supplier&&N(d.supplier),d.invoiceNumber&&(w(d.invoiceNumber),f(!1)),d.notes&&F(d.notes),d.items&&d.items.length>0)){const t=d.items.map(a=>({product:a.product,quantity:a.quantity,costPerUnit:a.unitCost||a.costPerUnit,totalCost:a.totalCost||a.quantity*(a.unitCost||a.costPerUnit)}));v(t)}},[d==null?void 0:d.invoiceId]);const{data:J,refetch:Q}=xt(s==null?void 0:s._id,{skip:!(s!=null&&s._id),staleTime:0,refetchOnMountOrArgChange:!0});l.useEffect(()=>{J!=null&&J.data&&N(J.data)},[J]),l.useEffect(()=>{E.length>0&&z(E)},[E,z]);const C=ge.useMemo(()=>ce||{data:{suppliers:[]}},[ce]);l.useEffect(()=>{var t;if(s&&((t=C==null?void 0:C.data)!=null&&t.suppliers)){const a=C.data.suppliers.find(o=>o._id===s._id);a&&(a.pendingBalance!==s.pendingBalance||a.advanceBalance!==s.advanceBalance||a.currentBalance!==s.currentBalance)&&N(a)}},[(be=C==null?void 0:C.data)==null?void 0:be.suppliers]);const oe=t=>{if(!t)return"";const a=new Date,o=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0"),p=String(a.getTime()).slice(-6),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`PO-${(t.companyName||t.name||"SUP").split(" ").map(x=>x.charAt(0).toUpperCase()).join("").substring(0,3)}-${o}${r}${c}-${p}-${n}`},De=t=>{N(t),U&&t&&w(oe(t));const a=pe();a&&t&&xe(a.id,`Purchase - ${t.displayName}`),y.length>0&&!(d!=null&&d.isEditMode)&&(v([]),h.success("Purchase items cleared due to supplier change. Please re-add products."))},Oe=async t=>{var a,o,r,c,p;try{const n=await Ue(t).unwrap(),g=((a=n==null?void 0:n.invoice)==null?void 0:a.invoiceNumber)||((r=(o=n==null?void 0:n.data)==null?void 0:o.invoice)==null?void 0:r.invoiceNumber)||"Unknown",S=((n==null?void 0:n.inventoryUpdates)||((c=n==null?void 0:n.data)==null?void 0:c.inventoryUpdates)||[]).filter(b=>b.success).length;if(h.success(`Purchase invoice created successfully! Invoice ${g} created and ${S} products added to inventory.`),q&&typeof q=="function")try{q()}catch{}if(Q&&typeof Q=="function")try{Q().then(b=>{var m;(m=b==null?void 0:b.data)!=null&&m.data&&N(b.data.data)}).catch(b=>{})}catch{}if(s&&z){const b=s.companyName||s.name||"";b&&z(b)}v([]),re(0),L("cash"),w(""),_(new Date().toISOString().split("T")[0]),F("");const x=pe();x&&xe(x.id,"Purchase")}catch(n){h.error(((p=n==null?void 0:n.data)==null?void 0:p.message)||(n==null?void 0:n.message)||"Failed to complete purchase")}},_e=async(t,a)=>{var o,r,c,p,n,g;try{const i=await Fe({id:t,...a}).unwrap(),S=((o=i==null?void 0:i.invoice)==null?void 0:o.invoiceNumber)||((c=(r=i==null?void 0:i.data)==null?void 0:r.invoice)==null?void 0:c.invoiceNumber)||"Unknown",b=((i==null?void 0:i.inventoryUpdates)||((p=i==null?void 0:i.data)==null?void 0:p.inventoryUpdates)||[]).filter(m=>m.success).length;if(h.success(`Purchase invoice updated successfully! Invoice ${S} updated and ${b} products adjusted in inventory.`),q&&typeof q=="function")try{q()}catch{}if(s!=null&&s._id&&Q&&typeof Q=="function")try{Q().then(m=>{var V;(V=m==null?void 0:m.data)!=null&&V.data&&N(m.data.data)}).catch(m=>{var V;(V=m==null?void 0:m.message)!=null&&V.includes("has not been started")})}catch(m){(n=m==null?void 0:m.message)!=null&&n.includes("has not been started")}if(s&&z)try{const m=s.companyName||s.name||"";m&&z(m)}catch{}}catch(i){h.error(((g=i==null?void 0:i.data)==null?void 0:g.message)||(i==null?void 0:i.message)||"Failed to update purchase")}},Be=()=>{if(O||!s)return 0;const t=y.reduce((o,r)=>o+r.costPerUnit*r.quantity,0);let a=0;switch(s.businessType){case"manufacturer":a=.06;break;case"distributor":a=.07;break;case"wholesaler":a=.08;break;case"dropshipper":a=.05;break;default:a=.08}return s.rating>=5&&s.reliability==="excellent"&&(a*=.5),t*a},K=y.reduce((t,a)=>t+a.costPerUnit*a.quantity,0),se=Be(),ie=P.type==="percentage"?K*P.value/100:P.value,$=K+se-ie,he=(s==null?void 0:s.pendingBalance)||0,Le=$+he,qe=t=>{v(a=>{var r;const o=a.find(c=>{var p,n;return((p=c.product)==null?void 0:p._id)===((n=t.product)==null?void 0:n._id)});return o?window.confirm(`"${((r=t.product)==null?void 0:r.name)||"Unknown Product"}" is already in the cart (Qty: ${o.quantity}).

Do you want to add ${t.quantity} more units?`)?a.map(p=>{var n,g;return((n=p.product)==null?void 0:n._id)===((g=t.product)==null?void 0:g._id)?{...p,quantity:p.quantity+t.quantity,costPerUnit:t.costPerUnit}:p}):a:[...a,t]})},ze=(t,a)=>{if(a<=0){fe(t);return}v(o=>o.map(r=>{var c;return((c=r.product)==null?void 0:c._id)===t?{...r,quantity:a}:r}))},Qe=(t,a)=>{v(o=>o.map(r=>{var c;return((c=r.product)==null?void 0:c._id)===t?{...r,costPerUnit:a}:r}))},fe=t=>{v(a=>a.filter(o=>{var r;return((r=o.product)==null?void 0:r._id)!==t}))},Ge=()=>{v(t=>{if(!t||t.length<2)return t;const a=r=>{const c=r.product;return c?typeof c=="string"?c:c.name||c.title||c.displayName||c.businessName||c.fullName||"":""};return[...t].sort((r,c)=>{const p=a(r).toString().toLowerCase(),n=a(c).toString().toLowerCase();return p<n?-1:p>n?1:0})})},Je=()=>{Y(!0)},Ke=async()=>{var t,a,o;ue(!0);try{const r={...(s==null?void 0:s._id)&&{supplier:s._id},...G&&{dateFrom:G},...ee&&{dateTo:ee}};let c;if(M==="excel"?c=await Me(r).unwrap():M==="csv"?c=await Ie(r).unwrap():M==="json"?c=await $e(r).unwrap():M==="pdf"&&(c=await Ae(r).unwrap()),c!=null&&c.filename||(t=c==null?void 0:c.data)!=null&&t.filename){const p=c.filename||c.data.filename;try{M==="pdf"&&await new Promise(i=>setTimeout(i,500));let n;try{n=await Re(p).unwrap()}catch(i){const S=(i==null?void 0:i.data)||((a=i==null?void 0:i.response)==null?void 0:a.data);if(S instanceof Blob){const x=new FileReader;x.onload=()=>{const b=x.result;try{const m=JSON.parse(b);h.error(m.message||"Download failed")}catch{h.error("Download failed")}},x.readAsText(S)}else typeof S=="object"&&S!==null?h.error(S.message||"Download failed"):h.error((i==null?void 0:i.message)||"Download failed");return}if(!n){h.error("Download failed: No data received from server");return}const g=n instanceof Blob?n:n.data;if(M==="pdf"){if(!g||!(g instanceof Blob)){h.error("Invalid PDF file received");return}if(g.size===0){h.error("PDF file is empty");return}if(g.type&&(g.type.includes("application/json")||g.type.includes("text/html"))){const x=new FileReader;x.onload=()=>{const b=x.result;try{const m=JSON.parse(b);h.error(m.message||"File not found or generation failed")}catch{h.error("Server returned error instead of PDF. Please try again.")}},x.readAsText(g);return}const i=URL.createObjectURL(g);if(window.open(i,"_blank"))h.success("PDF opened in new tab");else{const x=document.createElement("a");x.href=i,x.download=p,document.body.appendChild(x),x.click(),document.body.removeChild(x),h.success("PDF downloaded (popup was blocked)")}setTimeout(()=>URL.revokeObjectURL(i),1e4)}else{const i=n instanceof Blob?n:n.data,S=URL.createObjectURL(i),x=document.createElement("a");x.href=S,x.download=p,document.body.appendChild(x),x.click(),document.body.removeChild(x),setTimeout(()=>URL.revokeObjectURL(S),100),h.success(`${M.toUpperCase()} file downloaded successfully`)}Y(!1)}catch{h.error("Failed to download file")}}else h.error("Export failed: No filename received")}catch(r){h.error("Failed to export purchase data: "+(((o=r==null?void 0:r.data)==null?void 0:o.message)||(r==null?void 0:r.message)||"Unknown error"))}finally{ue(!1)}},Ve=()=>{if(y.length===0){h.error("No items to purchase");return}if(!s){h.error("Please select a supplier");return}let t=T;(!t||t.trim()==="")&&U&&(t=oe(s),w(t)),(!t||t.trim()==="")&&(t=oe(s),w(t));const a={supplier:s._id,supplierInfo:{name:s.name,email:s.email,phone:s.phone,companyName:s.companyName,address:s.address},items:y.map(o=>{var r;return{product:(r=o.product)==null?void 0:r._id,quantity:o.quantity,unitCost:o.costPerUnit,totalCost:o.quantity*o.costPerUnit}}),pricing:{subtotal:K,discountAmount:0,taxAmount:se,isTaxExempt:O,total:$},payment:{method:B,amount:I,remainingBalance:Math.max(0,$-I),isPartialPayment:I>0&&I<$,status:I>=$?"paid":I>0?"partial":"pending"},invoiceNumber:t,expectedDelivery:D,notes:j,terms:""};d!=null&&d.isEditMode?_e(d.invoiceId,a):Oe(a)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:`flex ${A?"flex-col space-y-4":"items-start justify-between"}`,children:[e.jsxs("div",{children:[e.jsx("h1",{className:`${A?"text-xl":"text-2xl"} font-bold text-gray-900`,children:"Purchase"}),e.jsx("p",{className:"text-gray-600",children:"Process purchase transactions"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:Je,className:"btn btn-secondary btn-md",title:"Export Purchase Report",children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Export Purchase Report"]}),e.jsxs("button",{onClick:()=>{const t=bt("/purchase");if(t){const a=`tab_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;ke({title:"Purchase",path:"/purchase",component:t.component,icon:t.icon,allowMultiple:!0,props:{tabId:a}})}},className:"btn btn-primary btn-md",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"New Purchase"]})]})]}),e.jsxs("div",{className:`flex ${A?"flex-col space-y-4":"items-start space-x-4"}`,children:[e.jsxs("div",{className:`${A?"w-full":"w-[500px] flex-shrink-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Supplier"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s&&e.jsx("button",{onClick:()=>{N(null),R(""),setTimeout(()=>{u.current&&u.current.focus()},100)},className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Change supplier",children:"Change Supplier"}),e.jsx("button",{onClick:()=>Te(),className:"text-xs text-blue-600 hover:text-blue-800 underline",title:"Refresh supplier data",children:"Refresh"})]})]}),e.jsx(ve,{ref:u,placeholder:"Search suppliers by name, email, or business...",items:((ye=C==null?void 0:C.data)==null?void 0:ye.suppliers)||(C==null?void 0:C.suppliers)||[],onSelect:De,onSearch:R,displayKey:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.displayName}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Outstanding Balance: ",(t.pendingBalance||0).toFixed(2)]})]}),selectedItem:s,loading:Ee,emptyMessage:E.length>0?"No suppliers found":"Start typing to search suppliers..."})]}),e.jsx("div",{className:`${A?"w-full":"flex-1"}`,children:s?e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(at,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.displayName||s.name||s.companyName||"Unknown Supplier"}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:s.businessType&&s.reliability?`${s.businessType} • ${s.reliability}`:s.businessType||s.reliability||"Supplier Information"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Outstanding Balance:"}),e.jsx("span",{className:`text-sm font-medium ${(s.pendingBalance||0)>0?"text-red-600":"text-green-600"}`,children:Math.round(s.pendingBalance||0)})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(gt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(rt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.email})]})]}),s.address&&e.jsxs("div",{className:"flex items-center space-x-1 mt-1",children:[e.jsx(nt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.address})]})]})]})}):e.jsx("div",{className:"hidden lg:block"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Product Selection & Cart"})}),e.jsxs("div",{className:"card-content",children:[e.jsx("div",{className:"mb-6",children:e.jsx(Nt,{onAddProduct:qe,onRefetchReady:Ce})}),y.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500 border-t border-gray-200",children:[e.jsx(ct,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("p",{className:"mt-2",children:"No items in cart"})]}):e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700",children:"Cart Items"}),e.jsxs("button",{type:"button",onClick:Ge,className:"btn btn-secondary btn-sm flex items-center space-x-2",title:"Sort products alphabetically",children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx("span",{children:"Sort A-Z"})]})]}),y.map((t,a)=>{var o;return e.jsx(jt,{item:t,index:a,onUpdateQuantity:ze,onUpdateCost:Qe,onRemove:fe},(o=t.product)==null?void 0:o._id)})]})]})]}),y.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg max-w-5xl ml-auto mt-4",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-blue-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 text-right mb-4",children:"Purchase Details"}),e.jsxs("div",{className:"flex flex-nowrap gap-3 items-end justify-end",children:[e.jsxs("div",{className:"flex flex-col w-44",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("input",{type:"text",value:T,onChange:t=>w(t.target.value),className:"input h-8 text-sm",placeholder:U?"Auto-generated":"Enter invoice number",disabled:U})]}),e.jsxs("div",{className:"flex flex-col w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Expected Delivery"}),e.jsx("input",{type:"date",value:D,onChange:t=>_(t.target.value),className:"input h-8 text-sm"})]}),e.jsxs("div",{className:"flex flex-col w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tax Status"}),e.jsxs("div",{className:"flex items-center space-x-1 px-2 py-1 border border-gray-200 rounded h-8",children:[e.jsx("input",{type:"checkbox",id:"taxExempt",checked:O,onChange:t=>W(t.target.checked),className:"h-3 w-3 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("label",{htmlFor:"taxExempt",className:"text-xs font-medium text-gray-700 cursor-pointer",children:"Tax Exempt"})}),O&&e.jsx("div",{className:"text-green-600 text-xs font-medium",children:"✓"})]})]}),e.jsxs("div",{className:"flex flex-col w-[28rem]",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("input",{type:"text",value:j,onChange:t=>F(t.target.value),className:"input h-8 text-sm",placeholder:"Additional notes..."})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Order Summary"})}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Subtotal:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:K.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:O?"Tax (Exempt):":"Tax (8%):"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:se.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Purchase Total:"}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:$.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:"Previous Outstanding:"}),e.jsx("span",{className:"text-xl font-bold text-red-600",children:he.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold border-t-2 border-blue-400 pt-3 mt-2",children:[e.jsx("span",{className:"text-blue-900",children:"Total Payables:"}),e.jsx("span",{className:"text-blue-900 text-3xl",children:Le.toFixed(2)})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Apply Discount"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("select",{value:P.type,onChange:t=>X({...P,type:t.target.value}),className:"px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium h-[42px]",children:[e.jsx("option",{value:"amount",children:"Amount"}),e.jsx("option",{value:"percentage",children:"%"})]}),e.jsx("input",{type:"number",placeholder:P.type==="amount"?"Enter amount...":"Enter percentage...",value:P.value||"",onChange:t=>{const a=parseFloat(t.target.value)||0;X({...P,value:a})},className:"flex-1 px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",min:"0",step:P.type==="percentage"?"0.1":"0.01"})]}),P.value>0&&e.jsx("div",{className:"text-sm text-green-700 font-semibold mt-2 bg-green-50 px-2 py-1 rounded",children:P.type==="percentage"?`${P.value}% = ${ie.toFixed(2)} off`:`${P.value} off`})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Payment Method"}),e.jsxs("select",{value:B,onChange:t=>L(t.target.value),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 h-[42px]",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"credit_card",children:"Credit Card"}),e.jsx("option",{value:"debit_card",children:"Debit Card"}),e.jsx("option",{value:"check",children:"Check"})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-800 mb-2",children:"Amount Paid"}),e.jsx("input",{type:"number",step:"0.01",value:I,onChange:t=>re(parseFloat(t.target.value)||0),onFocus:t=>t.target.select(),className:"w-full px-3 py-2 border-2 border-blue-200 rounded-md bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium text-gray-900 text-lg h-[42px]",placeholder:"0.00"})]})]}),P.value>0&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:()=>X({type:"amount",value:0}),className:"px-3 py-1 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm",children:"Clear Discount"})})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6 px-6 pb-6",children:[y.length>0&&e.jsxs("button",{onClick:()=>{v([]),N(null),R(""),W(!0),X({type:"amount",value:0}),re(0),L("cash"),h.success("Cart cleared")},className:"btn btn-secondary flex-1",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Clear Cart"]}),y.length>0&&e.jsxs("button",{onClick:()=>{const t={orderNumber:`PO-${Date.now()}`,orderType:"purchase",supplier:s==null?void 0:s._id,customer:s,customerInfo:s?{name:s.displayName,email:s.email,phone:s.phone,address:s.address||s.companyAddress||s.location,businessName:s.companyName}:null,items:y.map(a=>{var o;return{product:{name:((o=a.product)==null?void 0:o.name)||"Unknown Product"},quantity:a.quantity,unitPrice:a.costPerUnit}}),pricing:{subtotal:K,discountAmount:ie,taxAmount:se,isTaxExempt:O,total:$},payment:{method:B,amountPaid:I,remainingBalance:$-I,isPartialPayment:I<$},createdAt:new Date,createdBy:{name:"Current User"},invoiceNumber:T,expectedDelivery:D,notes:j};de(t),le(!0)},className:"btn btn-secondary flex-1",children:[e.jsx(it,{className:"h-4 w-4 mr-2"}),"Print Preview"]}),e.jsxs(lt,{onClick:Ve,isLoading:!1,className:"btn btn-primary btn-lg flex-2",children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),d!=null&&d.isEditMode?"Update Purchase Invoice":"Complete Purchase & Update Inventory"]})]})]}),e.jsx(ft,{isOpen:we,onClose:()=>{le(!1),de(null)},orderData:Pe,documentTitle:"Purchase Invoice",partyLabel:"Supplier"}),Se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Export Purchase Report"}),e.jsx("button",{onClick:()=>{Y(!1),H(""),te("")},className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(vt,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Export Format"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"pdf",checked:M==="pdf",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"PDF"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Print-ready format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"excel",checked:M==="excel",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"Excel"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Spreadsheet format"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:M==="csv",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"CSV"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Comma-separated values"})]})]}),e.jsxs("label",{className:"flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"format",value:"json",checked:M==="json",onChange:t=>Z(t.target.value),className:"mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:"JSON"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Data format"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Date Range (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"From Date"}),e.jsx("input",{type:"date",value:G,onChange:t=>H(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"To Date"}),e.jsx("input",{type:"date",value:ee,onChange:t=>te(t.target.value),min:G,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),(G||ee)&&e.jsx("button",{type:"button",onClick:()=>{H(""),te("")},className:"mt-2 text-sm text-primary-600 hover:text-primary-700",children:"Clear dates"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>{Y(!1),H(""),te("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",disabled:ne,children:"Cancel"}),e.jsx("button",{onClick:Ke,disabled:ne,className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:ne?"Exporting...":"Export"})]})]})})]})})]})})};export{zt as Purchase};
