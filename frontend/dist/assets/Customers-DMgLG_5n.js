import{r as N,ar as oe,as as me,at as xe,au as ue,p as e,L as Y,X as V,B as W,y as X,z as H,O as T,aj as he,S as ee,U as se,ad as te,av as pe,aw as ge,ax as be,a1 as ae,ay as J,az as je,aA as fe,aB as ye,aC as Ne,d as ve,ao as Ce}from"./index-QHzcgHe1.js";import{u as we}from"./useFuzzySearch-CPK0wZPc.js";import{D as Ae}from"./ConfirmationDialog-CpWps3pF.js";import{a as Se}from"./useConfirmation-BFyzFbUJ.js";import{D as K}from"./download-ULFDWFy_.js";import{U as Ee}from"./upload-D2S2_33i.js";import{F as ke}from"./file-spreadsheet-rsHRZgSZ.js";import{C as Le}from"./check-circle-pdbRLUjc.js";import{A as Ie}from"./alert-circle-Zvregbhl.js";import{F as Te}from"./filter-DkEczEi5.js";import{C as Fe}from"./chevron-up-C3PDmoXo.js";import{C as Pe}from"./chevron-down-oX_1uWoZ.js";import{P as le}from"./phone-DmhyAe7y.js";import{N as Ue}from"./NotesPanel-DQRcuSBD.js";import{u as Be}from"./chartOfAccountsApi-CmNpcq75.js";import{u as Me,a as De}from"./citiesApi-BiSObsMp.js";import{M as ze}from"./message-square-DH13qjhm.js";import{P as Oe}from"./pen-square-D_ZZfkE6.js";import{T as _e}from"./trash-2-G7GOGhVq.js";import{P as Re}from"./plus-wthIFHeq.js";import"./info-L9xTXcgi.js";import"./history-DhghIn6j.js";import"./lock-8uvSbQ7f.js";const $e=({onImportComplete:s,filters:w={}})=>{const[h,v]=N.useState(null),[o,r]=N.useState(null),[g,L]=N.useState(!1),[E,{isLoading:C}]=oe(),[l,{isLoading:i}]=me(),{refetch:I}=xe(void 0,{skip:!0}),[A]=ue(),S=async()=>{try{const a=await E(w).unwrap();if(a.downloadUrl){const j=a.filename||"customers.xlsx",f=await A(j).unwrap(),n=f instanceof Blob?f:new Blob([f]),y=document.createElement("a"),P=URL.createObjectURL(n);y.setAttribute("href",P),y.setAttribute("download",j),y.style.visibility="hidden",document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(P)}W(`Exported ${a.recordCount||0} customers to Excel`)}catch(a){X(a,"Excel Export")}},b=a=>{const j=a.target.files[0];if(j){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(j.mimetype)&&!j.name.match(/\.(xlsx|xls)$/)){H("Invalid file type. Only Excel files are allowed."),a.target.value="";return}if(j.size>10*1024*1024){H("File size exceeds 10MB limit"),a.target.value="";return}v(j)}},m=async()=>{var a,j,f;if(!h){T.error("Please select a file to import");return}try{const n=await l(h).unwrap();if(r((n==null?void 0:n.results)||n),((a=n==null?void 0:n.results)==null?void 0:a.success)>0||(n==null?void 0:n.success)>0){const P=((j=n==null?void 0:n.results)==null?void 0:j.success)||(n==null?void 0:n.success);W(`Successfully imported ${P} customers`),s&&s()}const y=((f=n==null?void 0:n.results)==null?void 0:f.errors)||(n==null?void 0:n.errors)||[];y.length>0&&he(`${y.length} customers failed to import`)}catch(n){X(n,"Customer Import")}},p=async()=>{try{const a=await I(),j=a.data instanceof Blob?a.data:new Blob([a.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=document.createElement("a"),n=URL.createObjectURL(j);f.setAttribute("href",n),f.setAttribute("download","customer_template.xlsx"),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(n),W("Template downloaded successfully")}catch(a){X(a,"Template Download")}},k=()=>{v(null),r(null),L(!1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import / Export Customers"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:p,className:"btn btn-outline btn-sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Template"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download Excel template file"}),e.jsx("div",{children:"• Pre-formatted with correct columns"}),e.jsx("div",{children:"• Shows required and optional fields"}),e.jsx("div",{children:"• Use this to prepare import data"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs(Y,{onClick:S,isLoading:C,className:"btn btn-secondary btn-sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),e.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Exports all customers to Excel file"}),e.jsx("div",{children:"• Includes all customer data and fields"}),e.jsx("div",{children:"• File format: Excel (.xlsx)"}),e.jsx("div",{children:"• Filtered results based on current search"})]}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsxs("button",{onClick:()=>L(!0),className:"btn btn-primary btn-sm",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Import Customers"]}),e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10",children:[e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("div",{children:"• Download template for required format"}),e.jsx("div",{children:"• Required: Name, Business Name"}),e.jsx("div",{children:"• Supported: Excel (.xlsx), Max 10MB"}),e.jsx("div",{children:"• Duplicates will be skipped"})]}),e.jsx("div",{className:"absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"})]})]})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Import Customers"}),e.jsx("button",{onClick:k,className:"text-gray-400 hover:text-gray-600",children:e.jsx(V,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"p-6",children:o?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Import Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx(Le,{className:"h-6 w-6 text-green-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-green-600",children:o.success}),e.jsx("div",{className:"text-sm text-green-700",children:"Success"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx(Ie,{className:"h-6 w-6 text-red-600 mx-auto mb-1"}),e.jsx("div",{className:"text-lg font-semibold text-red-600",children:o.errors.length}),e.jsx("div",{className:"text-sm text-red-700",children:"Errors"})]})]}),o.errors.length>0&&e.jsxs("div",{className:"max-h-40 overflow-y-auto",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Errors:"}),e.jsxs("div",{className:"space-y-2",children:[o.errors.slice(0,10).map((a,j)=>e.jsxs("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:["Row ",a.row,": ",a.error]},j)),o.errors.length>10&&e.jsxs("div",{className:"text-sm text-gray-500",children:["... and ",o.errors.length-10," more errors"]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:k,className:"btn btn-primary btn-sm",children:"Close"})})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:b,className:"input w-full"})]}),h&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-600 mr-2"}),e.jsx("span",{className:"text-sm text-gray-700",children:h.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-auto",children:[(h.size/1024/1024).toFixed(2)," MB"]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:k,className:"btn btn-secondary btn-sm",children:"Cancel"}),e.jsx(Y,{onClick:m,isLoading:i,disabled:!h,className:"btn btn-primary btn-sm",children:"Import Customers"})]})]})})]})})]})},qe=({filters:s,onFiltersChange:w,onClearFilters:h})=>{const[v,o]=N.useState(!1),r=(l,i)=>{w({...s,[l]:i})},g=l=>{const i={...s};delete i[l],w(i)},L=()=>{w({}),h&&h()},E=Object.keys(s).some(l=>s[l]!==""&&s[l]!==null&&s[l]!==void 0),C=()=>Object.keys(s).filter(l=>s[l]!==""&&s[l]!==null&&s[l]!==void 0).length;return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50",onClick:()=>o(!v),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Te,{className:"h-5 w-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters"}),E&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full",children:[C()," active"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[E&&e.jsx("button",{onClick:l=>{l.stopPropagation(),L()},className:"text-sm text-red-600 hover:text-red-800 font-medium",children:"Clear All"}),v?e.jsx(Fe,{className:"h-4 w-4 text-gray-400"}):e.jsx(Pe,{className:"h-4 w-4 text-gray-400"})]})]}),v&&e.jsxs("div",{className:"border-t border-gray-200 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ee,{className:"h-4 w-4 inline mr-1"}),"Search Customers"]}),e.jsx("input",{type:"text",placeholder:"Name, email, or phone...",value:s.search||"",onChange:l=>r("search",l.target.value),className:"input text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(se,{className:"h-4 w-4 inline mr-1"}),"Status"]}),e.jsxs("select",{value:s.status||"",onChange:l=>r("status",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(te,{className:"h-4 w-4 inline mr-1"}),"Email Status"]}),e.jsxs("select",{value:s.emailStatus||"",onChange:l=>r("emailStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Email Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-email",children:"No Email"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"h-4 w-4 inline mr-1"}),"Phone Status"]}),e.jsxs("select",{value:s.phoneStatus||"",onChange:l=>r("phoneStatus",l.target.value),className:"input text-sm",children:[e.jsx("option",{value:"",children:"All Phone Statuses"}),e.jsx("option",{value:"verified",children:"Verified"}),e.jsx("option",{value:"unverified",children:"Unverified"}),e.jsx("option",{value:"no-phone",children:"No Phone"})]})]})]}),E&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Active Filters:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(s).map(([l,i])=>{if(!i||i==="")return null;let I,A;switch(l){case"search":I="Search",A=`"${i}"`;break;case"status":I="Status",A=i.charAt(0).toUpperCase()+i.slice(1);break;case"emailStatus":I="Email",A=i==="verified"?"Verified":i==="unverified"?"Unverified":i==="no-email"?"No Email":i;break;case"phoneStatus":I="Phone",A=i==="verified"?"Verified":i==="unverified"?"Unverified":i==="no-phone"?"No Phone":i;break;default:I=l.charAt(0).toUpperCase()+l.slice(1),A=i}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[I,": ",A,e.jsx("button",{onClick:()=>g(l),className:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full hover:bg-blue-200",children:e.jsx(V,{className:"h-3 w-3"})})]},l)})})]})]})]})},z={name:"",email:"",phone:"",businessName:"",businessType:"wholesale",customerTier:"bronze",creditLimit:0,openingBalance:0,status:"active",ledgerAccount:"",addresses:[{type:"both",street:"",city:"",state:"",zipCode:"",country:"US",isDefault:!0}]},Ve=({customer:s,onSave:w,onCancel:h,isSubmitting:v})=>{const{register:o,handleSubmit:r,formState:{errors:g},reset:L,setValue:E,watch:C,setError:l,clearErrors:i}=pe({defaultValues:z}),[I,A]=N.useState(!1),[S,b]=N.useState({name:"",state:"",country:"US",description:"",isActive:!0}),[m,p]=N.useState(!1),[k,a]=N.useState(!1),[j,f]=N.useState(!1),[n,y]=N.useState(!1),[P]=ge(),[F]=be(),[ie,{isLoading:Q}]=Me(),Z=C("addresses")||z.addresses,B=C("email"),O=C("businessName");N.useEffect(()=>{if(!B||B.trim()===""){a(!1),i("email");return}if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(B)){a(!1);return}if(s&&s.email&&s.email.toLowerCase()===B.toLowerCase()){a(!1),i("email");return}const c=setTimeout(async()=>{var d;try{p(!0);const u=(s==null?void 0:s._id)||null,x=await P({email:B,excludeId:u}).unwrap();((d=x==null?void 0:x.data)==null?void 0:d.exists)??(x==null?void 0:x.exists)?(a(!0),l("email",{type:"manual",message:"Email already exists"})):(a(!1),i("email"))}catch{a(!1)}finally{p(!1)}},500);return()=>clearTimeout(c)},[B,s,l,i,P]),N.useEffect(()=>{if(!O||O.trim()===""){y(!1),i("businessName");return}if(s&&s.businessName&&s.businessName.trim().toLowerCase()===O.trim().toLowerCase()){y(!1),i("businessName");return}const t=setTimeout(async()=>{var c;try{f(!0);const d=(s==null?void 0:s._id)||null,u=await F({businessName:O,excludeId:d}).unwrap();((c=u==null?void 0:u.data)==null?void 0:c.exists)??(u==null?void 0:u.exists)?(y(!0),l("businessName",{type:"manual",message:"Business name already exists"})):(y(!1),i("businessName"))}catch{y(!1)}finally{f(!1)}},500);return()=>clearTimeout(t)},[O,s,l,i,F]),N.useEffect(()=>{var t,c;s?(L({...z,...s,openingBalance:typeof s.openingBalance=="number"?s.openingBalance:s.pendingBalance||0,ledgerAccount:((t=s.ledgerAccount)==null?void 0:t._id)||s.ledgerAccount||"",addresses:(c=s.addresses)!=null&&c.length?s.addresses:z.addresses}),a(!1),y(!1),i("email"),i("businessName")):(L(z),a(!1),y(!1),i("email"),i("businessName"))},[s,L,i]);const _=(t,c,d)=>{const u=[...Z];u[t]={...u[t],[c]:d},E("addresses",u,{shouldValidate:!1})},{data:M=[],isLoading:ne}=Be({accountType:"asset",accountCategory:"current_assets",includePartyAccounts:"true",isActive:"true"}),{data:R,isLoading:G}=De(),$=Array.isArray(R)?R:(R==null?void 0:R.data)||[],re=t=>{if(t.preventDefault(),!S.name.trim()){T.error("City name is required");return}ie(S).unwrap().then(()=>{T.success("City created successfully"),A(!1),b({name:"",state:"",country:"US",description:"",isActive:!0}),Z.length>0&&_(0,"city",S.name)}).catch(c=>{var d;T.error(((d=c==null?void 0:c.data)==null?void 0:d.message)||"Failed to create city")})},D=N.useMemo(()=>{if(!Array.isArray(M))return[];const t=M.find(x=>(x.accountName||x.name||"").toLowerCase()==="accounts receivable"),c=M.filter(x=>{const U=(x.accountName||x.name||"").toLowerCase(),q=Array.isArray(x.tags)?x.tags:[];return U.includes("receivable")||q.includes("customer")||q.includes("accounts_receivable")||x.accountCode&&x.accountCode.startsWith("11")}),d=M.filter(x=>x.allowDirectPosting!==!1);let u=[];return t?u=[t,...c.filter(x=>x._id!==t._id&&x.id!==t.id)]:c.length>0?u=c:d.length>0?u=d:u=M,[...u].sort((x,U)=>{if(t){if(x._id===t._id||x.id===t.id)return-1;if(U._id===t._id||U.id===t.id)return 1}const q=(x.accountCode||"").toString(),de=(U.accountCode||"").toString();return q.localeCompare(de,void 0,{numeric:!0})})},[M]);N.useEffect(()=>{if(D.length>0){const t=D.find(c=>(c.accountName||c.name||"").toLowerCase()==="accounts receivable"||c.accountCode==="1130")||D[0];if(t&&(!s||!s.ledgerAccount)){const c=t._id||t.id;c&&E("ledgerAccount",c,{shouldValidate:!1})}}},[s,D,E]);const ce=t=>{if(k){T.error("Please use a different email address");return}if(n){T.error("Please use a different business name");return}w(t),L(z),a(!1),y(!1)};return e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:[e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s?"Edit Customer":"Add New Customer"}),e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(V,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:r(ce),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...o("businessName",{required:"Business name is required"}),className:`input pl-10 ${n?"border-red-500":""}`,placeholder:"Enter business name"}),j&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(J,{size:"sm"})})]}),g.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.businessName.message}),n&&!g.businessName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Business name already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),e.jsx("input",{...o("name",{required:"Contact person is required"}),className:"input",placeholder:"Enter contact person name"}),g.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.name.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...o("email",{pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Invalid email address"}}),type:"text",className:`input pl-10 ${k?"border-red-500":""}`,placeholder:"Enter email address (optional)"}),m&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx(J,{size:"sm"})})]}),g.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.email.message}),k&&!g.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Email already exists"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{...o("phone"),type:"tel",className:"input pl-10",placeholder:"Enter phone number"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type"}),e.jsxs("select",{...o("businessType"),className:"input",children:[e.jsx("option",{value:"individual",children:"Individual"}),e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"distributor",children:"Distributor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Customer Tier"}),e.jsxs("select",{...o("customerTier"),className:"input",children:[e.jsx("option",{value:"bronze",children:"Bronze"}),e.jsx("option",{value:"silver",children:"Silver"}),e.jsx("option",{value:"gold",children:"Gold"}),e.jsx("option",{value:"platinum",children:"Platinum"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Credit Limit ($)"}),e.jsx("input",{...o("creditLimit",{valueAsNumber:!0,min:{value:0,message:"Credit limit must be positive"}}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),g.creditLimit&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:g.creditLimit.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Opening Balance ($)"}),e.jsx("input",{...o("openingBalance",{valueAsNumber:!0}),type:"number",step:"0.01",className:"input",placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Positive means the customer owes you. Use a negative value if you owe the customer."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{...o("status"),className:"input",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"suspended",children:"Suspended"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Address"}),e.jsx("div",{className:"space-y-4",children:Z.map((t,c)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street Address"}),e.jsx("input",{type:"text",value:t.street||"",onChange:d=>_(c,"street",d.target.value),className:"input",placeholder:"123 Main St"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City *"}),e.jsxs("select",{value:t.city||"",onChange:d=>_(c,"city",d.target.value),className:"input",required:!0,disabled:G,children:[e.jsx("option",{value:"",children:"Select a city"}),Array.isArray($)&&$.map(d=>e.jsxs("option",{value:d.name,children:[d.name,d.state?`, ${d.state}`:""]},d._id||d.name))]}),G&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Loading cities..."}),!G&&Array.isArray($)&&$.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No cities available. Please add cities first."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:t.state||"",onChange:d=>_(c,"state",d.target.value),className:"input",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ZIP Code"}),e.jsx("input",{type:"text",value:t.zipCode||"",onChange:d=>_(c,"zipCode",d.target.value),className:"input",placeholder:"12345"})]})]})},c))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Ledger Account ",e.jsx("span",{className:"text-gray-400 text-xs",children:"(Auto-linked)"})]}),ne?e.jsx("div",{className:"input bg-gray-50 text-gray-500",children:"Loading ledger account..."}):(()=>{const t=C("ledgerAccount"),c=D.find(u=>(u._id||u.id)===t||(u.accountName||u.name||"").toLowerCase()==="accounts receivable"||u.accountCode==="1130")||D[0],d=c?`${c.accountCode||"1130"} - ${c.accountName||c.name||"Accounts Receivable"}`:"1130 - Accounts Receivable";return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:d,className:"input bg-gray-50 text-gray-700 cursor-not-allowed",readOnly:!0,disabled:!0}),e.jsx("input",{type:"hidden",...o("ledgerAccount")}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[e.jsx("span",{className:"font-medium",children:"ℹ️ Information:"}),' Customers are automatically linked to the "Accounts Receivable" account (1130) for accounting purposes. This cannot be changed.']})]})})()]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:h,className:"btn btn-secondary",disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Saving...":s?"Update Customer":"Add Customer"})]})]})]})}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Add New City"}),e.jsx("button",{onClick:()=>{A(!1),b({name:"",state:"",country:"US",description:"",isActive:!0})},className:"p-2 text-gray-400 hover:text-gray-600",children:e.jsx(V,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City Name *"}),e.jsx("input",{type:"text",value:S.name,onChange:t=>b({...S,name:t.target.value}),className:"input",placeholder:"Enter city name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsx("input",{type:"text",value:S.state,onChange:t=>b({...S,state:t.target.value}),className:"input",placeholder:"Enter state"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:S.country,onChange:t=>b({...S,country:t.target.value}),className:"input",placeholder:"Enter country"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"cityIsActive",checked:S.isActive,onChange:t=>b({...S,isActive:t.target.checked}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"cityIsActive",className:"ml-2 block text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:()=>{A(!1),b({name:"",state:"",country:"US",description:"",isActive:!0})},className:"btn btn-secondary",disabled:Q,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:Q,children:Q?"Adding...":"Add City"})]})]})]})})})]})},Qe=({customers:s,searchTerm:w,onEdit:h,onDelete:v,onShowNotes:o})=>s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No customers found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:w?"Try adjusting your search terms.":"Get started by adding a new customer."})]}):e.jsx("div",{className:"card w-full",children:e.jsxs("div",{className:"card-content p-0 w-full",children:[e.jsx("div",{className:"bg-gray-50 px-8 py-6 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"ID"})}),e.jsxs("div",{className:"col-span-3",children:[e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Business Name"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Contact Person"})]}),e.jsx("div",{className:"col-span-2",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Email"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Phone"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Status"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Type"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Tier"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Credit"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h3",{className:"text-base font-medium text-gray-700",children:"Actions"})})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:s.map(r=>e.jsx("div",{className:"px-8 py-6 hover:bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-xs text-gray-500 font-mono cursor-help",title:r._id,children:r._id.slice(-6)})}),e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[r.businessType==="individual"?e.jsx(se,{className:"h-6 w-6 text-gray-400"}):e.jsx(ae,{className:"h-6 w-6 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium text-gray-900",children:r.businessName||r.displayName}),e.jsx("p",{className:"text-sm text-gray-500",children:r.name})]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("p",{className:"text-sm text-gray-600",children:r.email})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:r.phone||"-"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${r.status==="active"?"badge-success":"badge-gray"}`,children:r.status})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${r.businessType==="wholesale"?"badge-info":"badge-gray"}`,children:r.businessType})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:`badge ${r.customerTier==="gold"?"badge-warning":r.customerTier==="platinum"?"badge-info":"badge-gray"}`,children:r.customerTier})}),e.jsx("div",{className:"col-span-1",children:e.jsx("p",{className:"text-sm text-gray-600",children:Math.round(r.creditLimit)})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>o(r),className:"text-green-600 hover:text-green-800",title:"Notes",children:e.jsx(ze,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>h(r),className:"text-primary-600 hover:text-primary-800",children:e.jsx(Oe,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>v(r),className:"text-danger-600 hover:text-danger-800",children:e.jsx(_e,{className:"h-5 w-5"})})]})})]})},r._id))})]})}),Ze=s=>{const[w,h]=N.useState(null),[v,o]=N.useState(!1),[r,{isLoading:g}]=fe(),[L,{isLoading:E}]=ye(),[C,{isLoading:l}]=Ne();return{selectedCustomer:w,isModalOpen:v,creating:g,updating:E,deleting:l,setSelectedCustomer:h,setIsModalOpen:o,handleEdit:b=>{h(b),o(!0)},handleCloseModal:()=>{o(!1),h(null)},handleSave:b=>{if(g||E){T.error("Please wait for the current request to complete");return}w?L({id:w._id,...b}).unwrap().then(()=>{T.success("Customer updated successfully"),o(!1),h(null),s()}).catch(m=>{var p;T.error(((p=m==null?void 0:m.data)==null?void 0:p.message)||"Failed to update customer")}):r(b).unwrap().then(()=>{T.success("Customer created successfully"),o(!1),h(null),s()}).catch(m=>{var p,k,a,j,f;if((m==null?void 0:m.status)===409||((p=m==null?void 0:m.data)==null?void 0:p.code)==="DUPLICATE_ENTRY"){const n=((k=m==null?void 0:m.data)==null?void 0:k.message)||((j=(a=m==null?void 0:m.data)==null?void 0:a.error)==null?void 0:j.message)||"Duplicate customer detected";T.error(n)}else T.error(((f=m==null?void 0:m.data)==null?void 0:f.message)||"Failed to create customer")})},handleDelete:(b,m)=>{const p=b.displayName||b.businessName||b.name||b.email||"Unknown Customer";m(p,"Customer",async()=>{var k;try{await C(b._id).unwrap(),T.success("Customer deleted successfully"),s()}catch(a){T.error(((k=a==null?void 0:a.data)==null?void 0:k.message)||"Failed to delete customer")}})}}},gs=()=>{var n,y,P;const[s,w]=N.useState(""),[h,v]=N.useState({}),[o,r]=N.useState(!1),[g,L]=N.useState(null),E={search:s,limit:999999,...h},{data:C,isLoading:l,error:i,refetch:I}=ve(E,{refetchOnMountOrArgChange:!0}),{confirmation:A,confirmDelete:S,handleConfirm:b,handleCancel:m}=Se(),p=Ze(I),k=F=>{v(F)},a=()=>{v({}),w("")},j=((n=C==null?void 0:C.data)==null?void 0:n.customers)||(C==null?void 0:C.customers)||[],f=we(j,s,["name","businessName","email","phone","displayName"],{threshold:.4,minScore:.3,limit:null});return l?e.jsx(Ce,{message:"Loading customers..."}):i?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-danger-600",children:"Failed to load customers"})}):e.jsxs("div",{className:"space-y-6 w-full ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Customers"}),e.jsx("p",{className:"text-gray-600",children:"Manage your customer database"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>p.setIsModalOpen(!0),className:"btn btn-primary btn-md w-full sm:w-auto",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Add Customer"]})})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:s,onChange:F=>w(F.target.value),className:"input pl-10"})]})}),e.jsx($e,{onImportComplete:()=>I(),filters:E}),e.jsx(qe,{filters:h,onFiltersChange:k,onClearFilters:a}),e.jsx(Qe,{customers:f,searchTerm:s,onEdit:p.handleEdit,onDelete:F=>p.handleDelete(F,S),onShowNotes:F=>{L({type:"Customer",id:F._id,name:F.businessName||F.name}),r(!0)}}),p.isModalOpen&&e.jsx(Ve,{customer:p.selectedCustomer,onSave:p.handleSave,onCancel:p.handleCloseModal,isSubmitting:p.creating||p.updating}),e.jsx(Ae,{isOpen:A.isOpen,onClose:m,onConfirm:b,itemName:((P=(y=A.message)==null?void 0:y.match(/"([^"]*)"/))==null?void 0:P[1])||"",itemType:"Customer",isLoading:p.deleting}),o&&g&&e.jsx(Ue,{entityType:g.type,entityId:g.id,entityName:g.name,onClose:()=>{r(!1),L(null)}})]})};export{gs as Customers};
