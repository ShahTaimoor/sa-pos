import{D as z,a as I,p as e,aZ as v,r as o,O as n,ao as O,x as X,S as B,az as G,I as H}from"./index-QHzcgHe1.js";import{u as Q,a as Y,b as Z,c as J}from"./usersApi-CgCX1t1y.js";import{C as K}from"./check-circle-pdbRLUjc.js";import{X as A}from"./x-circle-DZheaYy1.js";import{P as V}from"./pen-square-D_ZZfkE6.js";import{T as W}from"./trash-2-G7GOGhVq.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=z("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),ne=()=>{const{user:m}=I();if((m==null?void 0:m.role)!=="super_admin")return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This page is only accessible to Super Administrators."})]})});const[g,C]=o.useState(""),[f,k]=o.useState("all"),[S,x]=o.useState(!1),[c,u]=o.useState(null),[r,d]=o.useState({firstName:"",lastName:"",email:"",password:"",role:"admin",phone:"",department:"",status:"active"}),{data:l,isLoading:U,error:b,refetch:y}=Q(void 0,{onError:s=>{var t;(s==null?void 0:s.status)===403?n.error('Access denied. You need "manage_users" permission to view users.'):(s==null?void 0:s.status)===401?n.error("Authentication required. Please log in again."):n.error(`Failed to load admins: ${((t=s==null?void 0:s.data)==null?void 0:t.message)||(s==null?void 0:s.message)||"Unknown error"}`)}}),[L,{isLoading:D}]=Y(),[M,{isLoading:_}]=Z(),[E,{isLoading:q}]=J(),[N,j]=o.useState([]);o.useEffect(()=>{var s;if(l){let t=null;if((s=l==null?void 0:l.data)!=null&&s.users&&Array.isArray(l.data.users)?t=l.data.users:l!=null&&l.users&&Array.isArray(l.users)?t=l.users:Array.isArray(l)&&(t=l.filter(a=>a._id&&a.email)),t&&Array.isArray(t)){const a=t.filter(i=>i.role==="admin"||i.role==="super_admin"||i.role==="manager");j(a)}else j([])}else b&&j([])},[l,b]);const p=U||D||_||q,F=async s=>{var t;s.preventDefault();try{const a=await L(r).unwrap();n.success("Admin created successfully"),x(!1),h(),y()}catch(a){const i=((t=a==null?void 0:a.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to create admin";i.includes("already exists")||i.includes("duplicate")?n.error("A user with this email already exists"):n.error(i),console.error("Create admin error:",a)}},P=async s=>{var t;if(s.preventDefault(),!!c)try{const a={...r};a.password||delete a.password;const i=await M({id:c._id,...a}).unwrap();n.success("Admin updated successfully"),u(null),h(),x(!1),y()}catch(a){const i=((t=a==null?void 0:a.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to update admin";i.includes("already exists")||i.includes("duplicate")?n.error("A user with this email already exists"):n.error(i),console.error("Update admin error:",a)}},R=async s=>{var t;if(window.confirm("Are you sure you want to delete this admin?"))try{await E(s).unwrap(),n.success("Admin deleted successfully"),y()}catch(a){const i=((t=a==null?void 0:a.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to delete admin";n.error(i),console.error("Delete admin error:",a)}},h=()=>{d({firstName:"",lastName:"",email:"",password:"",role:"admin",phone:"",department:"",status:"active"})},T=s=>{u(s),d({firstName:s.firstName,lastName:s.lastName,email:s.email,password:"",role:s.role,phone:s.phone||"",department:s.department||"",status:s.status}),x(!0)},w=N.filter(s=>{const t=s.firstName.toLowerCase().includes(g.toLowerCase())||s.lastName.toLowerCase().includes(g.toLowerCase())||s.email.toLowerCase().includes(g.toLowerCase()),a=f==="all"||s.role===f;return t&&a}),$=s=>{switch(s){case"super_admin":return"bg-yellow-100 text-yellow-800";case"admin":return"bg-red-100 text-red-800";case"manager":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return p&&N.length===0?e.jsx(O,{message:"Loading admins..."}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(v,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage system administrators and their permissions"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>y(),disabled:p,className:"btn btn-primary btn-sm",children:[e.jsx(X,{className:`h-4 w-4 mr-2 ${p?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:()=>{h(),u(null),x(!0)},className:"btn btn-primary",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Create Admin"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search admins by name or email...",value:g,onChange:s=>C(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsx("div",{className:"md:w-48",children:e.jsxs("select",{value:f,onChange:s=>k(s.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"super_admin",children:"Super Admin"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"6",className:"px-6 py-8 text-center text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No admins found"})]})}):w.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.firstName," ",s.lastName]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:s.email})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$(s.role)}`,children:s.role.charAt(0).toUpperCase()+s.role.slice(1).replace("_"," ")})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[s.status==="active"?e.jsx(K,{className:"h-3 w-3 mr-1"}):e.jsx(A,{className:"h-3 w-3 mr-1"}),s.status]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("button",{onClick:()=>T(s),className:"text-primary-600 hover:text-primary-900",title:"Edit",children:e.jsx(V,{className:"h-4 w-4"})}),s._id!==(m==null?void 0:m._id)&&e.jsx("button",{onClick:()=>R(s._id),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s._id))})]})})}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:c?"Edit Admin":"Create New Admin"}),e.jsx("button",{onClick:()=>{x(!1),h(),u(null)},className:"text-gray-400 hover:text-gray-600",children:e.jsx(A,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:c?P:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",required:!0,value:r.firstName,onChange:s=>d({...r,firstName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",required:!0,value:r.lastName,onChange:s=>d({...r,lastName:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:r.email,onChange:s=>d({...r,email:s.target.value}),disabled:!!c,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",c?"(leave blank to keep current)":"*"]}),e.jsx("input",{type:"password",required:!c,value:r.password,onChange:s=>d({...r,password:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{required:!0,value:r.role,onChange:s=>d({...r,role:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:s=>d({...r,phone:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),e.jsx("input",{type:"text",value:r.department,onChange:s=>d({...r,department:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status *"}),e.jsxs("select",{required:!0,value:r.status,onChange:s=>d({...r,status:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),c&&e.jsx("option",{value:"suspended",children:"Suspended"})]})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),h(),u(null)},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:p?"Saving...":c?"Update Admin":"Create Admin"})]})]})]})})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(H,{className:"h-5 w-5 text-yellow-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Super Admin Access Required"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Only super administrators can manage other admin users. All actions are logged and audited."})]})]})})]})};export{ne as AdminManagement};
