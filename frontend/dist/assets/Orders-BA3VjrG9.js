import{r as u,u as it,N as dt,aF as ct,aG as ot,R as Q,d as mt,p as e,S as xt,aH as ut,t as ht,B as A,z as U,y as We}from"./index-QHzcgHe1.js";import{a as pt}from"./productsApi-BS7itgd6.js";import{u as gt}from"./settingsApi-D-e2N-LC.js";import{P as ze}from"./plus-wthIFHeq.js";import{E as bt}from"./eye-D8xIUmp0.js";import{P as Ve}from"./printer-Dmqc0NC_.js";import{P as yt}from"./pen-square-D_ZZfkE6.js";import{T as Ye}from"./trash-2-G7GOGhVq.js";const jt=(g=new Date)=>{const E=g.getFullYear(),N=String(g.getMonth()+1).padStart(2,"0"),O=String(g.getDate()).padStart(2,"0");return`${E}-${N}-${O}`},$t=()=>{var ee,te,se,ae,re,le,ne,ie,de,ce,oe,me,xe,ue,he,pe,ge,be,ye,je,ve,Ne,fe,we,Se,ke,Ie,Pe,Ce,Te,De;const[g,E]=u.useState(""),[N,O]=u.useState(""),G=jt(),[W,He]=u.useState(G),[z,Je]=u.useState(G),[n,V]=u.useState(null),[Ke,Y]=u.useState(!1),[_,C]=u.useState(!1),[l,h]=u.useState({notes:"",items:[],customer:null,orderType:"retail"}),{openTab:vt}=it(),[H,J]=u.useState(!1),[b,f]=u.useState(""),[Nt,ft]=u.useState([]),[d,q]=u.useState(null),[v,F]=u.useState(1),[y,T]=u.useState(0),[L,w]=u.useState(""),[Xe]=dt(),[Ze]=ct(),{data:o,isLoading:Re,error:et,refetch:K}=ot({search:g,status:N||void 0,dateFrom:W||void 0,dateTo:z||void 0,limit:999999}),X=Q.useMemo(()=>{var t,s,a;return o?(t=o==null?void 0:o.data)!=null&&t.orders?o.data.orders:o!=null&&o.orders?o.orders:(a=(s=o==null?void 0:o.data)==null?void 0:s.data)!=null&&a.orders?o.data.data.orders:Array.isArray(o)?o:[]:[]},[o]),{data:B}=gt(void 0,{staleTime:5*60*1e3}),D=(B==null?void 0:B.data)||{},Z=((ee=D.companyName)==null?void 0:ee.trim())||"Your Company Name",$=((te=D.address)==null?void 0:te.trim())||"",S=((se=D.contactNumber)==null?void 0:se.trim())||"",k=((ae=D.email)==null?void 0:ae.trim())||"",{data:m}=pt({search:b,limit:50},{skip:!_&&!H}),j=Q.useMemo(()=>{var t,s,a;return m?(t=m==null?void 0:m.data)!=null&&t.products?m.data.products:m!=null&&m.products?m.products:(a=(s=m==null?void 0:m.data)==null?void 0:s.data)!=null&&a.products?m.data.data.products:Array.isArray(m)?m:[]:[]},[m]),{data:x}=mt({search:L,limit:50},{skip:!_,keepPreviousData:!0}),M=Q.useMemo(()=>{var t,s,a;return x?(t=x==null?void 0:x.data)!=null&&t.customers?x.data.customers:x!=null&&x.customers?x.customers:(a=(s=x==null?void 0:x.data)==null?void 0:s.data)!=null&&a.customers?x.data.data.customers:Array.isArray(x)?x:[]:[]},[x]),tt=async t=>{try{await Ze(t).unwrap(),A("Sales invoice deleted successfully"),K()}catch(s){We(s,"Sales Invoice Deletion")}},st=async(t,s)=>{try{await Xe({id:t,...s}).unwrap(),A("Sales invoice updated successfully"),K()}catch(a){We(a,"Sales Invoice Update")}},at=t=>{var i;V(t);const s=(t.items||[]).map(r=>{var c,p;return{product:((c=r.product)==null?void 0:c._id)||r.product||null,productName:((p=r.product)==null?void 0:p.name)||"Unknown Product",quantity:r.quantity||1,unitPrice:r.unitPrice||0,total:r.total||r.quantity*r.unitPrice||0}});let a=null;t.customer&&(a=typeof t.customer=="object"&&(t.customer._id||t.customer.id)||t.customer),h({notes:t.notes||"",items:s,customer:a,orderType:t.orderType||"retail"}),q(null),F(1),T(0),f(""),w(((i=t.customerInfo)==null?void 0:i.name)||""),C(!0)},R=t=>{var p,I,$e,Me,Ae,Ee,Oe,_e,qe,Fe,Le,Be,Qe;const s=$?`<div>${$}</div>`:"",a=[];S&&a.push(`Phone: ${S}`),k&&a.push(`Email: ${k}`);const i=a.length?`<div>${a.join(" | ")}</div>`:"",r=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Sales Invoice - ${t.orderNumber}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .company-name { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
          .invoice-details { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px; }
          .customer-info, .invoice-info, .payment-info { width: 100%; }
          .invoice-info, .payment-info { text-align: right; }
          .section-title { font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
          .items-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
          .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          .items-table th { background-color: #f5f5f5; font-weight: bold; }
          .text-right { text-align: right; }
          .totals { margin-left: auto; width: 300px; }
          .totals table { width: 100%; }
          .totals td { padding: 5px 10px; }
          .totals .total-row { font-weight: bold; }
          .totals .total-row td { border-top: 1px solid #000; }
          .footer { margin-top: 30px; text-align: center; font-size: 12px; color: #666; }
          @media print { body { margin: 0; } .no-print { display: none; } }
        </style>
      </head>
      <body>
        <div class="header">
          <div class="company-name">${Z}</div>
          ${s}
          ${i}
          <div>Sales Invoice</div>
        </div>
        
        <div class="invoice-details">
          <div class="customer-info">
            <div class="section-title">Bill To:</div>
            <div><strong>${((p=t.customerInfo)==null?void 0:p.name)||"N/A"}</strong></div>
            <div>${((I=t.customerInfo)==null?void 0:I.email)||""}</div>
            <div>${(($e=t.customerInfo)==null?void 0:$e.phone)||""}</div>
            <div>${((Me=t.customerInfo)==null?void 0:Me.address)||""}</div>
            ${(Ae=t.customerInfo)!=null&&Ae.pendingBalance?`<div style="margin-top: 10px;"><strong>Pending Balance: ${Math.round(t.customerInfo.pendingBalance)}</strong></div>`:""}
          </div>
          <div class="invoice-info">
            <div class="section-title">Invoice Details:</div>
            <div><strong>Invoice #:</strong> ${t.orderNumber}</div>
            <div><strong>Date:</strong> ${new Date(t.createdAt).toLocaleDateString()}</div>
            <div><strong>Status:</strong> ${t.status}</div>
            <div><strong>Type:</strong> ${t.orderType}</div>
          </div>
          <div class="payment-info">
            <div class="section-title">Payment:</div>
            <div><strong>Status:</strong> ${(Ee=t.payment)==null?void 0:Ee.status}</div>
            <div><strong>Method:</strong> ${(Oe=t.payment)==null?void 0:Oe.method}</div>
            <div><strong>Amount:</strong> ${Math.round(((_e=t.pricing)==null?void 0:_e.total)||0)}</div>
          </div>
        </div>
        
        <table class="items-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Description</th>
              <th class="text-right">Qty</th>
              <th class="text-right">Price</th>
              <th class="text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            ${((qe=t.items)==null?void 0:qe.map(P=>{var Ue,Ge;return`
              <tr>
                <td>${((Ue=P.product)==null?void 0:Ue.name)||"Unknown Product"}</td>
                <td>${((Ge=P.product)==null?void 0:Ge.description)||""}</td>
                <td class="text-right">${P.quantity}</td>
                <td class="text-right">${Math.round(P.unitPrice)}</td>
                <td class="text-right">${Math.round(P.total)}</td>
              </tr>
            `}).join(""))||'<tr><td colspan="5">No items found</td></tr>'}
          </tbody>
        </table>
        
        <div class="totals">
          <table>
            <tr>
              <td>Subtotal:</td>
              <td class="text-right">${Math.round(((Fe=t.pricing)==null?void 0:Fe.subtotal)||0)}</td>
            </tr>
            <tr>
              <td>Tax:</td>
              <td class="text-right">${Math.round(((Le=t.pricing)==null?void 0:Le.taxAmount)||0)}</td>
            </tr>
            <tr>
              <td>Discount:</td>
              <td class="text-right">${Math.round(((Be=t.pricing)==null?void 0:Be.discountAmount)||0)}</td>
            </tr>
            <tr class="total-row">
              <td><strong>Total:</strong></td>
              <td class="text-right"><strong>${Math.round(((Qe=t.pricing)==null?void 0:Qe.total)||0)}</strong></td>
            </tr>
          </table>
        </div>
        
        <div class="footer">
          <div>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</div>
        </div>
      </body>
      </html>
    `,c=window.open("","_blank");c.document.write(r),c.document.close(),c.focus(),c.print(),c.close()},rt=t=>{window.confirm(`Are you sure you want to delete invoice ${t.orderNumber}?`)&&tt(t._id)},lt=t=>{V(t),Y(!0)},nt=()=>{var a,i,r;if(!d||!y){U("Please select a product and enter a rate");return}if(((a=d.inventory)==null?void 0:a.currentStock)===0){U(`${d.name} is out of stock and cannot be added to the invoice.`);return}if(v>((i=d.inventory)==null?void 0:i.currentStock)){U(`Cannot add ${v} units. Only ${(r=d.inventory)==null?void 0:r.currentStock} units available in stock.`);return}const t={product:d._id,productName:d.name,quantity:v,unitPrice:y,total:v*y},s=[...l.items,t];h({...l,items:s}),q(null),F(1),T(0),f(""),A(`${d.name} added to invoice`)};return Re?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):et?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-danger-600",children:"Failed to load sales invoices"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Invoices"}),e.jsx("p",{className:"text-gray-600",children:"View and manage sales invoices"})]}),e.jsxs("button",{className:"btn btn-primary btn-md",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"New Invoice"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex-1 relative min-w-0",children:[e.jsx(xt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by invoice number, customer name, or amount...",value:g,onChange:t=>E(t.target.value),className:"input pl-10 w-full"})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("select",{value:N,onChange:t=>O(t.target.value),className:"input min-w-[120px]",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{className:"h-4 w-4 text-gray-400"}),e.jsx("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"From Date:"}),e.jsx("input",{type:"date",value:W,onChange:t=>He(t.target.value),className:"input"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:"To Date:"}),e.jsx("input",{type:"date",value:z,onChange:t=>Je(t.target.value),className:"input"})]})]})]}),X.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ht,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No orders found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:g||N?"Try adjusting your search terms.":"No orders have been placed yet."})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-2",children:"Order Number"}),e.jsx("div",{className:"col-span-2",children:"Customer"}),e.jsx("div",{className:"col-span-1",children:"Date"}),e.jsx("div",{className:"col-span-1",children:"Items"}),e.jsx("div",{className:"col-span-1",children:"Total"}),e.jsx("div",{className:"col-span-2",children:"Status"}),e.jsx("div",{className:"col-span-1",children:"Type"}),e.jsx("div",{className:"col-span-1",children:"Notes"}),e.jsx("div",{className:"col-span-1",children:"Actions"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:X.map(t=>{var s,a,i;return e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-center",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"font-medium text-gray-900 truncate",children:["#",t.orderNumber]})}),e.jsx("div",{className:"col-span-2",children:e.jsx("div",{className:"text-sm text-gray-900 truncate",children:((s=t.customerInfo)==null?void 0:s.name)||"Walk-in Customer"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:new Date(t.createdAt).toLocaleDateString()})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-sm text-gray-600",children:t.items.length})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"font-semibold text-gray-900",children:Math.round(t.pricing.total)})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.status==="completed"||t.status==="delivered"?"bg-green-100 text-green-800":t.status==="pending"||t.status==="processing"?"bg-yellow-100 text-yellow-800":t.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status}),e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.payment.status==="paid"?"bg-green-100 text-green-800":t.payment.status==="partial"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:t.payment.status})]})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded-full",children:t.orderType})}),e.jsx("div",{className:"col-span-1",children:e.jsx("span",{className:"text-xs text-gray-600 block truncate",title:((a=t.notes)==null?void 0:a.trim())||"No notes",children:((i=t.notes)==null?void 0:i.trim())||"—"})}),e.jsx("div",{className:"col-span-1",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>lt(t),className:"text-primary-600 hover:text-primary-800 p-1",title:"View Invoice",children:e.jsx(bt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>R(t),className:"text-green-600 hover:text-green-800 p-1",title:"Print Invoice",children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>at(t),className:"text-blue-600 hover:text-blue-800 p-1",title:"Edit Invoice",children:e.jsx(yt,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>rt(t),className:"text-red-600 hover:text-red-800 p-1",title:"Delete Invoice",children:e.jsx(Ye,{className:"h-4 w-4"})})]})})]})},t._id)})})]}),Ke&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Sales Invoice Details"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>R(n),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center space-x-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Print"})]}),e.jsx("button",{onClick:()=>Y(!1),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"Close"})]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:Z}),$&&e.jsx("p",{className:"text-sm text-gray-600",children:$}),(S||k)&&e.jsx("p",{className:"text-sm text-gray-600",children:[S&&`Phone: ${S}`,k&&`Email: ${k}`].filter(Boolean).join(" | ")}),e.jsx("p",{className:"text-lg text-gray-600",children:"Sales Invoice"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-8 mb-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 border-b border-gray-300 pb-2 mb-4",children:"Bill To:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-medium",children:((re=n.customerInfo)==null?void 0:re.name)||"Walk-in Customer"}),e.jsx("p",{className:"text-gray-600",children:((le=n.customerInfo)==null?void 0:le.email)||""}),e.jsx("p",{className:"text-gray-600",children:((ne=n.customerInfo)==null?void 0:ne.phone)||""}),e.jsx("p",{className:"text-gray-600",children:((ie=n.customerInfo)==null?void 0:ie.address)||""}),((de=n.customerInfo)==null?void 0:de.pendingBalance)&&e.jsxs("p",{className:"font-medium text-gray-900 mt-2",children:["Pending Balance: ",Math.round(n.customerInfo.pendingBalance)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-semibold text-gray-900 border-b border-gray-300 pb-2 mb-4",children:"Invoice Details:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Invoice #:"})," ",n.orderNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(n.createdAt).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",n.status]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Type:"})," ",n.orderType]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"font-semibold text-gray-900 border-b border-gray-300 pb-2 mb-4",children:"Payment:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",(ce=n.payment)==null?void 0:ce.status]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Method:"})," ",(oe=n.payment)==null?void 0:oe.method]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Amount:"})," ",Math.round(((me=n.pricing)==null?void 0:me.total)||0)]})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"font-semibold text-gray-900 border-b border-gray-300 pb-2 mb-4",children:"Items:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Item"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Description"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Price"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Total"})]})}),e.jsx("tbody",{children:((xe=n.items)==null?void 0:xe.map((t,s)=>{var a,i;return e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((a=t.product)==null?void 0:a.name)||"Unknown Product"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:((i=t.product)==null?void 0:i.description)||""}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-right",children:t.quantity}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-right",children:Math.round(t.unitPrice)}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-right",children:Math.round(t.total)})]},s)}))||e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"border border-gray-300 px-4 py-2 text-center text-gray-500",children:"No items found"})})})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"w-80",children:e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(((ue=n.pricing)==null?void 0:ue.subtotal)||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Tax:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(((he=n.pricing)==null?void 0:he.taxAmount)||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Discount:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(((pe=n.pricing)==null?void 0:pe.discountAmount)||0)})]}),e.jsxs("tr",{className:"border-t-2 border-gray-900",children:[e.jsx("td",{className:"px-4 py-2 font-bold",children:"Total:"}),e.jsx("td",{className:"px-4 py-2 text-right font-bold",children:Math.round(((ge=n.pricing)==null?void 0:ge.total)||0)})]})]})})})}),e.jsxs("div",{className:"mt-8 text-center text-sm text-gray-500",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]})]})})}),_&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Edit Sales Invoice"}),e.jsx("button",{onClick:()=>{C(!1),w("")},className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"Close"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Customer Selection"}),e.jsx("input",{type:"text",placeholder:"Search customers...",value:L,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),L&&(M==null?void 0:M.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:M.slice(0,5).map(t=>e.jsxs("div",{onClick:()=>{h({...l,customer:t._id}),w(t.displayName)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium",children:t.displayName}),e.jsx("div",{className:"text-sm text-gray-600",children:t.email})]},t._id))}),l.customer&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Selected: ",((be=n.customerInfo)==null?void 0:be.name)||"Customer"]}),e.jsx("button",{type:"button",onClick:()=>{h({...l,customer:null}),w("")},className:"text-xs text-blue-600 hover:text-blue-800 mt-1",children:"Clear selection"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Type"}),e.jsxs("select",{value:l.orderType,onChange:t=>h({...l,orderType:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"retail",children:"Retail"}),e.jsx("option",{value:"wholesale",children:"Wholesale"}),e.jsx("option",{value:"return",children:"Return"}),e.jsx("option",{value:"exchange",children:"Exchange"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("p",{className:"text-gray-900",children:((ye=n.customerInfo)==null?void 0:ye.email)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("p",{className:"text-gray-900",children:((je=n.customerInfo)==null?void 0:je.phone)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Invoice Number"}),e.jsx("p",{className:"text-gray-900",children:n.orderNumber})]})]})]}),e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=l.items.map(r=>{var c;return{product:((c=r.product)==null?void 0:c._id)||r.product,quantity:r.quantity,unitPrice:r.unitPrice}});let a=null;l.customer&&(a=typeof l.customer=="object"&&(l.customer._id||l.customer.id)||l.customer);const i={notes:l.notes,items:s,orderType:l.orderType,customer:a||void 0};st(n._id,i),C(!1)},children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),e.jsx("textarea",{value:l.notes,onChange:t=>h({...l,notes:t.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes or comments..."})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Items"}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"Add New Product"}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 items-end",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Search"}),e.jsx("input",{type:"text",placeholder:"Search or type product name...",value:b,onChange:t=>f(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),b&&(j==null?void 0:j.length)>0&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto border border-gray-200 rounded-md bg-white shadow-lg",children:j.slice(0,5).map(t=>{var s,a,i;return e.jsxs("div",{onClick:()=>{var c;f(t.name),q(t);const r=((c=t.pricing)==null?void 0:c.retail)||0;T(r)},className:"px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Stock: ",((s=t.inventory)==null?void 0:s.currentStock)||0," | Retail: ",Math.round(((a=t.pricing)==null?void 0:a.retail)||0)," | Wholesale: ",Math.round(((i=t.pricing)==null?void 0:i.wholesale)||0)]})]},t._id)})}),b&&(j==null?void 0:j.length)===0&&e.jsxs("div",{className:"mt-2 p-2 text-sm text-gray-500 text-center",children:['No products found matching "',b,'"']}),d&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded border",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Selected: ",d.name]}),e.jsxs("div",{className:"text-xs text-blue-700 mt-1",children:["Stock: ",((ve=d.inventory)==null?void 0:ve.currentStock)||0," | Retail: ",Math.round(((Ne=d.pricing)==null?void 0:Ne.retail)||0)," | Wholesale: ",Math.round(((fe=d.pricing)==null?void 0:fe.wholesale)||0)]}),y===0&&e.jsx("div",{className:"text-xs text-orange-600 mt-1",children:"⚠ Rate is 0 - please enter a rate or select a product again"})]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stock"}),e.jsx("input",{type:"text",value:d?((we=d.inventory)==null?void 0:we.currentStock)||0:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-center bg-gray-50",disabled:!0,placeholder:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("input",{type:"number",min:"1",max:((Se=d==null?void 0:d.inventory)==null?void 0:Se.currentStock)||1,value:v,onChange:t=>F(parseInt(t.target.value)||1),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-center",placeholder:"1"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rate"}),e.jsx("input",{type:"number",step:"1",value:y,onChange:t=>T(parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-center",placeholder:"0"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsx("input",{type:"text",value:d?Math.round(v*y):"",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-center font-medium bg-gray-50",disabled:!0,placeholder:""})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" "}),e.jsxs("button",{type:"button",onClick:nt,className:"w-full bg-blue-600 text-white px-3 py-2 rounded-md hover:bg-blue-700 flex items-center justify-center",disabled:!d||!y,children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),"Add"]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"Item"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Qty"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Unit Price"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-right",children:"Total"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:((ke=l.items)==null?void 0:ke.map((t,s)=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.productName||((a=t.product)==null?void 0:a.name)||"Unknown Product"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("input",{type:"number",min:"1",value:t.quantity,onChange:i=>{const r=[...l.items];r[s].quantity=parseInt(i.target.value)||1,r[s].total=r[s].quantity*r[s].unitPrice,h({...l,items:r})},className:"w-full px-2 py-1 border border-gray-300 rounded text-right"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("input",{type:"number",min:"0",step:"0.01",value:t.unitPrice,onChange:i=>{const r=[...l.items];r[s].unitPrice=parseFloat(i.target.value)||0,r[s].total=r[s].quantity*r[s].unitPrice,h({...l,items:r})},className:"w-full px-2 py-1 border border-gray-300 rounded text-right"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-right",children:Math.round(t.total)}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>{const i=l.items.filter((r,c)=>c!==s);h({...l,items:i})},className:"text-red-600 hover:text-red-800",title:"Remove Item",children:e.jsx(Ye,{className:"h-4 w-4"})})})]},s)}))||e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"border border-gray-300 px-4 py-2 text-center text-gray-500",children:"No items found"})})})]})}),l.items&&l.items.length>0&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("div",{className:"w-80",children:e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Subtotal:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(l.items.reduce((t,s)=>t+s.total,0))})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Tax:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(((Ie=n.pricing)==null?void 0:Ie.taxAmount)||0)})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2",children:"Discount:"}),e.jsx("td",{className:"px-4 py-2 text-right",children:Math.round(((Pe=n.pricing)==null?void 0:Pe.discountAmount)||0)})]}),e.jsxs("tr",{className:"border-t-2 border-gray-900",children:[e.jsx("td",{className:"px-4 py-2 font-bold",children:"Total:"}),e.jsx("td",{className:"px-4 py-2 text-right font-bold",children:Math.round(l.items.reduce((t,s)=>t+s.total,0)+(((Ce=n.pricing)==null?void 0:Ce.taxAmount)||0)-(((Te=n.pricing)==null?void 0:Te.discountAmount)||0))})]})]})})})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>C(!1),className:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!1,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Update Invoice"})]})]})]})})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Select Product"}),e.jsx("button",{onClick:()=>J(!1),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700",children:"Close"})]}),e.jsx("div",{className:"mb-6",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:b,onChange:t=>f(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:((De=productsData==null?void 0:productsData.products)==null?void 0:De.length)>0?e.jsx("div",{className:"grid grid-cols-1 gap-4",children:productsData.products.map(t=>{var s,a,i;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),e.jsxs("div",{className:"mt-2 flex space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Stock: ",((s=t.inventory)==null?void 0:s.currentStock)||0]}),e.jsxs("span",{children:["Retail: ",Math.round(((a=t.pricing)==null?void 0:a.retail)||0)]}),e.jsxs("span",{children:["Wholesale: ",Math.round(((i=t.pricing)==null?void 0:i.wholesale)||0)]})]})]}),e.jsx("button",{onClick:()=>{var p,I;const r={product:t._id,productName:t.name,quantity:1,unitPrice:((p=t.pricing)==null?void 0:p.retail)||0,total:((I=t.pricing)==null?void 0:I.retail)||0},c=[...l.items,r];h({...l,items:c}),J(!1),A("Product added to invoice")},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm",children:"Add to Invoice"})]})},t._id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:b?"No products found matching your search.":"No products available."})})]})})})]})};export{$t as Orders};
