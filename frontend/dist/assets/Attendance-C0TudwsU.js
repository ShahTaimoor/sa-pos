import{D as Y,E as ue,a as he,r as c,y as d,p as e,x as G,Q as T,bZ as y,b_ as V,C as ye,U as z,aA as ge,aI as pe,w as fe,B as g}from"./index-DaTQeIrM.js";import{u as je}from"./usersApi-8OiecNWZ.js";import{C as Ne}from"./check-circle-C7Swk4iC.js";import{F as be}from"./filter-Dd-_7AND.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=Y("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=Y("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),ke=ue.injectEndpoints({endpoints:n=>({clockIn:n.mutation({query:s=>({url:"attendance/clock-in",method:"post",data:s}),invalidatesTags:[{type:"Settings",id:"ATTENDANCE_STATUS"}]}),clockOut:n.mutation({query:s=>({url:"attendance/clock-out",method:"post",data:s}),invalidatesTags:[{type:"Settings",id:"ATTENDANCE_STATUS"}]}),startBreak:n.mutation({query:({type:s})=>({url:"attendance/breaks/start",method:"post",data:{type:s}}),invalidatesTags:[{type:"Settings",id:"ATTENDANCE_STATUS"}]}),endBreak:n.mutation({query:()=>({url:"attendance/breaks/end",method:"post"}),invalidatesTags:[{type:"Settings",id:"ATTENDANCE_STATUS"}]}),getStatus:n.query({query:()=>({url:"attendance/status",method:"get"}),providesTags:[{type:"Settings",id:"ATTENDANCE_STATUS"}]}),getMyAttendance:n.query({query:s=>({url:"attendance/me",method:"get",params:s}),providesTags:[{type:"Settings",id:"MY_ATTENDANCE"}]}),getTeamAttendance:n.query({query:s=>({url:"attendance/team",method:"get",params:s}),providesTags:[{type:"Settings",id:"TEAM_ATTENDANCE"}]})}),overrideExisting:!1}),{useClockInMutation:ve,useClockOutMutation:we,useStartBreakMutation:Ae,useEndBreakMutation:Ce,useGetStatusQuery:Te,useGetMyAttendanceQuery:Se,useGetTeamAttendanceQuery:Ee}=ke,Oe=()=>{var U;const{hasPermission:n}=he(),[s,S]=c.useState("my"),[Z,P]=c.useState(!1),[a,x]=c.useState({startDate:new Date(new Date().setDate(new Date().getDate()-7)).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],userId:"",status:""}),[E,D]=c.useState(""),[M,I]=c.useState("");c.useEffect(()=>{n("view_team_attendance")&&P(!0)},[n]);const{data:f,isLoading:R,refetch:m,error:j}=Te(void 0,{pollingInterval:3e4});c.useEffect(()=>{j&&d(j,"Failed to fetch attendance status")},[j]);const l=f==null?void 0:f.data,{data:N,isLoading:W,refetch:b,error:k}=Se({startDate:a.startDate,endDate:a.endDate,limit:50},{skip:s!=="my"});c.useEffect(()=>{k&&d(k,"Failed to fetch attendance")},[k]);const{data:v,isLoading:J,refetch:K,error:w}=Ee({startDate:a.startDate,endDate:a.endDate,userId:a.userId||void 0,status:a.status||void 0,limit:50},{skip:s!=="team"||!n("view_team_attendance")});c.useEffect(()=>{w&&d(w,"Failed to fetch team attendance")},[w]);const{data:o}=je({limit:100},{skip:s!=="team"||!n("view_team_attendance")}),A=((U=o==null?void 0:o.data)==null?void 0:U.users)||(o==null?void 0:o.users)||[],[X,{isLoading:L}]=ve(),[ee,{isLoading:O}]=we(),[te,{isLoading:u}]=Ae(),[se,{isLoading:B}]=Ce(),ae=async()=>{try{await X({notesIn:E.trim()||void 0}).unwrap(),g("Clocked in successfully"),D(""),m(),b()}catch(t){d(t,"Failed to clock in")}},ne=async()=>{try{await ee({notesOut:M.trim()||void 0}).unwrap(),g("Clocked out successfully"),I(""),m(),b()}catch(t){d(t,"Failed to clock out")}},_=async(t="break")=>{try{await te({type:t}).unwrap(),g("Break started"),m()}catch(r){d(r,"Failed to start break")}},re=async()=>{try{await se().unwrap(),g("Break ended"),m()}catch(t){d(t,"Failed to end break")}},F=t=>{if(!t)return"0m";const r=Math.floor(t/60),i=t%60;return r>0?`${r}h ${i}m`:`${i}m`},le=t=>{var $;if(!t)return 0;const r=new Date,i=new Date(t),ie=r-i,de=(($=l==null?void 0:l.breaks)==null?void 0:$.reduce((Q,C)=>{if(C.endedAt)return Q+(C.durationMinutes||0);{const me=new Date(C.startedAt),xe=r-me;return Q+Math.round(xe/6e4)}},0))||0,oe=ie-de*6e4;return Math.max(0,Math.round(oe/6e4))},h=()=>{var t;return(t=l==null?void 0:l.breaks)==null?void 0:t.find(r=>!r.endedAt)},q=s==="my"?(N==null?void 0:N.data)||[]:(v==null?void 0:v.data)||[],ce=s==="my"?W:J;return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Attendance"}),e.jsx("p",{className:"text-gray-600",children:"Track your work hours and manage attendance"})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Current Status"}),e.jsx("button",{onClick:()=>m(),className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",title:"Refresh status",children:e.jsx(G,{className:"h-5 w-5"})})]}),R?e.jsx(T,{}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-success-50 rounded-lg border border-success-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-success-500 rounded-full",children:e.jsx(Ne,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Clocked In"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Since ",y(l.clockInAt)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-success-600",children:F(le(l.clockInAt))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Worked"})]})]}),h()&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-warning-50 rounded-lg border border-warning-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-warning-500 rounded-full",children:e.jsx(p,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"On Break"}),e.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:[h().type," - Started ",y(h().startedAt)]})]})]}),e.jsx("button",{onClick:re,disabled:B,className:"btn btn-warning",children:B?e.jsx(T,{size:"sm"}):"End Break"})]}),!h()&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>_("break"),disabled:u,className:"btn btn-secondary flex-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),u?"Starting...":"Start Break"]}),e.jsxs("button",{onClick:()=>_("lunch"),disabled:u,className:"btn btn-secondary flex-1",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),u?"Starting...":"Lunch Break"]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:M,onChange:t=>I(t.target.value),placeholder:"Add notes for clock out...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",rows:"2"})]}),e.jsxs("button",{onClick:ne,disabled:O,className:"btn btn-danger w-full",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),O?"Clocking Out...":"Clock Out"]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"p-4 bg-gray-50 rounded-full inline-block mb-4",children:e.jsx(ye,{className:"h-12 w-12 text-gray-400"})}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You are not clocked in"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (Optional)"}),e.jsx("textarea",{value:E,onChange:t=>D(t.target.value),placeholder:"Add notes for clock in...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",rows:"2"})]}),e.jsxs("button",{onClick:ae,disabled:L,className:"btn btn-primary w-full",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),L?"Clocking In...":"Clock In"]})]})]})}),Z&&e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"card-content",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>S("my"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${s==="my"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(z,{className:"h-4 w-4 inline mr-2"}),"My Attendance"]}),e.jsxs("button",{onClick:()=>S("team"),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${s==="team"?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(ge,{className:"h-4 w-4 inline mr-2"}),"Team Attendance"]})]})})}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Filters"}),e.jsx(be,{className:"h-5 w-5 text-gray-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:a.startDate,onChange:t=>x({...a,startDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:a.endDate,onChange:t=>x({...a,endDate:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),s==="team"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee"}),e.jsxs("select",{value:a.userId,onChange:t=>x({...a,userId:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Employees"}),A==null?void 0:A.map(t=>e.jsxs("option",{value:t._id,children:[t.firstName," ",t.lastName]},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:a.status,onChange:t=>x({...a,status:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]})]})]})]})]})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:s==="my"?"My Attendance History":"Team Attendance"}),e.jsx("button",{onClick:()=>{s==="my"?b():K()},className:"p-2 text-gray-500 hover:text-gray-700 transition-colors",title:"Refresh",children:e.jsx(G,{className:"h-5 w-5"})})]}),ce?e.jsx(T,{}):q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(pe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No attendance records found"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[s==="team"&&e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Employee"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Duration"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Breaks"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Status"})]})}),e.jsx("tbody",{children:q.map(t=>{var r,i;return e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s==="team"&&e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"font-medium",children:[(r=t.user)==null?void 0:r.firstName," ",(i=t.user)==null?void 0:i.lastName]})]})}),e.jsx("td",{className:"py-3 px-4",children:fe(t.clockInAt)}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-4 w-4 text-success-500 mr-2"}),y(t.clockInAt)]})}),e.jsx("td",{className:"py-3 px-4",children:t.clockOutAt?e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 text-danger-500 mr-2"}),y(t.clockOutAt)]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:t.totalMinutes>0?F(t.totalMinutes):"-"}),e.jsx("td",{className:"py-3 px-4",children:t.breaks&&t.breaks.length>0?e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 text-warning-500 mr-2"}),e.jsxs("span",{children:[t.breaks.length," break(s)"]})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="open"?"bg-success-100 text-success-700":"bg-gray-100 text-gray-700"}`,children:t.status==="open"?"Open":"Closed"})})]},t._id)})})]})})]})})]})};export{Oe as default};
